var A=Object.defineProperty,e=("undefined"!=typeof require&&require,(e,t,o)=>(((e,t,o)=>{t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o})(e,"symbol"!=typeof t?t+"":t,o),o));!function(){const A=document.createElement("link").relList;if(!(A&&A.supports&&A.supports("modulepreload"))){for(const A of document.querySelectorAll('link[rel="modulepreload"]'))e(A);new MutationObserver((A=>{for(const t of A)if("childList"===t.type)for(const A of t.addedNodes)"LINK"===A.tagName&&"modulepreload"===A.rel&&e(A)})).observe(document,{childList:!0,subtree:!0})}function e(A){if(A.ep)return;A.ep=!0;const e=function(A){const e={};return A.integrity&&(e.integrity=A.integrity),A.referrerpolicy&&(e.referrerPolicy=A.referrerpolicy),"use-credentials"===A.crossorigin?e.credentials="include":"anonymous"===A.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(A);fetch(A.href,e)}}();class t{constructor(A,t,o){e(this,"w"),e(this,"h"),e(this,"values"),this.w=A,this.h=t,this.values=new Array(A*t);for(let e=0;e<t;e+=o)for(let t=0;t<A;t+=o)this.setSample(t,e,2*Math.random()-1);let i=o,r=1/A,s=1;do{const e=i/2;for(let o=0;o<t;o+=i)for(let t=0;t<A;t+=i){const A=(this.sample(t,o)+this.sample(t+i,o)+this.sample(t,o+i)+this.sample(t+i,o+i))/4+(2*Math.random()-1)*i*r;this.setSample(t+e,o+e,A)}for(let t=0;t<A;t+=i)for(let o=0;o<A;o+=i){const A=this.sample(o,t),s=this.sample(o+i,t),a=this.sample(o,t+i),n=this.sample(o+e,t+e),l=this.sample(o+e,t-e),h=this.sample(o-e,t+e),d=(A+s+n+l)/4+(2*Math.random()-1)*i*r*.5,f=(A+a+n+h)/4+(2*Math.random()-1)*i*r*.5;this.setSample(o+e,t,d),this.setSample(o,t+e,f)}i/=2,r*=s+.8,s*=.3}while(i>1)}sample(A,e){return this.values[(A&this.w-1)+(e&this.h-1)*this.w]}setSample(A,e,t){this.values[(A&this.w-1)+(e&this.h-1)*this.w]=t}}const o=(A,e)=>{const o=new t(A,e,16),i=new t(A,e,16),s=new t(A,e,16),a=new t(A,e,32),n=new t(A,e,32),l=new Array(A*e),h=new Array(A*e);for(let t=0;t<e;t++)for(let h=0;h<A;h++){const d=h+t*A;let f=3*Math.abs(a.values[d]-n.values[d])-2,c=Math.abs(o.values[d]-i.values[d]);c=3*Math.abs(c-s.values[d])-2;let w=h/(A-1)*2-1,g=t/(e-1)*2-1;w<0&&(w=-w),g<0&&(g=-g);let m=w>=g?w:g;m*=m*m*m,m*=m*m*m,f=f+1-20*m,l[d]=f<-.5?r.water.id:r.grass.id}for(let t=0;t<A*e/2800;t++){let t=Math.round(Math.random()*A),o=Math.round(Math.random()*e);for(let i=0;i<10;i++){let i=t+Math.round(21*Math.random()-10),s=o+Math.round(21*Math.random()-10);for(let t=0;t<100;t++){let t=i+Math.round(5*Math.random())-Math.round(5*Math.random()),o=s+Math.round(5*Math.random())-Math.round(5*Math.random());for(let i=o-1;i<=o+1;i++)for(let o=t-1;o<=t+1;o++)o>=0&&i>=0&&o<A&&i<e&&1==l[o+i*A]&&(l[o+i*A]=r.sand.id)}}}return[l,h]};class i{constructor(A){e(this,"id"),this.id=A}}const r={water:new class extends i{}(0),grass:new class extends i{}(1),sand:new class extends i{}(2)};let s=!1;window.onload=()=>{s=!0,D()},window.onresize=D;let a=!1,n=!1,l=0,h=0,d=0,f=0;var c,w,g=3,m=(c="data:image/png;base64,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",w=new Image,u++,w.onload=function(){0==--u&&D()},w.src=c,w),u=0;const M=document.querySelector("#map"),v=M.getContext("2d"),p=new class{constructor(){e(this,"scrollSpeed",3),e(this,"keys",[]),window.onkeydown=A=>{this.keys[A.keyCode]=!0},window.onkeyup=A=>{this.keys[A.keyCode]=!1}}update(A){this.keys[87]&&(scrollY+=this.scrollSpeed,A()),this.keys[65]&&(scrollX+=this.scrollSpeed,A()),this.keys[83]&&(scrollY-=this.scrollSpeed,A()),this.keys[68]&&(scrollX-=this.scrollSpeed,A())}};var I=new Array(6);for(let L=0;L<I.length;L++)I[L]={name:"Base",imageX:0,imageY:6};const B=new class{constructor(A,t){e(this,"tiles"),e(this,"width"),e(this,"height"),this.width=A,this.height=t,this.tiles=new Array(A*t),this.init()}init(){const A=((A,e)=>{for(;;){const t=o(A,e),i=new Array(256);for(let o=0;o<A*e;o++)i[255&t[0][o]]++;if(!(i[2]<100||i[1]<100))return t}})(this.width,this.height);for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++)this.tiles[t+e*this.height]={visible:0,owned:!1,tileId:A[0][t+e*this.height]}}}(128,128);async function D(){if(s&&!(u>0)){M.width=window.innerWidth,M.height=window.innerHeight,M.onmousedown=function(A){A.preventDefault(),a=!0,n=!1,l=A.clientX,h=A.clientY},M.onclick=function(A){if(a=!1,!n){var e=Math.floor(d+(M.width/g-2048)/2),t=Math.floor(f+(M.height/g-2048)/2);b(Math.floor((A.clientX/g-e)/16),Math.floor((A.clientY/g-t)/16))}};var A=Math.floor(d+(M.width/g-2048)/2),e=Math.floor(f+(M.height/g-2048)/2);b(Math.floor((800/g-A)/16),Math.floor((600/g-e)/16)),window.onmousemove=function(A){if(a){A.preventDefault();var e=A.clientX-l,t=A.clientY-h;(n||e*e+t*t>64)&&(n=!0,d+=e/g,f+=t/g,l=A.clientX,h=A.clientY,requestAnimationFrame(U))}},C()}}let y=0,X=0;function b(A,e){if(A>0&&e>0&&A<128&&e<128){var t=x(A,e);t.owned=!t.owned,function(){for(var A=0;A<128;A++)for(var e=0;e<128;e++){B.tiles[e+128*A].visible&=1}for(A=0;A<128;A++)for(e=0;e<128;e++){B.tiles[e+128*A].owned&&H(e,A,4)}}()}y=A,X=e,console.log(y,X),requestAnimationFrame(U)}function H(A,e,t){for(var o=e-t;o<=e+t;o++)if(!(o<0||o>=128))for(var i=A-t;i<=A+t;i++)if(!(i<0||i>=128)){var r=i-A,s=o-e;if(r*r+s*s<=t*t+2){if(0===o||0===i||127===i||127===o)continue;B.tiles[i+128*o].visible=3}}}const C=()=>{requestAnimationFrame(C),p.update(U)};function U(){g=Math.max(Math.floor(M.height/300+1),Math.floor(M.width/(16/9*300)+1));var A=Math.max(0,2112-M.width/g)/2,e=Math.max(0,2112-M.height/g)/2;d<-A&&(d=-A),f<-e&&(f=-e),d>A&&(d=A),f>e&&(f=e),v.imageSmoothingEnabled=!1,v.setTransform(g,0,0,g,0,0);for(var t=Math.floor(d+(M.width/g-2048)/2),o=Math.floor(f+(M.height/g-2048)/2),i=Math.floor(-t/16),r=Math.floor(-o/16),s=Math.ceil((-t+M.width/g)/16),a=Math.ceil((-o+M.height/g)/16),n=r;n<a;n++)for(var l=i;l<s;l++){if(0==(y=x(l,n)).tileId)v.drawImage(m,40,0,8,8,16*l+t+0,16*n+o+0,8,8),v.drawImage(m,40,0,8,8,16*l+t+8,16*n+o+0,8,8),v.drawImage(m,40,0,8,8,16*l+t+0,16*n+o+8,8,8),v.drawImage(m,40,0,8,8,16*l+t+8,16*n+o+8,8,8);else for(var h=0;h<4;h++){var c=h%2*2-1,w=x(l,n+(X=2*(h>>1)-1)).tileId!==y.tileId,u=x(l+c,n).tileId!==y.tileId,p=x(l+c,n+X).tileId!==y.tileId,B=1,D=1+3*(y.tileId-1);w&&(D+=X),u&&(B+=c),w||u||!p||(B+=3-h%2,D-=h>>1),v.drawImage(m,8*B,8*D,8,8,16*l+t+h%2*8,16*n+o+8*(h>>1),8,8)}y.owned&&v.drawImage(m,0,48,16,16,16*l+t,16*n+o,16,16)}for(n=r;n<a;n++)for(l=i;l<s;l++){var y;if(1===(y=x(l,n)).visible)v.drawImage(m,240,16,8,8,16*l+t+0,16*n+o+0,8,8),v.drawImage(m,240,16,8,8,16*l+t+8,16*n+o+0,8,8),v.drawImage(m,240,16,8,8,16*l+t+0,16*n+o+8,8,8),v.drawImage(m,240,16,8,8,16*l+t+8,16*n+o+8,8,8);else for(h=0;h<4;h++){var X;c=h%2*2-1,w=x(l,n+(X=2*(h>>1)-1)).visible!==y.visible,u=x(l+c,n).visible!==y.visible,p=x(l+c,n+X).visible!==y.visible,B=25,D=1;3==y.visible&&(D+=3),w&&(D+=X),u&&(B+=c),v.drawImage(m,8*B,8*D,8,8,16*l+t+h%2*8,16*n+o+8*(h>>1),8,8)}}P("GOLD: 500",4,4),P("FOOD: 0/100",4,14),v.beginPath(),v.fillStyle="rgba(255, 255, 255, 0.3)",v.fillRect(0,30,24,24*I.length+6),v.stroke();for(h=0;h<I.length;h++)P(I[h].name,6,34+24*h,3),k(I[h].imageX,I[h].imageY,4,38+24*h)}function x(A,e){return A<0||e<0||A>=128||e>=128?B.tiles[0]:B.tiles[A+128*e]}var N="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ";function P(A,e,t,o=8){A=A.toUpperCase();for(var i=0;i<A.length;i++){var r=N.indexOf(A.charAt(i)),s=0+r%32,a=29+(r>>5);v.drawImage(m,8*s,8*a,8,8,e+i*o,t,o,o)}}function k(A,e,t,o){v.beginPath(),v.strokeStyle="yellow",v.rect(t,o,16,16),v.stroke(),v.drawImage(m,8*A,8*e,16,16,t,o,16,16)}

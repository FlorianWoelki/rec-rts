var t=Object.defineProperty,i=("undefined"!=typeof require&&require,(i,e,s)=>(((i,e,s)=>{e in i?t(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s})(i,"symbol"!=typeof e?e+"":e,s),s));!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver((t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)})).observe(document,{childList:!0,subtree:!0})}function i(t){if(t.ep)return;t.ep=!0;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?i.credentials="include":"anonymous"===t.crossorigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();var e="data:image/png;base64,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";class s{constructor(t,e){i(this,"x"),i(this,"y"),i(this,"xa",0),i(this,"ya",0),i(this,"dirX",0),this.x=t,this.y=e}update(t){}move(t){if(0!==this.xa||0!==this.ya){let i=!0;return 0!==this.xa&&this.move2(t,this.xa,0)&&(i=!1),0!==this.ya&&this.move2(t,0,this.ya)&&(i=!1),0===this.xa||0===this.ya||this.move3(t,this.xa,this.ya)||(this.xa=0,this.ya=0),!i}return!0}move3(t,i,e){const s=this.x+i,h=this.y+e;return!!t.getTile(1===i?Math.floor(s):Math.round(s),1===e?Math.floor(h):Math.round(h)).isPassable}move2(t,i,e){const s=this.x-0,h=this.y-0,r=this.x+0,a=this.y+0,n=this.x+i-0,A=this.y+e-0,o=this.x+i+0,l=this.y+e+0;let d=!1;for(let g=A;g<=l;g++)for(let i=n;i<=o;i++)if(!(i>=s&&i<=r&&g>=h&&g<=a||t.getTile(Math.round(i),Math.round(g)).isPassable))return d=!0,!1;return!d&&(this.x+=i/16,this.y+=e/16,!0)}}class h extends s{constructor(){super(...arguments),i(this,"tx",0),i(this,"maxTx",4),i(this,"ty",12),i(this,"movingTx",4),i(this,"maxMovingTx",10),i(this,"moving",!0),i(this,"animation",0),i(this,"movingAnimation",0)}render(t,i,e,s){t.renderEntity(i,this.moving?8*this.movingTx:8*this.tx,-1===this.xa||1===this.dirX?8*(this.ty+2):8*this.ty,this.x,this.y,e,s)}update(t){1===this.xa||1===this.ya?(this.moving=!0,this.dirX=0):-1===this.xa||-1===this.ya?(this.moving=!0,this.dirX=1):this.moving=!1,this.move(t)?0===Math.floor(20*Math.random())&&(this.xa=Math.floor(3*Math.random())-1,this.ya=Math.floor(3*Math.random())-1):(this.xa=0,this.ya=0),this.animation+=1,this.movingAnimation+=1,this.animation%5!=0||this.moving||(this.animation=0,this.tx+=2,this.tx%this.maxTx==0&&(this.tx=0)),this.movingAnimation%2==0&&this.moving&&(this.movingAnimation=0,this.movingTx+=2,this.movingTx%this.maxMovingTx==0&&(this.movingTx=4))}}class r extends s{constructor(){super(...arguments),i(this,"tx",0),i(this,"maxTx",4),i(this,"ty",16),i(this,"movingTx",4),i(this,"maxMovingTx",10),i(this,"moving",!0),i(this,"animation",0),i(this,"movingAnimation",0)}render(t,i,e,s){t.renderEntity(i,this.moving?8*this.movingTx:8*this.tx,-1===this.xa||1===this.dirX?8*(this.ty+2):8*this.ty,this.x,this.y,e,s)}update(t){1===this.xa||1===this.ya?(this.moving=!0,this.dirX=0):-1===this.xa||-1===this.ya?(this.moving=!0,this.dirX=1):this.moving=!1,this.move(t)?0===Math.floor(20*Math.random())&&(this.xa=Math.floor(3*Math.random())-1,this.ya=Math.floor(3*Math.random())-1):(this.xa=0,this.ya=0),this.animation+=1,this.movingAnimation+=1,this.animation%7!=0||this.moving||(this.animation=0,this.tx+=2,this.tx%this.maxTx==0&&(this.tx=0)),this.movingAnimation%2==0&&this.moving&&(this.movingAnimation=0,this.movingTx+=2,this.movingTx%this.maxMovingTx==0&&(this.movingTx=4))}}Math.seed=t=>{const i=4294967295;let e=123456789+t&i,s=987654321-t&i;return()=>{s=36969*(65535&s)+(s>>>16)&i,e=18e3*(65535&e)+(e>>>16)&i;let t=(s<<16)+(65535&e)>>>0;return t/=4294967296,t}};let a=Math.seed(Math.random()*(10+90*Math.random()));class n{constructor(t,e,s){i(this,"w"),i(this,"h"),i(this,"values"),this.w=t,this.h=e,this.values=new Array(t*e);for(let i=0;i<e;i+=s)for(let e=0;e<t;e+=s)this.setSample(e,i,2*a()-1);let h=s,r=1/t,n=1;do{const i=h/2;for(let s=0;s<e;s+=h)for(let e=0;e<t;e+=h){const t=(this.sample(e,s)+this.sample(e+h,s)+this.sample(e,s+h)+this.sample(e+h,s+h))/4+(2*a()-1)*h*r;this.setSample(e+i,s+i,t)}for(let e=0;e<t;e+=h)for(let s=0;s<t;s+=h){const t=this.sample(s,e),n=this.sample(s+h,e),A=this.sample(s,e+h),o=this.sample(s+i,e+i),l=this.sample(s+i,e-i),d=this.sample(s-i,e+i),g=(t+n+o+l)/4+(2*a()-1)*h*r*.5,c=(t+A+o+d)/4+(2*a()-1)*h*r*.5;this.setSample(s+i,e,g),this.setSample(s,e+i,c)}h/=2,r*=n+.8,n*=.3}while(h>1)}sample(t,i){return this.values[(t&this.w-1)+(i&this.h-1)*this.w]}setSample(t,i,e){this.values[(t&this.w-1)+(i&this.h-1)*this.w]=e}}const A=(t,i,e=Math.random()*Number.MAX_SAFE_INTEGER)=>{a=Math.seed(e);const s=new n(t,i,16),h=new n(t,i,16),r=new n(t,i,16),A=new n(t,i,32),l=new n(t,i,32),d=new Array(t*i),g=new Array(t*i);for(let a=0;a<i;a++)for(let e=0;e<t;e++){const n=e+a*t;let o=3*Math.abs(A.values[n]-l.values[n])-2,g=Math.abs(s.values[n]-h.values[n]);g=3*Math.abs(g-r.values[n])-2;let m=e/(t-1)*2-1,f=a/(i-1)*2-1;m<0&&(m=-m),f<0&&(f=-f);let u=m>=f?m:f;u*=u*u*u,u*=u*u*u,o=o+1-20*u,d[n]=o<-.5?c.water.id:o>.5&&g<-1.5?c.rock.id:c.grass.id}for(let n=0;n<t*i/2800;n++){let e=Math.round(a()*t),s=Math.round(a()*i);for(let h=0;h<10;h++){let h=e+Math.round(21*a()-10),r=s+Math.round(21*a()-10);for(let e=0;e<100;e++){let e=h+Math.round(5*a())-Math.round(5*a()),s=r+Math.round(5*a())-Math.round(5*a());for(let h=s-1;h<=s+1;h++)for(let s=e-1;s<=e+1;s++)s>=0&&h>=0&&s<t&&h<i&&1==d[s+h*t]&&(d[s+h*t]=c.sand.id)}}}for(let n=0;n<t*i/400;n++){const e=Math.round(a()*t),s=Math.round(a()*i);for(let h=0;h<200;h++){const h=e+Math.round(15*a())-Math.round(15*a()),r=s+Math.round(15*a())-Math.round(15*a());h>=0&&r>=0&&h<t&&r<i&&d[h+r*t]==c.grass.id&&(d[h+r*t]=c.tree.id)}}for(let n=0;n<t*i/40;n++){const e=Math.round(a()*t),s=Math.round(a()*i);e>=0&&s>=0&&e<t&&s<<i&&d[e+s*t]===c.sand.id&&(d[e+s*t]=c.cactus.id)}for(let n=0;n<t*i/400;n++){const e=Math.round(a()*t),s=Math.round(a()*i);for(let h=0;h<30;h++){const h=e+Math.round(5*a())-Math.round(5*a()),r=s+Math.round(5*a())-Math.round(5*a());h>=0&&r>=0&&h<t&&r<i&&d[h+r*t]==c.grass.id&&(d[h+r*t]=c.flower.id)}}let m=-1,f=-1;for(;-1===m||-1===f;){m=Math.round(a()*t),f=Math.round(a()*i);t:for(let i=f-1;i<=f+1;i++)for(let e=m-1;e<=m+1;e++)if(d[e+i*t]===c.water.id||d[e+i*t]===c.rock.id||d[e+i*t]===c.tree.id){m=-1,f=-1;break t}const e=o(d,t,m,f,3,3,c.tree.id),s=o(d,t,m,f,5,1,c.rock.id);e&&s||(m=-1,f=-1)}return d[m+f*t]=c.startingPosition.id,[d,g]},o=(t,i,e,s,h,r,a)=>{let n=0;for(let A=s-h;A<=s+h;A++)for(let s=e-h;s<=e+h;s++)t[s+A*i]===a&&n++;return n>=r},l={wood:{imageX:0,imageY:11},stone:{imageX:1,imageY:11}};class d{constructor(t){i(this,"id"),i(this,"isFarmable",!1),i(this,"isPassable",!0),i(this,"isOnGrass",!1),i(this,"isOnSand",!1),i(this,"color",0),this.id=t}update(t,i,e){}getOutcome(){}}class g extends d{constructor(t){super(t),this.color=1096065}render(t,i,e,s,h,r){const a=t.getTile(e,s-1).id===this.id||t.getTile(e,s-1).id===c.tree.id||t.getTile(e,s-1).id===c.flower.id,n=t.getTile(e,s+1).id===this.id||t.getTile(e,s+1).id===c.tree.id||t.getTile(e,s+1).id===c.flower.id,A=t.getTile(e-1,s).id===this.id||t.getTile(e-1,s).id===c.tree.id||t.getTile(e-1,s).id===c.flower.id,o=t.getTile(e+1,s).id===this.id||t.getTile(e+1,s).id===c.tree.id||t.getTile(e+1,s).id===c.flower.id,l=t.getTile(e-1,s-1).id===this.id||t.getTile(e-1,s-1).id===c.tree.id||t.getTile(e-1,s-1).id===c.flower.id,d=t.getTile(e+1,s-1).id===this.id||t.getTile(e+1,s-1).id===c.tree.id||t.getTile(e+1,s-1).id===c.flower.id,g=t.getTile(e-1,s+1).id===this.id||t.getTile(e-1,s+1).id===c.tree.id||t.getTile(e-1,s+1).id===c.flower.id,m=t.getTile(e+1,s+1).id===this.id||t.getTile(e+1,s+1).id===c.tree.id||t.getTile(e+1,s+1).id===c.flower.id;a||A?a&&A&&!l?t.renderTile(i,32,32,e,s,h,r):t.renderTile(i,A?8:0,a?32:24,e,s,h,r):t.renderTile(i,0,24,e,s,h,r),a||o?a&&o&&!d?t.renderTile(i,24,32,e,s,h+8,r):t.renderTile(i,o?8:16,a?32:24,e,s,h+8,r):t.renderTile(i,16,24,e,s,h+8,r),n||A?n&&A&&!g?t.renderTile(i,32,24,e,s,h,r+8):t.renderTile(i,A?8:0,n?32:40,e,s,h,r+8):t.renderTile(i,0,40,e,s,h,r+8),n||o?n&&o&&!m?t.renderTile(i,24,24,e,s,h+8,r+8):t.renderTile(i,o?8:16,n?32:40,e,s,h+8,r+8):t.renderTile(i,16,40,e,s,h+8,r+8)}}const c={water:new class extends d{constructor(t){super(t),i(this,"position1",0),i(this,"position2",0),i(this,"position3",0),i(this,"position4",0),i(this,"shouldAnimate",!0),this.isPassable=!1,this.color=3900150}render(t,i,e,s,h,r){this.shouldAnimate&&(this.position1=Math.round(3+3*Math.random()),this.position2=Math.round(3+3*Math.random()),this.position3=Math.round(3+3*Math.random()),this.position4=Math.round(3+3*Math.random()),this.shouldAnimate=!1);const a=t.getTile(e,s-1).id===this.id,n=t.getTile(e,s+1).id===this.id,A=t.getTile(e-1,s).id===this.id,o=t.getTile(e+1,s).id===this.id,l=t.getTile(e-1,s-1).id===this.id,d=t.getTile(e+1,s-1).id===this.id;a||A?a&&A&&!l?t.renderTile(i,32,8,e,s,h,r):a&&A?t.renderTile(i,8*this.position1,16,e,s,h,r):t.renderTile(i,A?8:0,a?8:0,e,s,h,r):t.renderTile(i,0,0,e,s,h,r),a||o?a&&o&&!d?t.renderTile(i,24,8,e,s,h+8,r):a&&o?t.renderTile(i,8*this.position2,16,e,s,h+8,r):t.renderTile(i,o?8:16,a?8:0,e,s,h+8,r):t.renderTile(i,16,0,e,s,h+8,r),n||A?n&&A?t.renderTile(i,8*this.position3,16,e,s,h,r+8):t.renderTile(i,A?8:0,n?8:16,e,s,h,r+8):t.renderTile(i,0,16,e,s,h,r+8),n||o?n&&o?t.renderTile(i,8*this.position4,16,e,s,h+8,r+8):t.renderTile(i,o?8:16,n?8:16,e,s,h+8,r+8):t.renderTile(i,16,16,e,s,h+8,r+8),a&&!A&&l&&t.renderTile(i,32,0,e,s,h,r-8),a&&!o&&d&&t.renderTile(i,24,0,e,s,h+8,r-8)}update(t,i,e){t.tickCount%10==0&&(this.shouldAnimate=!0)}}(0),grass:new g(1),sand:new class extends d{constructor(t){super(t),this.color=16498468}render(t,i,e,s,h,r){t.renderTile(i,40,0,e,s,h,r),t.renderTile(i,40,0,e,s,h+8,r),t.renderTile(i,40,0,e,s,h,r+8),t.renderTile(i,40,0,e,s,h+8,r+8)}}(2),tree:new class extends d{constructor(t){super(t),this.isFarmable=!0,this.isPassable=!1,this.isOnGrass=!0,this.color=417606}render(t,i,e,s,h,r){t.onTopTiles.find((t=>t.x===e&&t.y===s))||(t.onTopTiles.push({sx:16,sy:72,x:e,y:s,xExtraOffset:0,yExtraOffset:0}),t.onTopTiles.push({sx:24,sy:72,x:e,y:s,xExtraOffset:8,yExtraOffset:0})),t.renderTile(i,16,80,e,s,h,r+8),t.renderTile(i,24,80,e,s,h+8,r+8)}getOutcome(){return{amount:3,type:"wood"}}}(3),rock:new class extends d{constructor(t){super(t),this.isFarmable=!0,this.isPassable=!1,this.color=10265519}render(t,i,e,s,h,r){const a=t.getTile(e,s-1).id===this.id,n=t.getTile(e,s+1).id===this.id,A=t.getTile(e-1,s).id===this.id,o=t.getTile(e+1,s).id===this.id,l=t.getTile(e-1,s-1).id===this.id,d=t.getTile(e+1,s-1).id===this.id,g=t.getTile(e-1,s+1).id===this.id,c=t.getTile(e+1,s+1).id===this.id;a||A?a&&A&&!l?t.renderTile(i,32,56,e,s,h,r):t.renderTile(i,A?8:0,a?56:48,e,s,h,r):t.renderTile(i,0,48,e,s,h,r),a||o?a&&o&&!d?t.renderTile(i,24,56,e,s,h+8,r):t.renderTile(i,o?8:16,a?56:48,e,s,h+8,r):t.renderTile(i,16,48,e,s,h+8,r),n||A?n&&A&&!g?t.renderTile(i,32,48,e,s,h,r+8):t.renderTile(i,A?8:0,n?56:64,e,s,h,r+8):t.renderTile(i,0,64,e,s,h,r+8),n||o?n&&o&&!c?t.renderTile(i,24,48,e,s,h+8,r+8):t.renderTile(i,o?8:16,n?56:64,e,s,h+8,r+8):t.renderTile(i,16,64,e,s,h+8,r+8)}getOutcome(){return{amount:3,type:"stone"}}}(4),flower:new class extends d{constructor(t){super(t),this.isOnGrass=!0,this.color=1096065}render(t,i,e,s,h,r){t.renderTile(i,48,0,e,s,h+4,r+4)}}(5),cactus:new class extends d{constructor(t){super(t),this.isOnSand=!0,this.color=16498468}render(t,i,e,s,h,r){t.renderTile(i,56,0,e,s,h,r),t.renderTile(i,64,0,e,s,h+8,r),t.renderTile(i,56,8,e,s,h,r+8),t.renderTile(i,64,8,e,s,h+8,r+8)}}(6),dirt:new class extends d{constructor(t){super(t),this.color=7877903}render(t,i,e,s,h,r){const a=t.getTile(e,s-1).id===this.id,n=t.getTile(e,s+1).id===this.id,A=t.getTile(e-1,s).id===this.id,o=t.getTile(e+1,s).id===this.id,l=t.getTile(e-1,s-1).id===this.id,d=t.getTile(e+1,s-1).id===this.id,g=t.getTile(e-1,s+1).id===this.id,c=t.getTile(e+1,s+1).id===this.id;a||A?a&&A&&!l?t.renderTile(i,72,32,e,s,h,r):t.renderTile(i,A?48:40,a?32:24,e,s,h,r):t.renderTile(i,40,24,e,s,h,r),a||o?a&&o&&!d?t.renderTile(i,64,32,e,s,h+8,r):t.renderTile(i,o?48:56,a?32:24,e,s,h+8,r):t.renderTile(i,56,24,e,s,h+8,r),n||A?n&&A&&!g?t.renderTile(i,72,24,e,s,h,r+8):t.renderTile(i,A?48:40,n?32:40,e,s,h,r+8):t.renderTile(i,40,40,e,s,h,r+8),n||o?n&&o&&!c?t.renderTile(i,64,24,e,s,h+8,r+8):t.renderTile(i,o?48:56,n?32:40,e,s,h+8,r+8):t.renderTile(i,56,40,e,s,h+8,r+8)}}(7),startingPosition:new g(999)},m=Object.entries(c).map((([t,i])=>i));var f,u;(u=f||(f={}))[u.OWNED=1]="OWNED",u[u.VISIBLE=6]="VISIBLE";class w{constructor(t,e,s){i(this,"map2d"),i(this,"imageData"),i(this,"minimapCanvas",document.createElement("canvas")),i(this,"width"),i(this,"height"),this.map2d=t,this.width=e,this.height=s,this.imageData=t.createImageData(e,s),this.minimapCanvas.width=this.imageData.width,this.minimapCanvas.height=this.imageData.height}getRGB(t){return[t>>16&255,t>>8&255,255&t]}render(t,i,e,s){const h=Math.floor(this.map2d.canvas.width/s)-t.width/(e+s+10)-8,r=Math.round(t.width/(e+s+10));for(let a=0;a<this.height;a++)for(let t=0;t<this.width;t++){const e=t+a*this.width,s=i.getTile(t,a),[h,r,n]=this.getRGB(s.color);i.getTileState(t,a,f.OWNED)?(this.imageData.data[4*e]=255,this.imageData.data[4*e+1]=0,this.imageData.data[4*e+2]=0,this.imageData.data[4*e+3]=255):i.getTileState(t,a,f.VISIBLE)>=1?(this.imageData.data[4*e]=h,this.imageData.data[4*e+1]=r,this.imageData.data[4*e+2]=n,this.imageData.data[4*e+3]=255):(this.imageData.data[4*e]=0,this.imageData.data[4*e+1]=0,this.imageData.data[4*e+2]=0,this.imageData.data[4*e+3]=255)}this.minimapCanvas.getContext("2d").putImageData(this.imageData,0,0),this.map2d.drawImage(this.minimapCanvas,h,8,r,r),this.map2d.strokeStyle="rgba(255, 255, 255, 0.35)",this.map2d.strokeRect(h,8,r,r)}}let T=!1,M=!1;window.onload=()=>{T=!0,k()};let x=!1,p=!1,v=0,D=0,S=0,y=0,B=0,C=0;let I=3;let E=0;const Y=(t=>{const i=new Image;return E++,i.onload=()=>{E--,0===E&&k()},i.src=t,i})(e),Q=document.querySelector("#map"),z=Q.getContext("2d"),P=new class{constructor(){i(this,"scrollX",0),i(this,"scrollY",0),i(this,"scrollSpeed",3),i(this,"keys",[]),window.onkeydown=t=>{this.keys[t.keyCode]=!0},window.onkeyup=t=>{this.keys[t.keyCode]=!1}}update(t,i,e,s){return this.scrollX=t,this.scrollY=i,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&e&&e(),this.keys[49]&&s&&s(),[this.scrollX,this.scrollY]}};let b;const G=new Array(1);for(let tt=0;tt<G.length;tt++)G[tt]={name:"Base",imageX:0,imageY:9};const O=new class{constructor(t,s,h){i(this,"tiles"),i(this,"data"),i(this,"tilesState"),i(this,"tileSize",16),i(this,"tickCount",0),i(this,"tileImage"),i(this,"imagesToLoad",0),i(this,"width"),i(this,"height"),i(this,"seed"),i(this,"entities",[]),i(this,"onTopTiles",[]),this.width=t,this.height=s,this.seed=h,this.tiles=new Array(t*s),this.data=new Array(t*s),this.tilesState=new Array(t*s),this.tileImage=this.loadImage(e)}loadImage(t){var i=new Image;return this.imagesToLoad++,i.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},i.src=t,i}init(){const t=((t,i,e=Math.random()*Number.MAX_SAFE_INTEGER)=>{for(;;){const s=A(t,i,e),h=new Array(256);for(let e=0;e<t*i;e++)h[255&s[0][e]]++;if(!(h[255&c.rock.id]<100||h[255&c.sand.id]<100||h[255&c.grass.id]<100||h[255&c.tree.id]<100))return s}})(this.width,this.height,this.seed);this.tiles=t[0],this.tilesState=[...t[1]],this.data=[...t[1]],this.tilesState.fill(0);for(let i=0;i<this.height;i++)for(let t=0;t<this.width;t++){if(this.tiles[t+i*this.width]===c.startingPosition.id)for(let e=0;e<5;e++)this.entities.push(0===Math.round(1*Math.random())?new h(t,i):new r(t,i))}}update(){this.tickCount++,this.tickCount>=Number.MAX_VALUE&&(this.tickCount=0);for(let t=0;t<this.width*this.height/50;t++){const t=Math.round(Math.random()*this.width),i=Math.round(Math.random()*this.height);this.getTile(t,i).update(this,t,i)}this.entities.forEach((t=>t.update(this)))}render(t,i,e,s,h){const r=Math.floor(-e/this.tileSize),a=Math.floor(-s/this.tileSize),n=Math.ceil((-e+t.width/h)/this.tileSize),A=Math.ceil((-s+t.height/h)/this.tileSize);for(let o=a;o<A;o++)for(let t=r;t<n;t++){const h=this.getTile(t,o),r=this.getTileState(t,o,1);if(h.isOnGrass){m.find((t=>t.id===c.grass.id)).render(this,i,t,o,e,s)}else if(h.isOnSand){m.find((t=>t.id===c.sand.id)).render(this,i,t,o,e,s)}h.render(this,i,t,o,e,s),1===r&&i.drawImage(this.tileImage,0,72,16,16,t*this.tileSize+e,o*this.tileSize+s,16,16)}this.entities.forEach((t=>t.render(this,i,e,s))),this.onTopTiles.forEach((t=>{this.renderTile(i,t.sx,t.sy,t.x,t.y,t.xExtraOffset+e,t.yExtraOffset+s)}));for(let o=a;o<A;o++)for(let t=r;t<n;t++){const h=this.getTileState(t,o,6);if(1===h)i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+0,o*this.tileSize+s+0,8,8),i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+8,o*this.tileSize+s+0,8,8),i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+0,o*this.tileSize+s+8,8,8),i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+8,o*this.tileSize+s+8,8,8);else for(let r=0;r<4;r++){const a=r%2*2-1,n=2*(r>>1)-1,A=this.getTileState(t,o+n,6)!==h,l=this.getTileState(t+a,o,6)!==h;let d=25,g=1;3===h&&(g+=3),A&&(g+=n),l&&(d+=a),i.drawImage(this.tileImage,8*d,8*g,8,8,t*this.tileSize+e+r%2*8,o*this.tileSize+s+8*(r>>1),8,8)}}}renderEntity(t,i,e,s,h,r,a){t.drawImage(this.tileImage,i,e,this.tileSize,this.tileSize,s*this.tileSize+r,h*this.tileSize+a,this.tileSize,this.tileSize)}renderTile(t,i,e,s,h,r,a){t.drawImage(this.tileImage,i,e,8,8,s*this.tileSize+r,h*this.tileSize+a,8,8)}getTile(t,i){if(t<0||i<0||t>=this.width||i>=this.height)return c.water;const e=m.find((e=>this.tiles[t+i*this.width]===e.id));return null!=e?e:c.water}getTileState(t,i,e){return t<0||i<0||t>=this.width||i>=this.height?0:6===e?(this.tilesState[t+i*this.width]&e)>>1:this.tilesState[t+i*this.width]&e}setTileState(t,i,e,s){if(!(t<0||i<0||t>=this.width||i>=this.height))if(6===s){const s=this.tilesState[t+i*this.width];this.tilesState[t+i*this.width]=e<<1|1&s}else this.tilesState[t+i*this.width]^=e,this.tiles[t+i*this.width]=c.dirt.id}setTile(t,i,e){t<0||i<0||t>=this.width||i>=this.height||(this.tiles[t+i*this.width]=e.id)}setData(t,i,e){t<0||i<0||t>=this.width||i>=this.height||(this.data[t+i*this.width]=e)}getData(t,i){return t<0||i<0||t>=this.width||i>=this.height?0:255&this.data[t+i*this.width]}recalcVisibility(){for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++){let e=this.getTileState(i,t,6);3===e&&(e>>=1),this.setTileState(i,t,e,6)}for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++){this.getTileState(i,t,1)&&this.revealTile(i,t,4)}}revealTile(t,i,e){for(let s=i-e;s<=i+e;s++)if(!(s<0||s>=this.height))for(let h=t-e;h<=t+e;h++){if(h<0||h>=this.width)continue;const r=h-t,a=s-i;if(r*r+a*a<=e*e+2){if(0===s||0===h||h===this.width-1||s===this.height-1)continue;this.setTileState(h,s,3,6)}}}}(128,128),k=()=>{if(T&&!(E>0)){if(Q.width=window.innerWidth,Q.height=window.innerHeight,b=new w(z,128,128),Q.onmousedown=t=>{t.preventDefault(),x=!0,p=!1,v=t.clientX,D=t.clientY},Q.onclick=t=>{if(x=!1,!p){const i=Math.floor(S+16*-B+window.innerWidth/I/2),e=Math.floor(y+16*-C+window.innerHeight/I/2),s=Math.floor((t.clientX/I-i)/16),h=Math.floor((t.clientY/I-e)/16);L(s,h,t.clientX/I,t.clientY/I)}},window.onmousemove=t=>{if(!x)return;t.preventDefault();const i=t.clientX-v,e=t.clientY-D;(p||i*i+e*e>64)&&(p=!0,S+=i/I,y+=e/I,v=t.clientX,D=t.clientY)},!M){for(let t=0;t<128;t++)for(let i=0;i<128;i++){const e=i+128*t;O.tiles[e]===c.startingPosition.id&&(B=i,C=t,O.setTileState(B,C,1,f.OWNED),O.recalcVisibility())}R(),M=!0}W()}};window.onresize=k;let H=null,X=null,q=!1;const L=(t,i,e=800,s=600)=>{const h=Math.floor(z.canvas.width/I),r=Math.floor(z.canvas.height/I);if(e>=0&&e<=h&&s>=r-35&&s<=r&&H&&X){return void(O.getTile(H,X).isPassable&&_(e,s))}if(t<0||i<0||t>128||i>128)return H=null,void(X=null);const a=O.getTileState(t,i,f.VISIBLE);if(0===a)return H=null,void(X=null);H===t&&X===i||(H=t,X=i,q=3===a)};let N=Date.now(),F=Date.now(),U=0;const R=()=>{requestAnimationFrame(R),N=F,F=Date.now(),U+=F-N,U>=60&&(U=0,j());const t=P.update(S,y,(()=>{}),(()=>{if(H&&X){for(let t=0;t<5;t++)O.entities.push(0===Math.round(1*Math.random())?new h(H,X):new r(H,X));O.setTileState(H,X,1,f.OWNED),O.recalcVisibility(),H=null,X=null}}));S===t[0]&&y===t[1]||(S=t[0],y=t[1]),W()},j=()=>{O.update()},W=()=>{I=Math.max(Math.floor(Q.height/300+1),Math.floor(Q.width/(16/9*300)+1)),S>16*B&&(S=16*B),y>16*C&&(y=16*C),S<16*B-2016&&(S=16*B-2016),y<16*C-2016&&(y=16*C-2016),z.imageSmoothingEnabled=!1,z.setTransform(I,0,0,I,0,0);const t=Math.floor(S+16*-B+window.innerWidth/I/2),i=Math.floor(y+16*-C+window.innerHeight/I/2);O.render(Q,z,t,i,I);for(var e=0;e<G.length;e++){const t=Math.floor(z.canvas.width/I),i=Math.floor(z.canvas.height/I);z.fillStyle="rgba(255, 255, 255, 0.3)",z.fillRect(0,i-35,t,i),Z(G[e].name,t/2+2,i-25-5,3),$(G[e].imageX,G[e].imageY,t/2,i-25)}if(H&&X&&(z.strokeStyle="white",z.strokeRect(16*H+t,16*X+i,16,16),q)){const e=O.getTile(H,X).getOutcome();e&&(z.fillStyle="rgba(0, 0, 0, 0.3)",z.fillRect(16*H+t+16,16*X+i,18,16),z.drawImage(Y,8*l[e.type].imageX,8*l[e.type].imageY,8,8,16*H+t+18,16*X+i+4,8,8),Z(`${e.amount}`,16*H+t+27,16*X+i+5,5))}K(),b.render(Q,O,16,I)},J=[{imageX:0,imageY:11},{imageX:1,imageY:11}],K=()=>{for(let t=0;t<J.length;t++)z.drawImage(Y,8*J[t].imageX,8*J[t].imageY,8,8,4,4+14*t,8,8),Z("0",14,5+14*t,6)},V="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",Z=(t,i,e,s=8)=>{t=t.toUpperCase();for(var h=0;h<t.length;h++){var r=V.indexOf(t.charAt(h)),a=0+r%32,n=29+(r>>5);z.drawImage(Y,8*a,8*n,8,8,i+h*s,e,s,s)}},_=(t,i)=>{const e=Math.floor(z.canvas.width/I)/2,s=Math.floor(z.canvas.height/I)-25;t>=e&&t<=e+16&&i>=s&&i<=s+16&&H&&X&&(O.setTileState(H,X,1,f.OWNED),O.recalcVisibility(),H=null,X=null)},$=(t,i,e,s)=>{z.beginPath(),z.strokeStyle="yellow",z.rect(e,s,16,16),z.stroke(),z.drawImage(Y,8*t,8*i,16,16,e,s,16,16)};

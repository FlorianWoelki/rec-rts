var e=Object.defineProperty,t=("undefined"!=typeof require&&require,(t,i,A)=>(((t,i,A)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:A}):t[i]=A})(t,"symbol"!=typeof i?i+"":i,A),A));!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i="data:image/png;base64,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";class A{constructor(e,i,A){t(this,"w"),t(this,"h"),t(this,"values"),this.w=e,this.h=i,this.values=new Array(e*i);for(let t=0;t<i;t+=A)for(let i=0;i<e;i+=A)this.setSample(i,t,2*Math.random()-1);let r=A,s=1/e,l=1;do{const t=r/2;for(let A=0;A<i;A+=r)for(let i=0;i<e;i+=r){const e=(this.sample(i,A)+this.sample(i+r,A)+this.sample(i,A+r)+this.sample(i+r,A+r))/4+(2*Math.random()-1)*r*s;this.setSample(i+t,A+t,e)}for(let i=0;i<e;i+=r)for(let A=0;A<e;A+=r){const e=this.sample(A,i),l=this.sample(A+r,i),h=this.sample(A,i+r),n=this.sample(A+t,i+t),a=this.sample(A+t,i-t),o=this.sample(A-t,i+t),d=(e+l+n+a)/4+(2*Math.random()-1)*r*s*.5,c=(e+h+n+o)/4+(2*Math.random()-1)*r*s*.5;this.setSample(A+t,i,d),this.setSample(A,i+t,c)}r/=2,s*=l+.8,l*=.3}while(r>1)}sample(e,t){return this.values[(e&this.w-1)+(t&this.h-1)*this.w]}setSample(e,t,i){this.values[(e&this.w-1)+(t&this.h-1)*this.w]=i}}const r=(e,t)=>{const i=new A(e,t,16),r=new A(e,t,16),s=new A(e,t,16),h=new A(e,t,32),n=new A(e,t,32),a=new Array(e*t),o=new Array(e*t);for(let A=0;A<t;A++)for(let o=0;o<e;o++){const d=o+A*e;let c=3*Math.abs(h.values[d]-n.values[d])-2,g=Math.abs(i.values[d]-r.values[d]);g=3*Math.abs(g-s.values[d])-2;let f=o/(e-1)*2-1,w=A/(t-1)*2-1;f<0&&(f=-f),w<0&&(w=-w);let m=f>=w?f:w;m*=m*m*m,m*=m*m*m,c=c+1-20*m,a[d]=c<-.5?l.water.id:l.grass.id}for(let A=0;A<e*t/2800;A++){let i=Math.round(Math.random()*e),A=Math.round(Math.random()*t);for(let r=0;r<10;r++){let r=i+Math.round(21*Math.random()-10),s=A+Math.round(21*Math.random()-10);for(let i=0;i<100;i++){let i=r+Math.round(5*Math.random())-Math.round(5*Math.random()),A=s+Math.round(5*Math.random())-Math.round(5*Math.random());for(let r=A-1;r<=A+1;r++)for(let A=i-1;A<=i+1;A++)A>=0&&r>=0&&A<e&&r<t&&1==a[A+r*e]&&(a[A+r*e]=l.sand.id)}}}for(let A=0;A<e*t/400;A++){const i=Math.round(Math.random()*e),A=Math.round(Math.random()*t);for(let r=0;r<200;r++){const r=i+Math.round(15*Math.random())-Math.round(15*Math.random()),s=A+Math.round(15*Math.random())-Math.round(15*Math.random());r>=0&&s>=0&&r<e&&s<t&&a[r+s*e]==l.grass.id&&(a[r+s*e]=l.tree.id)}}return[a,o]};class s{constructor(e){t(this,"id"),this.id=e}getOutcome(){return 0}}const l={water:new class extends s{render(e,t,i,A,r,s){const l=e.getTile(i,A-1).id===this.id,h=e.getTile(i,A+1).id===this.id,n=e.getTile(i-1,A).id===this.id,a=e.getTile(i+1,A).id===this.id,o=e.getTile(i-1,A-1).id===this.id,d=e.getTile(i+1,A-1).id===this.id;l||n?l&&n&&!o?e.renderTile(t,32,8,i,A,r,s):e.renderTile(t,n?8:0,l?8:0,i,A,r,s):e.renderTile(t,0,0,i,A,r,s),l||a?l&&a&&!d?e.renderTile(t,24,8,i,A,r+8,s):e.renderTile(t,a?8:16,l?8:0,i,A,r+8,s):e.renderTile(t,16,0,i,A,r+8,s),h||n?e.renderTile(t,n?8:0,h?8:16,i,A,r,s+8):e.renderTile(t,0,16,i,A,r,s+8),h||a?e.renderTile(t,a?8:16,h?8:16,i,A,r+8,s+8):e.renderTile(t,16,16,i,A,r+8,s+8),l&&!n&&o&&e.renderTile(t,32,0,i,A,r,s-8),l&&!a&&d&&e.renderTile(t,24,0,i,A,r+8,s-8)}}(0),grass:new class extends s{render(e,t,i,A,r,s){const h=e.getTile(i,A-1).id===this.id||e.getTile(i,A-1).id===l.tree.id,n=e.getTile(i,A+1).id===this.id||e.getTile(i,A+1).id===l.tree.id,a=e.getTile(i-1,A).id===this.id||e.getTile(i-1,A).id===l.tree.id,o=e.getTile(i+1,A).id===this.id||e.getTile(i+1,A).id===l.tree.id,d=e.getTile(i-1,A-1).id===this.id||e.getTile(i-1,A-1).id===l.tree.id,c=e.getTile(i+1,A-1).id===this.id||e.getTile(i+1,A-1).id===l.tree.id;h||a?h&&a&&!d?e.renderTile(t,32,32,i,A,r,s):e.renderTile(t,a?8:0,h?32:24,i,A,r,s):e.renderTile(t,0,24,i,A,r,s),h||o?h&&o&&!c?e.renderTile(t,24,32,i,A,r+8,s):e.renderTile(t,o?8:16,h?32:24,i,A,r+8,s):e.renderTile(t,16,24,i,A,r+8,s),n||a?e.renderTile(t,a?8:0,n?32:40,i,A,r,s+8):e.renderTile(t,0,40,i,A,r,s+8),n||o?e.renderTile(t,o?8:16,n?32:40,i,A,r+8,s+8):e.renderTile(t,16,40,i,A,r+8,s+8)}}(1),sand:new class extends s{render(e,t,i,A,r,s){e.renderTile(t,40,0,i,A,r,s),e.renderTile(t,40,0,i,A,r+8,s),e.renderTile(t,40,0,i,A,r,s+8),e.renderTile(t,40,0,i,A,r+8,s+8)}}(2),tree:new class extends s{render(e,t,i,A,r,s){const h=e.getTile(i,A-1).id===l.water.id||e.getTile(i,A-1).id===l.sand.id,n=e.getTile(i,A+1).id===l.water.id||e.getTile(i,A+1).id===l.sand.id,a=e.getTile(i-1,A).id===l.water.id||e.getTile(i-1,A).id===l.sand.id,o=e.getTile(i+1,A).id===l.water.id||e.getTile(i+1,A).id===l.sand.id;h&&a?e.renderTile(t,0,24,i,A,r,s):e.renderTile(t,a?0:8,h?24:32,i,A,r,s),h&&o?e.renderTile(t,16,24,i,A,r+8,s):e.renderTile(t,o?16:8,h?24:32,i,A,r+8,s),n&&a?e.renderTile(t,0,40,i,A,r,s+8):e.renderTile(t,a?0:8,n?40:32,i,A,r,s+8),n&&o?e.renderTile(t,16,40,i,A,r+8,s+8):e.renderTile(t,o?16:8,n?40:32,i,A,r+8,s+8);e.renderTile(t,16,48,i,A,r,s),e.renderTile(t,24,48,i,A,r+8,s),e.renderTile(t,16,56,i,A,r,s+8),e.renderTile(t,24,56,i,A,r+8,s+8)}getOutcome(){return 3}}(3)},h=Object.entries(l).map((([,e])=>e));var n,a;(a=n||(n={}))[a.OWNED=1]="OWNED",a[a.VISIBLE=6]="VISIBLE";let o=!1;window.onload=()=>{o=!0,D()};let d=!1,c=!1,g=0,f=0,w=0,m=0;let T=3;let u=0;const M=(e=>{const t=new Image;return u++,t.onload=()=>{u--,0===u&&D()},t.src=e,t})(i),v=document.querySelector("#map"),S=v.getContext("2d"),p=new class{constructor(){t(this,"scrollX",0),t(this,"scrollY",0),t(this,"scrollSpeed",2),t(this,"keys",[]),window.onkeydown=e=>{this.keys[e.keyCode]=!0},window.onkeyup=e=>{this.keys[e.keyCode]=!1}}update(e,t,i){return this.scrollX=e,this.scrollY=t,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&i&&i(),[this.scrollX,this.scrollY]}},y=new Array(1);for(let O=0;O<y.length;O++)y[O]={name:"Base",imageX:0,imageY:6};const B=new class{constructor(e,A){t(this,"tiles"),t(this,"tilesState"),t(this,"tileSize",16),t(this,"tileImage"),t(this,"imagesToLoad",0),t(this,"width"),t(this,"height"),this.width=e,this.height=A,this.tiles=new Array(e*A),this.tilesState=new Array(e*A),this.tileImage=this.loadImage(i)}loadImage(e){var t=new Image;return this.imagesToLoad++,t.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},t.src=e,t}init(){const e=((e,t)=>{for(;;){const i=r(e,t),A=new Array(256);for(let r=0;r<e*t;r++)A[255&i[0][r]]++;if(!(A[2]<100||A[1]<100))return i}})(this.width,this.height);this.tiles=e[0],this.tilesState=e[1],this.tilesState.fill(0)}render(e,t,i,A,r){const s=Math.floor(-i/this.tileSize),l=Math.floor(-A/this.tileSize),h=Math.ceil((-i+e.width/r)/this.tileSize),n=Math.ceil((-A+e.height/r)/this.tileSize);for(let a=l;a<n;a++)for(let e=s;e<h;e++){const r=this.getTile(e,a),s=this.getTileState(e,a,1);r.render(this,t,e,a,i,A),1===s&&t.drawImage(this.tileImage,0,48,16,16,e*this.tileSize+i,a*this.tileSize+A,16,16)}for(let a=l;a<n;a++)for(let e=s;e<h;e++){const r=this.getTileState(e,a,6);if(1===r)t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,a*this.tileSize+A+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,a*this.tileSize+A+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,a*this.tileSize+A+8,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,a*this.tileSize+A+8,8,8);else for(let s=0;s<4;s++){const l=s%2*2-1,h=2*(s>>1)-1,n=this.getTileState(e,a+h,6)!==r,o=this.getTileState(e+l,a,6)!==r;let d=25,c=1;3===r&&(c+=3),n&&(c+=h),o&&(d+=l),t.drawImage(this.tileImage,8*d,8*c,8,8,e*this.tileSize+i+s%2*8,a*this.tileSize+A+8*(s>>1),8,8)}}}renderTile(e,t,i,A,r,s,l){e.drawImage(this.tileImage,t,i,8,8,A*this.tileSize+s,r*this.tileSize+l,8,8)}getTile(e,t){return e<0||t<0||e>=this.width||t>=this.height?l.water:h[this.tiles[e+t*this.width]]}getTileState(e,t,i){return e<0||t<0||e>=this.width||t>=this.height?0:6===i?(this.tilesState[e+t*this.width]&i)>>1:this.tilesState[e+t*this.width]&i}setTileState(e,t,i,A){if(!(e<0||t<0||e>=this.width||t>=this.height))if(6===A){const A=this.tilesState[e+t*this.width];this.tilesState[e+t*this.width]=i<<1|1&A}else this.tilesState[e+t*this.width]^=i}setTile(e,t,i){e<0||t<0||e>=this.width||t>=this.height||(this.tiles[e+t*this.width]=i.id)}recalcVisibility(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){let i=this.getTileState(t,e,6);3===i&&(i>>=1),this.setTileState(t,e,i,6)}for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){this.getTileState(t,e,1)&&this.revealTile(t,e,4)}}revealTile(e,t,i){for(let A=t-i;A<=t+i;A++)if(!(A<0||A>=this.height))for(let r=e-i;r<=e+i;r++){if(r<0||r>=this.width)continue;const s=r-e,l=A-t;if(s*s+l*l<=i*i+2){if(0===A||0===r||r===this.width-1||A===this.height-1)continue;this.setTileState(r,A,3,6)}}}}(128,128),D=()=>{!o||u>0||(v.width=window.innerWidth,v.height=window.innerHeight,v.onmousedown=e=>{e.preventDefault(),d=!0,c=!1,g=e.clientX,f=e.clientY},v.onclick=e=>{if(d=!1,!c){const t=Math.floor(w+(v.width/T-2048)/2),i=Math.floor(m+(v.height/T-2048)/2),A=Math.floor((e.clientX/T-t)/16),r=Math.floor((e.clientY/T-i)/16);L(A,r,e.clientX/T,e.clientY/T)}},window.onmousemove=e=>{if(d){e.preventDefault();var t=e.clientX-g,i=e.clientY-f;(c||t*t+i*i>64)&&(c=!0,w+=t/T,m+=i/T,g=e.clientX,f=e.clientY,requestAnimationFrame(z))}},P(),z())};let I=-1,Q=-1,C=!1,H=!1;const L=(e,t,i,A)=>{const r=Math.floor(S.canvas.width/T),s=Math.floor(S.canvas.height/T);if(i>=0&&i<=r&&A>=s-35&&A<=s)k(i,A);else{if(e<0||t<0||e>128||t>128)return I=-1,void(Q=-1);if(I!==e||Q!==t){I=e,Q=t,C=!0;const i=B.getTileState(e,t,n.VISIBLE);H=3===i}requestAnimationFrame(z)}},P=()=>{requestAnimationFrame(P);const e=p.update(w,m,(()=>{C=!1,requestAnimationFrame(z)}));w===e[0]&&m===e[1]||(w=e[0],m=e[1],requestAnimationFrame(z))},z=()=>{T=Math.max(Math.floor(v.height/300+1),Math.floor(v.width/(16/9*300)+1));var e=Math.max(0,2112-v.width/T)/2,t=Math.max(0,2112-v.height/T)/2;w<-e&&(w=-e),m<-t&&(m=-t),w>e&&(w=e),m>t&&(m=t),S.imageSmoothingEnabled=!1,S.setTransform(T,0,0,T,0,0);const i=Math.floor(w+(v.width/T-2048)/2),A=Math.floor(m+(v.height/T-2048)/2);B.render(v,S,i,A,T);for(var r=0;r<y.length;r++){const e=Math.floor(S.canvas.width/T),t=Math.floor(S.canvas.height/T);S.fillStyle="rgba(255, 255, 255, 0.3)",S.fillRect(0,t-35,e,t),b(y[r].name,e/2+2,t-25-5,3),q(y[r].imageX,y[r].imageY,e/2,t-25)}if(C&&(S.strokeStyle="white",S.strokeRect(16*I+i,16*Q+A,16,16),H)){const e=B.getTile(I,Q);b(`Outcome: ${e.getOutcome()}`,16*I+i+18,16*Q+A+6,4)}},X="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",b=(e,t,i,A=8)=>{e=e.toUpperCase();for(var r=0;r<e.length;r++){var s=X.indexOf(e.charAt(r)),l=0+s%32,h=29+(s>>5);S.drawImage(M,8*l,8*h,8,8,t+r*A,i,A,A)}},k=(e,t)=>{const i=Math.floor(S.canvas.width/T)/2,A=Math.floor(S.canvas.height/T)-25;e>=i&&e<=i+16&&t>=A&&t<=A+16&&(B.setTileState(I,Q,1,n.OWNED),B.recalcVisibility(),requestAnimationFrame(z),I=-1,Q=-1)},q=(e,t,i,A)=>{S.beginPath(),S.strokeStyle="yellow",S.rect(i,A,16,16),S.stroke(),S.drawImage(M,8*e,8*t,16,16,i,A,16,16)};

var t=Object.defineProperty,e=("undefined"!=typeof require&&require,(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s));!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var i="data:image/png;base64,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";class s{constructor(t,i){e(this,"x"),e(this,"y"),e(this,"tx",0),e(this,"maxTx",4),e(this,"ty",12),e(this,"movingTx",4),e(this,"maxMovingTx",10),e(this,"xa",0),e(this,"ya",0),e(this,"dirX",0),e(this,"moving",!0),e(this,"animation",0),e(this,"movingAnimation",0),this.x=t,this.y=i}render(t,e,i,s){t.drawImage(e,this.moving?8*this.movingTx:8*this.tx,-1===this.xa||1===this.dirX?8*(this.ty+2):8*this.ty,16,16,16*this.x+i,16*this.y+s,16,16)}update(t){1===this.xa||1===this.ya?(this.moving=!0,this.dirX=0):-1===this.xa||-1===this.ya?(this.moving=!0,this.dirX=1):this.moving=!1,this.move(t)?0===Math.floor(20*Math.random())&&(this.xa=Math.floor(3*Math.random())-1,this.ya=Math.floor(3*Math.random())-1):(this.xa=0,this.ya=0),this.animation+=1,this.movingAnimation+=1,this.animation%5!=0||this.moving||(this.animation=0,this.tx+=2,this.tx%this.maxTx==0&&(this.tx=0)),this.movingAnimation%2==0&&this.moving&&(this.movingAnimation=0,this.movingTx+=2,this.movingTx%this.maxMovingTx==0&&(this.movingTx=4))}move(t){if(0!==this.xa||0!==this.ya){let e=!0;return 0!==this.xa&&this.move2(t,this.xa,0)&&(e=!1),0!==this.ya&&this.move2(t,0,this.ya)&&(e=!1),0===this.xa||0===this.ya||this.move3(t,this.xa,this.ya)||(this.xa=0,this.ya=0),!e}return!0}move3(t,e,i){const s=this.x+e,r=this.y+i;return!!t.getTile(1===e?Math.floor(s):Math.round(s),1===i?Math.floor(r):Math.round(r)).isPassable}move2(t,e,i){const s=this.x-0,r=this.y-0,h=this.x+0,a=this.y+0,n=this.x+e-0,o=this.y+i-0,l=this.x+e+0,d=this.y+i+0;let A=!1;for(let g=o;g<=d;g++)for(let e=n;e<=l;e++)if(!(e>=s&&e<=h&&g>=r&&g<=a||t.getTile(Math.round(e),Math.round(g)).isPassable))return A=!0,!1;return!A&&(this.x+=e/16,this.y+=i/16,!0)}}Math.seed=t=>{const e=4294967295;let i=123456789+t&e,s=987654321-t&e;return()=>{s=36969*(65535&s)+(s>>>16)&e,i=18e3*(65535&i)+(i>>>16)&e;let t=(s<<16)+(65535&i)>>>0;return t/=4294967296,t}};let r=Math.seed(Math.random()*(10+90*Math.random()));class h{constructor(t,i,s){e(this,"w"),e(this,"h"),e(this,"values"),this.w=t,this.h=i,this.values=new Array(t*i);for(let e=0;e<i;e+=s)for(let i=0;i<t;i+=s)this.setSample(i,e,2*r()-1);let h=s,a=1/t,n=1;do{const e=h/2;for(let s=0;s<i;s+=h)for(let i=0;i<t;i+=h){const t=(this.sample(i,s)+this.sample(i+h,s)+this.sample(i,s+h)+this.sample(i+h,s+h))/4+(2*r()-1)*h*a;this.setSample(i+e,s+e,t)}for(let i=0;i<t;i+=h)for(let s=0;s<t;s+=h){const t=this.sample(s,i),n=this.sample(s+h,i),o=this.sample(s,i+h),l=this.sample(s+e,i+e),d=this.sample(s+e,i-e),A=this.sample(s-e,i+e),g=(t+n+l+d)/4+(2*r()-1)*h*a*.5,c=(t+o+l+A)/4+(2*r()-1)*h*a*.5;this.setSample(s+e,i,g),this.setSample(s,i+e,c)}h/=2,a*=n+.8,n*=.3}while(h>1)}sample(t,e){return this.values[(t&this.w-1)+(e&this.h-1)*this.w]}setSample(t,e,i){this.values[(t&this.w-1)+(e&this.h-1)*this.w]=i}}const a=(t,e,i=Math.random()*Number.MAX_SAFE_INTEGER)=>{r=Math.seed(i);const s=new h(t,e,16),a=new h(t,e,16),o=new h(t,e,16),l=new h(t,e,32),d=new h(t,e,32),g=new Array(t*e),c=new Array(t*e);for(let r=0;r<e;r++)for(let i=0;i<t;i++){const h=i+r*t;let n=3*Math.abs(l.values[h]-d.values[h])-2,c=Math.abs(s.values[h]-a.values[h]);c=3*Math.abs(c-o.values[h])-2;let w=i/(t-1)*2-1,m=r/(e-1)*2-1;w<0&&(w=-w),m<0&&(m=-m);let u=w>=m?w:m;u*=u*u*u,u*=u*u*u,n=n+1-20*u,g[h]=n<-.5?A.water.id:n>.5&&c<-1.5?A.rock.id:A.grass.id}for(let h=0;h<t*e/2800;h++){let i=Math.round(r()*t),s=Math.round(r()*e);for(let h=0;h<10;h++){let h=i+Math.round(21*r()-10),a=s+Math.round(21*r()-10);for(let i=0;i<100;i++){let i=h+Math.round(5*r())-Math.round(5*r()),s=a+Math.round(5*r())-Math.round(5*r());for(let r=s-1;r<=s+1;r++)for(let s=i-1;s<=i+1;s++)s>=0&&r>=0&&s<t&&r<e&&1==g[s+r*t]&&(g[s+r*t]=A.sand.id)}}}for(let h=0;h<t*e/400;h++){const i=Math.round(r()*t),s=Math.round(r()*e);for(let h=0;h<200;h++){const h=i+Math.round(15*r())-Math.round(15*r()),a=s+Math.round(15*r())-Math.round(15*r());h>=0&&a>=0&&h<t&&a<e&&g[h+a*t]==A.grass.id&&(g[h+a*t]=A.tree.id)}}for(let h=0;h<t*e/40;h++){const i=Math.round(r()*t),s=Math.round(r()*e);i>=0&&s>=0&&i<t&&s<<e&&g[i+s*t]===A.sand.id&&(g[i+s*t]=A.cactus.id)}for(let h=0;h<t*e/400;h++){const i=Math.round(r()*t),s=Math.round(r()*e);for(let h=0;h<30;h++){const h=i+Math.round(5*r())-Math.round(5*r()),a=s+Math.round(5*r())-Math.round(5*r());h>=0&&a>=0&&h<t&&a<e&&g[h+a*t]==A.grass.id&&(g[h+a*t]=A.flower.id)}}let w=-1,m=-1;for(;-1===w||-1===m;){w=Math.round(r()*t),m=Math.round(r()*e);t:for(let e=m-1;e<=m+1;e++)for(let i=w-1;i<=w+1;i++)if(g[i+e*t]===A.water.id||g[i+e*t]===A.rock.id||g[i+e*t]===A.tree.id){w=-1,m=-1;break t}const i=n(g,t,w,m,3,3,A.tree.id),s=n(g,t,w,m,5,1,A.rock.id);i&&s||(w=-1,m=-1)}return g[w+m*t]=A.startingPosition.id,[g,c]},n=(t,e,i,s,r,h,a)=>{let n=0;for(let o=s-r;o<=s+r;o++)for(let s=i-r;s<=i+r;s++)t[s+o*e]===a&&n++;return n>=h},o={wood:{imageX:0,imageY:11},stone:{imageX:1,imageY:11}};class l{constructor(t){e(this,"id"),e(this,"isFarmable",!1),e(this,"isPassable",!0),e(this,"isOnGrass",!1),e(this,"isOnSand",!1),e(this,"color",0),this.id=t}update(t,e,i){}getOutcome(){}}class d extends l{constructor(t){super(t),this.color=1096065}render(t,e,i,s,r,h){const a=t.getTile(i,s-1).id===this.id||t.getTile(i,s-1).id===A.tree.id||t.getTile(i,s-1).id===A.flower.id,n=t.getTile(i,s+1).id===this.id||t.getTile(i,s+1).id===A.tree.id||t.getTile(i,s+1).id===A.flower.id,o=t.getTile(i-1,s).id===this.id||t.getTile(i-1,s).id===A.tree.id||t.getTile(i-1,s).id===A.flower.id,l=t.getTile(i+1,s).id===this.id||t.getTile(i+1,s).id===A.tree.id||t.getTile(i+1,s).id===A.flower.id,d=t.getTile(i-1,s-1).id===this.id||t.getTile(i-1,s-1).id===A.tree.id||t.getTile(i-1,s-1).id===A.flower.id,g=t.getTile(i+1,s-1).id===this.id||t.getTile(i+1,s-1).id===A.tree.id||t.getTile(i+1,s-1).id===A.flower.id,c=t.getTile(i-1,s+1).id===this.id||t.getTile(i-1,s+1).id===A.tree.id||t.getTile(i-1,s+1).id===A.flower.id,w=t.getTile(i+1,s+1).id===this.id||t.getTile(i+1,s+1).id===A.tree.id||t.getTile(i+1,s+1).id===A.flower.id;a||o?a&&o&&!d?t.renderTile(e,32,32,i,s,r,h):t.renderTile(e,o?8:0,a?32:24,i,s,r,h):t.renderTile(e,0,24,i,s,r,h),a||l?a&&l&&!g?t.renderTile(e,24,32,i,s,r+8,h):t.renderTile(e,l?8:16,a?32:24,i,s,r+8,h):t.renderTile(e,16,24,i,s,r+8,h),n||o?n&&o&&!c?t.renderTile(e,32,24,i,s,r,h+8):t.renderTile(e,o?8:0,n?32:40,i,s,r,h+8):t.renderTile(e,0,40,i,s,r,h+8),n||l?n&&l&&!w?t.renderTile(e,24,24,i,s,r+8,h+8):t.renderTile(e,l?8:16,n?32:40,i,s,r+8,h+8):t.renderTile(e,16,40,i,s,r+8,h+8)}}const A={water:new class extends l{constructor(t){super(t),e(this,"position1",0),e(this,"position2",0),e(this,"position3",0),e(this,"position4",0),e(this,"shouldAnimate",!0),this.isPassable=!1,this.color=3900150}render(t,e,i,s,r,h){this.shouldAnimate&&(this.position1=Math.round(3+3*Math.random()),this.position2=Math.round(3+3*Math.random()),this.position3=Math.round(3+3*Math.random()),this.position4=Math.round(3+3*Math.random()),this.shouldAnimate=!1);const a=t.getTile(i,s-1).id===this.id,n=t.getTile(i,s+1).id===this.id,o=t.getTile(i-1,s).id===this.id,l=t.getTile(i+1,s).id===this.id,d=t.getTile(i-1,s-1).id===this.id,A=t.getTile(i+1,s-1).id===this.id;a||o?a&&o&&!d?t.renderTile(e,32,8,i,s,r,h):a&&o?t.renderTile(e,8*this.position1,16,i,s,r,h):t.renderTile(e,o?8:0,a?8:0,i,s,r,h):t.renderTile(e,0,0,i,s,r,h),a||l?a&&l&&!A?t.renderTile(e,24,8,i,s,r+8,h):a&&l?t.renderTile(e,8*this.position2,16,i,s,r+8,h):t.renderTile(e,l?8:16,a?8:0,i,s,r+8,h):t.renderTile(e,16,0,i,s,r+8,h),n||o?n&&o?t.renderTile(e,8*this.position3,16,i,s,r,h+8):t.renderTile(e,o?8:0,n?8:16,i,s,r,h+8):t.renderTile(e,0,16,i,s,r,h+8),n||l?n&&l?t.renderTile(e,8*this.position4,16,i,s,r+8,h+8):t.renderTile(e,l?8:16,n?8:16,i,s,r+8,h+8):t.renderTile(e,16,16,i,s,r+8,h+8),a&&!o&&d&&t.renderTile(e,32,0,i,s,r,h-8),a&&!l&&A&&t.renderTile(e,24,0,i,s,r+8,h-8)}update(t,e,i){t.tickCount%10==0&&(this.shouldAnimate=!0)}}(0),grass:new d(1),sand:new class extends l{constructor(t){super(t),this.color=16498468}render(t,e,i,s,r,h){t.renderTile(e,40,0,i,s,r,h),t.renderTile(e,40,0,i,s,r+8,h),t.renderTile(e,40,0,i,s,r,h+8),t.renderTile(e,40,0,i,s,r+8,h+8)}}(2),tree:new class extends l{constructor(t){super(t),this.isFarmable=!0,this.isPassable=!1,this.isOnGrass=!0,this.color=417606}render(t,e,i,s,r,h){t.onTopTiles.find((t=>t.x===i&&t.y===s))||(t.onTopTiles.push({sx:16,sy:72,x:i,y:s,xExtraOffset:0,yExtraOffset:0}),t.onTopTiles.push({sx:24,sy:72,x:i,y:s,xExtraOffset:8,yExtraOffset:0})),t.renderTile(e,16,80,i,s,r,h+8),t.renderTile(e,24,80,i,s,r+8,h+8)}getOutcome(){return{amount:3,type:"wood"}}}(3),rock:new class extends l{constructor(t){super(t),this.isFarmable=!0,this.isPassable=!1,this.color=10265519}render(t,e,i,s,r,h){const a=t.getTile(i,s-1).id===this.id,n=t.getTile(i,s+1).id===this.id,o=t.getTile(i-1,s).id===this.id,l=t.getTile(i+1,s).id===this.id,d=t.getTile(i-1,s-1).id===this.id,A=t.getTile(i+1,s-1).id===this.id,g=t.getTile(i-1,s+1).id===this.id,c=t.getTile(i+1,s+1).id===this.id;a||o?a&&o&&!d?t.renderTile(e,32,56,i,s,r,h):t.renderTile(e,o?8:0,a?56:48,i,s,r,h):t.renderTile(e,0,48,i,s,r,h),a||l?a&&l&&!A?t.renderTile(e,24,56,i,s,r+8,h):t.renderTile(e,l?8:16,a?56:48,i,s,r+8,h):t.renderTile(e,16,48,i,s,r+8,h),n||o?n&&o&&!g?t.renderTile(e,32,48,i,s,r,h+8):t.renderTile(e,o?8:0,n?56:64,i,s,r,h+8):t.renderTile(e,0,64,i,s,r,h+8),n||l?n&&l&&!c?t.renderTile(e,24,48,i,s,r+8,h+8):t.renderTile(e,l?8:16,n?56:64,i,s,r+8,h+8):t.renderTile(e,16,64,i,s,r+8,h+8)}getOutcome(){return{amount:3,type:"stone"}}}(4),flower:new class extends l{constructor(t){super(t),this.isOnGrass=!0,this.color=1096065}render(t,e,i,s,r,h){t.renderTile(e,48,0,i,s,r+4,h+4)}}(5),cactus:new class extends l{constructor(t){super(t),this.isOnSand=!0,this.color=16498468}render(t,e,i,s,r,h){t.renderTile(e,56,0,i,s,r,h),t.renderTile(e,64,0,i,s,r+8,h),t.renderTile(e,56,8,i,s,r,h+8),t.renderTile(e,64,8,i,s,r+8,h+8)}}(6),dirt:new class extends l{constructor(t){super(t),this.color=7877903}render(t,e,i,s,r,h){const a=t.getTile(i,s-1).id===this.id,n=t.getTile(i,s+1).id===this.id,o=t.getTile(i-1,s).id===this.id,l=t.getTile(i+1,s).id===this.id,d=t.getTile(i-1,s-1).id===this.id,A=t.getTile(i+1,s-1).id===this.id,g=t.getTile(i-1,s+1).id===this.id,c=t.getTile(i+1,s+1).id===this.id;a||o?a&&o&&!d?t.renderTile(e,72,32,i,s,r,h):t.renderTile(e,o?48:40,a?32:24,i,s,r,h):t.renderTile(e,40,24,i,s,r,h),a||l?a&&l&&!A?t.renderTile(e,64,32,i,s,r+8,h):t.renderTile(e,l?48:56,a?32:24,i,s,r+8,h):t.renderTile(e,56,24,i,s,r+8,h),n||o?n&&o&&!g?t.renderTile(e,72,24,i,s,r,h+8):t.renderTile(e,o?48:40,n?32:40,i,s,r,h+8):t.renderTile(e,40,40,i,s,r,h+8),n||l?n&&l&&!c?t.renderTile(e,64,24,i,s,r+8,h+8):t.renderTile(e,l?48:56,n?32:40,i,s,r+8,h+8):t.renderTile(e,56,40,i,s,r+8,h+8)}}(7),startingPosition:new d(999)},g=Object.entries(A).map((([t,e])=>e));var c,w;(w=c||(c={}))[w.OWNED=1]="OWNED",w[w.VISIBLE=6]="VISIBLE";class m{constructor(t,i,s){e(this,"map2d"),e(this,"imageData"),e(this,"minimapCanvas",document.createElement("canvas")),e(this,"width"),e(this,"height"),this.map2d=t,this.width=i,this.height=s,this.imageData=t.createImageData(i,s),this.minimapCanvas.width=this.imageData.width,this.minimapCanvas.height=this.imageData.height}getRGB(t){return[t>>16&255,t>>8&255,255&t]}render(t,e,i,s){const r=Math.floor(this.map2d.canvas.width/s)-t.width/(i+s+10)-8,h=Math.round(t.width/(i+s+10));for(let a=0;a<this.height;a++)for(let t=0;t<this.width;t++){const i=t+a*this.width,s=e.getTile(t,a),[r,h,n]=this.getRGB(s.color);e.getTileState(t,a,c.OWNED)?(this.imageData.data[4*i]=255,this.imageData.data[4*i+1]=0,this.imageData.data[4*i+2]=0,this.imageData.data[4*i+3]=255):e.getTileState(t,a,c.VISIBLE)>=1?(this.imageData.data[4*i]=r,this.imageData.data[4*i+1]=h,this.imageData.data[4*i+2]=n,this.imageData.data[4*i+3]=255):(this.imageData.data[4*i]=0,this.imageData.data[4*i+1]=0,this.imageData.data[4*i+2]=0,this.imageData.data[4*i+3]=255)}this.minimapCanvas.getContext("2d").putImageData(this.imageData,0,0),this.map2d.drawImage(this.minimapCanvas,r,8,h,h),this.map2d.strokeStyle="rgba(255, 255, 255, 0.35)",this.map2d.strokeRect(r,8,h,h)}}let u=!1,f=!1;window.onload=()=>{u=!0,L()};let T=!1,p=!1,M=0,x=0,D=0,v=0,y=0,B=0;let O=3;let S=0;const C=(t=>{const e=new Image;return S++,e.onload=()=>{S--,0===S&&L()},e.src=t,e})(i),H=document.querySelector("#map"),P=H.getContext("2d"),I=new class{constructor(){e(this,"scrollX",0),e(this,"scrollY",0),e(this,"scrollSpeed",3),e(this,"keys",[]),window.onkeydown=t=>{this.keys[t.keyCode]=!0},window.onkeyup=t=>{this.keys[t.keyCode]=!1}}update(t,e,i,s){return this.scrollX=t,this.scrollY=e,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&i&&i(),this.keys[49]&&s&&s(),[this.scrollX,this.scrollY]}};let Q;const b=new Array(1);for(let _=0;_<b.length;_++)b[_]={name:"Base",imageX:0,imageY:9};const E=new class{constructor(t,s,r){e(this,"tiles"),e(this,"data"),e(this,"tilesState"),e(this,"tileSize",16),e(this,"tickCount",0),e(this,"tileImage"),e(this,"imagesToLoad",0),e(this,"width"),e(this,"height"),e(this,"seed"),e(this,"entities",[]),e(this,"onTopTiles",[]),this.width=t,this.height=s,this.seed=r,this.tiles=new Array(t*s),this.data=new Array(t*s),this.tilesState=new Array(t*s),this.tileImage=this.loadImage(i)}loadImage(t){var e=new Image;return this.imagesToLoad++,e.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},e.src=t,e}init(){const t=((t,e,i=Math.random()*Number.MAX_SAFE_INTEGER)=>{for(;;){const s=a(t,e,i),r=new Array(256);for(let i=0;i<t*e;i++)r[255&s[0][i]]++;if(!(r[255&A.rock.id]<100||r[255&A.sand.id]<100||r[255&A.grass.id]<100||r[255&A.tree.id]<100))return s}})(this.width,this.height,this.seed);this.tiles=t[0],this.tilesState=[...t[1]],this.data=[...t[1]],this.tilesState.fill(0);for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){if(this.tiles[t+e*this.width]===A.startingPosition.id)for(let i=0;i<5;i++)this.entities.push(new s(t,e))}}update(){this.tickCount++,this.tickCount>=Number.MAX_VALUE&&(this.tickCount=0);for(let t=0;t<this.width*this.height/50;t++){const t=Math.round(Math.random()*this.width),e=Math.round(Math.random()*this.height);this.getTile(t,e).update(this,t,e)}this.entities.forEach((t=>t.update(this)))}render(t,e,i,s,r){const h=Math.floor(-i/this.tileSize),a=Math.floor(-s/this.tileSize),n=Math.ceil((-i+t.width/r)/this.tileSize),o=Math.ceil((-s+t.height/r)/this.tileSize);for(let l=a;l<o;l++)for(let t=h;t<n;t++){const r=this.getTile(t,l),h=this.getTileState(t,l,1);if(r.isOnGrass){g.find((t=>t.id===A.grass.id)).render(this,e,t,l,i,s)}else if(r.isOnSand){g.find((t=>t.id===A.sand.id)).render(this,e,t,l,i,s)}r.render(this,e,t,l,i,s),1===h&&e.drawImage(this.tileImage,0,72,16,16,t*this.tileSize+i,l*this.tileSize+s,16,16)}this.entities.forEach((t=>t.render(e,this.tileImage,i,s))),this.onTopTiles.forEach((t=>{this.renderTile(e,t.sx,t.sy,t.x,t.y,t.xExtraOffset+i,t.yExtraOffset+s)}));for(let l=a;l<o;l++)for(let t=h;t<n;t++){const r=this.getTileState(t,l,6);if(1===r)e.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+i+0,l*this.tileSize+s+0,8,8),e.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+i+8,l*this.tileSize+s+0,8,8),e.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+i+0,l*this.tileSize+s+8,8,8),e.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+i+8,l*this.tileSize+s+8,8,8);else for(let h=0;h<4;h++){const a=h%2*2-1,n=2*(h>>1)-1,o=this.getTileState(t,l+n,6)!==r,d=this.getTileState(t+a,l,6)!==r;let A=25,g=1;3===r&&(g+=3),o&&(g+=n),d&&(A+=a),e.drawImage(this.tileImage,8*A,8*g,8,8,t*this.tileSize+i+h%2*8,l*this.tileSize+s+8*(h>>1),8,8)}}}renderTile(t,e,i,s,r,h,a){t.drawImage(this.tileImage,e,i,8,8,s*this.tileSize+h,r*this.tileSize+a,8,8)}getTile(t,e){if(t<0||e<0||t>=this.width||e>=this.height)return A.water;const i=g.find((i=>this.tiles[t+e*this.width]===i.id));return null!=i?i:A.water}getTileState(t,e,i){return t<0||e<0||t>=this.width||e>=this.height?0:6===i?(this.tilesState[t+e*this.width]&i)>>1:this.tilesState[t+e*this.width]&i}setTileState(t,e,i,s){if(!(t<0||e<0||t>=this.width||e>=this.height))if(6===s){const s=this.tilesState[t+e*this.width];this.tilesState[t+e*this.width]=i<<1|1&s}else this.tilesState[t+e*this.width]^=i,this.tiles[t+e*this.width]=A.dirt.id}setTile(t,e,i){t<0||e<0||t>=this.width||e>=this.height||(this.tiles[t+e*this.width]=i.id)}setData(t,e,i){t<0||e<0||t>=this.width||e>=this.height||(this.data[t+e*this.width]=i)}getData(t,e){return t<0||e<0||t>=this.width||e>=this.height?0:255&this.data[t+e*this.width]}recalcVisibility(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++){let i=this.getTileState(e,t,6);3===i&&(i>>=1),this.setTileState(e,t,i,6)}for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++){this.getTileState(e,t,1)&&this.revealTile(e,t,4)}}revealTile(t,e,i){for(let s=e-i;s<=e+i;s++)if(!(s<0||s>=this.height))for(let r=t-i;r<=t+i;r++){if(r<0||r>=this.width)continue;const h=r-t,a=s-e;if(h*h+a*a<=i*i+2){if(0===s||0===r||r===this.width-1||s===this.height-1)continue;this.setTileState(r,s,3,6)}}}}(128,128),L=()=>{if(u&&!(S>0)){if(H.width=window.innerWidth,H.height=window.innerHeight,Q=new m(P,128,128),H.onmousedown=t=>{t.preventDefault(),T=!0,p=!1,M=t.clientX,x=t.clientY},H.onclick=t=>{if(T=!1,!p){const e=Math.floor(D+16*-y+window.innerWidth/O/2),i=Math.floor(v+16*-B+window.innerHeight/O/2),s=Math.floor((t.clientX/O-e)/16),r=Math.floor((t.clientY/O-i)/16);Y(s,r,t.clientX/O,t.clientY/O)}},window.onmousemove=t=>{if(!T)return;t.preventDefault();const e=t.clientX-M,i=t.clientY-x;(p||e*e+i*i>64)&&(p=!0,D+=e/O,v+=i/O,M=t.clientX,x=t.clientY)},!f){for(let t=0;t<128;t++)for(let e=0;e<128;e++){const i=e+128*t;E.tiles[i]===A.startingPosition.id&&(y=e,B=t,E.setTileState(y,B,1,c.OWNED),E.recalcVisibility())}U(),f=!0}j()}};window.onresize=L;let X=null,z=null,F=!1;const Y=(t,e,i=800,s=600)=>{const r=Math.floor(P.canvas.width/O),h=Math.floor(P.canvas.height/O);if(i>=0&&i<=r&&s>=h-35&&s<=h&&X&&z){return void(E.getTile(X,z).isPassable&&V(i,s))}if(t<0||e<0||t>128||e>128)return X=null,void(z=null);const a=E.getTileState(t,e,c.VISIBLE);if(0===a)return X=null,void(z=null);X===t&&z===e||(X=t,z=e,F=3===a)};let k=Date.now(),N=Date.now(),W=0;const U=()=>{requestAnimationFrame(U),k=N,N=Date.now(),W+=N-k,W>=60&&(W=0,K());const t=I.update(D,v,(()=>{}),(()=>{if(X&&z){for(let t=0;t<5;t++)E.entities.push(new s(X,z));E.setTileState(X,z,1,c.OWNED),E.recalcVisibility(),X=null,z=null}}));D===t[0]&&v===t[1]||(D=t[0],v=t[1]),j()},K=()=>{E.update()},j=()=>{O=Math.max(Math.floor(H.height/300+1),Math.floor(H.width/(16/9*300)+1)),D>16*y&&(D=16*y),v>16*B&&(v=16*B),D<16*y-2016&&(D=16*y-2016),v<16*B-2016&&(v=16*B-2016),P.imageSmoothingEnabled=!1,P.setTransform(O,0,0,O,0,0);const t=Math.floor(D+16*-y+window.innerWidth/O/2),e=Math.floor(v+16*-B+window.innerHeight/O/2);E.render(H,P,t,e,O);for(var i=0;i<b.length;i++){const t=Math.floor(P.canvas.width/O),e=Math.floor(P.canvas.height/O);P.fillStyle="rgba(255, 255, 255, 0.3)",P.fillRect(0,e-35,t,e),J(b[i].name,t/2+2,e-25-5,3),Z(b[i].imageX,b[i].imageY,t/2,e-25)}if(X&&z&&(P.strokeStyle="white",P.strokeRect(16*X+t,16*z+e,16,16),F)){const i=E.getTile(X,z).getOutcome();i&&(P.fillStyle="rgba(0, 0, 0, 0.3)",P.fillRect(16*X+t+16,16*z+e,18,16),P.drawImage(C,8*o[i.type].imageX,8*o[i.type].imageY,8,8,16*X+t+18,16*z+e+4,8,8),J(`${i.amount}`,16*X+t+27,16*z+e+5,5))}G(),Q.render(H,E,16,O)},R=[{imageX:0,imageY:11},{imageX:1,imageY:11}],G=()=>{for(let t=0;t<R.length;t++)P.drawImage(C,8*R[t].imageX,8*R[t].imageY,8,8,4,4+14*t,8,8),J("0",14,5+14*t,6)},q="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",J=(t,e,i,s=8)=>{t=t.toUpperCase();for(var r=0;r<t.length;r++){var h=q.indexOf(t.charAt(r)),a=0+h%32,n=29+(h>>5);P.drawImage(C,8*a,8*n,8,8,e+r*s,i,s,s)}},V=(t,e)=>{const i=Math.floor(P.canvas.width/O)/2,s=Math.floor(P.canvas.height/O)-25;t>=i&&t<=i+16&&e>=s&&e<=s+16&&X&&z&&(E.setTileState(X,z,1,c.OWNED),E.recalcVisibility(),X=null,z=null)},Z=(t,e,i,s)=>{P.beginPath(),P.strokeStyle="yellow",P.rect(i,s,16,16),P.stroke(),P.drawImage(C,8*t,8*e,16,16,i,s,16,16)};

var t=Object.defineProperty,e=("undefined"!=typeof require&&require,(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s));!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var i="data:image/png;base64,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";class s{constructor(t,i){e(this,"x"),e(this,"y"),e(this,"tx",0),e(this,"maxTx",8),e(this,"ty",12),e(this,"movingTx",8),e(this,"movingTy",12),e(this,"maxMovingTx",24),e(this,"xa",0),e(this,"ya",0),e(this,"moving",!0),e(this,"animation",0),this.x=t,this.y=i}render(t,e,i,s){t.drawImage(e,this.moving?8*this.movingTx:8*this.tx,this.moving?-1===this.xa?8*(this.movingTy+2):8*this.movingTy:8*this.ty,16,16,16*this.x+i,16*this.y+s,16,16)}update(t){1===this.xa||1===this.ya||-1===this.xa||-1===this.ya?this.moving=!0:this.moving=!1,this.move(t)?0===Math.floor(10*Math.random())&&(this.xa=Math.floor(3*Math.random())-1,this.ya=Math.floor(3*Math.random())-1):(this.xa=0,this.ya=0),this.animation+=1,this.animation%2==0&&(this.animation=0,this.moving?(this.movingTx+=2,this.movingTx%this.maxMovingTx==0&&(this.movingTx=8)):(this.tx+=2,this.tx%this.maxTx==0&&(this.tx=0)))}move(t){if(0!==this.xa||0!==this.ya){let e=!0;return 0!==this.xa&&this.move2(t,this.xa,0)&&(e=!1),0!==this.ya&&this.move2(t,0,this.ya)&&(e=!1),!e}return!0}move2(t,e,i){const s=Math.round(this.x+e),r=Math.round(this.y+i),h=Math.round(this.x+e),a=Math.round(this.y+i+1);let n=!1;for(let A=r;A<=a;A++)for(let e=s;e<=h;e++)if(!t.getTile(e,A).isPassable)return n=!0,!1;return!n&&(this.x+=e/16,this.y+=i/16,!0)}}Math.seed=t=>{const e=4294967295;let i=123456789+t&e,s=987654321-t&e;return()=>{s=36969*(65535&s)+(s>>>16)&e,i=18e3*(65535&i)+(i>>>16)&e;let t=(s<<16)+(65535&i)>>>0;return t/=4294967296,t}};let r=Math.seed(Math.random()*(10+90*Math.random()));class h{constructor(t,i,s){e(this,"w"),e(this,"h"),e(this,"values"),this.w=t,this.h=i,this.values=new Array(t*i);for(let e=0;e<i;e+=s)for(let i=0;i<t;i+=s)this.setSample(i,e,2*r()-1);let h=s,a=1/t,n=1;do{const e=h/2;for(let s=0;s<i;s+=h)for(let i=0;i<t;i+=h){const t=(this.sample(i,s)+this.sample(i+h,s)+this.sample(i,s+h)+this.sample(i+h,s+h))/4+(2*r()-1)*h*a;this.setSample(i+e,s+e,t)}for(let i=0;i<t;i+=h)for(let s=0;s<t;s+=h){const t=this.sample(s,i),n=this.sample(s+h,i),A=this.sample(s,i+h),l=this.sample(s+e,i+e),o=this.sample(s+e,i-e),d=this.sample(s-e,i+e),g=(t+n+l+o)/4+(2*r()-1)*h*a*.5,c=(t+A+l+d)/4+(2*r()-1)*h*a*.5;this.setSample(s+e,i,g),this.setSample(s,i+e,c)}h/=2,a*=n+.8,n*=.3}while(h>1)}sample(t,e){return this.values[(t&this.w-1)+(e&this.h-1)*this.w]}setSample(t,e,i){this.values[(t&this.w-1)+(e&this.h-1)*this.w]=i}}const a=(t,e,i=Math.random()*Number.MAX_SAFE_INTEGER)=>{r=Math.seed(i);const s=new h(t,e,16),a=new h(t,e,16),A=new h(t,e,16),l=new h(t,e,32),o=new h(t,e,32),g=new Array(t*e),c=new Array(t*e);for(let r=0;r<e;r++)for(let i=0;i<t;i++){const h=i+r*t;let n=3*Math.abs(l.values[h]-o.values[h])-2,c=Math.abs(s.values[h]-a.values[h]);c=3*Math.abs(c-A.values[h])-2;let w=i/(t-1)*2-1,u=r/(e-1)*2-1;w<0&&(w=-w),u<0&&(u=-u);let m=w>=u?w:u;m*=m*m*m,m*=m*m*m,n=n+1-20*m,g[h]=n<-.5?d.water.id:n>.5&&c<-1.5?d.rock.id:d.grass.id}for(let h=0;h<t*e/2800;h++){let i=Math.round(r()*t),s=Math.round(r()*e);for(let h=0;h<10;h++){let h=i+Math.round(21*r()-10),a=s+Math.round(21*r()-10);for(let i=0;i<100;i++){let i=h+Math.round(5*r())-Math.round(5*r()),s=a+Math.round(5*r())-Math.round(5*r());for(let r=s-1;r<=s+1;r++)for(let s=i-1;s<=i+1;s++)s>=0&&r>=0&&s<t&&r<e&&1==g[s+r*t]&&(g[s+r*t]=d.sand.id)}}}for(let h=0;h<t*e/400;h++){const i=Math.round(r()*t),s=Math.round(r()*e);for(let h=0;h<200;h++){const h=i+Math.round(15*r())-Math.round(15*r()),a=s+Math.round(15*r())-Math.round(15*r());h>=0&&a>=0&&h<t&&a<e&&g[h+a*t]==d.grass.id&&(g[h+a*t]=d.tree.id)}}for(let h=0;h<t*e/40;h++){const i=Math.round(r()*t),s=Math.round(r()*e);i>=0&&s>=0&&i<t&&s<<e&&g[i+s*t]===d.sand.id&&(g[i+s*t]=d.cactus.id)}for(let h=0;h<t*e/400;h++){const i=Math.round(r()*t),s=Math.round(r()*e);for(let h=0;h<30;h++){const h=i+Math.round(5*r())-Math.round(5*r()),a=s+Math.round(5*r())-Math.round(5*r());h>=0&&a>=0&&h<t&&a<e&&g[h+a*t]==d.grass.id&&(g[h+a*t]=d.flower.id)}}let w=-1,u=-1;for(;-1===w||-1===u;){w=Math.round(r()*t),u=Math.round(r()*e);t:for(let e=u-1;e<=u+1;e++)for(let i=w-1;i<=w+1;i++)if(g[i+e*t]===d.water.id||g[i+e*t]===d.rock.id||g[i+e*t]===d.tree.id){w=-1,u=-1;break t}const i=n(g,t,w,u,3,3,d.tree.id),s=n(g,t,w,u,5,1,d.rock.id);i&&s||(w=-1,u=-1)}return g[w+u*t]=d.startingPosition.id,[g,c]},n=(t,e,i,s,r,h,a)=>{let n=0;for(let A=s-r;A<=s+r;A++)for(let s=i-r;s<=i+r;s++)t[s+A*e]===a&&n++;return n>=h},A={wood:{imageX:0,imageY:11},stone:{imageX:1,imageY:11}};class l{constructor(t){e(this,"id"),e(this,"isFarmable",!1),e(this,"isPassable",!0),e(this,"isOnGrass",!1),e(this,"isOnSand",!1),e(this,"color",0),this.id=t}update(t,e,i){}getOutcome(){}}class o extends l{constructor(t){super(t),this.color=1096065}render(t,e,i,s,r,h){const a=t.getTile(i,s-1).id===this.id||t.getTile(i,s-1).id===d.tree.id||t.getTile(i,s-1).id===d.flower.id,n=t.getTile(i,s+1).id===this.id||t.getTile(i,s+1).id===d.tree.id||t.getTile(i,s+1).id===d.flower.id,A=t.getTile(i-1,s).id===this.id||t.getTile(i-1,s).id===d.tree.id||t.getTile(i-1,s).id===d.flower.id,l=t.getTile(i+1,s).id===this.id||t.getTile(i+1,s).id===d.tree.id||t.getTile(i+1,s).id===d.flower.id,o=t.getTile(i-1,s-1).id===this.id||t.getTile(i-1,s-1).id===d.tree.id||t.getTile(i-1,s-1).id===d.flower.id,g=t.getTile(i+1,s-1).id===this.id||t.getTile(i+1,s-1).id===d.tree.id||t.getTile(i+1,s-1).id===d.flower.id,c=t.getTile(i-1,s+1).id===this.id||t.getTile(i-1,s+1).id===d.tree.id||t.getTile(i-1,s+1).id===d.flower.id,w=t.getTile(i+1,s+1).id===this.id||t.getTile(i+1,s+1).id===d.tree.id||t.getTile(i+1,s+1).id===d.flower.id;a||A?a&&A&&!o?t.renderTile(e,32,32,i,s,r,h):t.renderTile(e,A?8:0,a?32:24,i,s,r,h):t.renderTile(e,0,24,i,s,r,h),a||l?a&&l&&!g?t.renderTile(e,24,32,i,s,r+8,h):t.renderTile(e,l?8:16,a?32:24,i,s,r+8,h):t.renderTile(e,16,24,i,s,r+8,h),n||A?n&&A&&!c?t.renderTile(e,32,24,i,s,r,h+8):t.renderTile(e,A?8:0,n?32:40,i,s,r,h+8):t.renderTile(e,0,40,i,s,r,h+8),n||l?n&&l&&!w?t.renderTile(e,24,24,i,s,r+8,h+8):t.renderTile(e,l?8:16,n?32:40,i,s,r+8,h+8):t.renderTile(e,16,40,i,s,r+8,h+8)}}const d={water:new class extends l{constructor(t){super(t),e(this,"position1",0),e(this,"position2",0),e(this,"position3",0),e(this,"position4",0),e(this,"shouldAnimate",!0),this.isPassable=!1,this.color=3900150}render(t,e,i,s,r,h){this.shouldAnimate&&(this.position1=Math.round(3+3*Math.random()),this.position2=Math.round(3+3*Math.random()),this.position3=Math.round(3+3*Math.random()),this.position4=Math.round(3+3*Math.random()),this.shouldAnimate=!1);const a=t.getTile(i,s-1).id===this.id,n=t.getTile(i,s+1).id===this.id,A=t.getTile(i-1,s).id===this.id,l=t.getTile(i+1,s).id===this.id,o=t.getTile(i-1,s-1).id===this.id,d=t.getTile(i+1,s-1).id===this.id;a||A?a&&A&&!o?t.renderTile(e,32,8,i,s,r,h):a&&A?t.renderTile(e,8*this.position1,16,i,s,r,h):t.renderTile(e,A?8:0,a?8:0,i,s,r,h):t.renderTile(e,0,0,i,s,r,h),a||l?a&&l&&!d?t.renderTile(e,24,8,i,s,r+8,h):a&&l?t.renderTile(e,8*this.position2,16,i,s,r+8,h):t.renderTile(e,l?8:16,a?8:0,i,s,r+8,h):t.renderTile(e,16,0,i,s,r+8,h),n||A?n&&A?t.renderTile(e,8*this.position3,16,i,s,r,h+8):t.renderTile(e,A?8:0,n?8:16,i,s,r,h+8):t.renderTile(e,0,16,i,s,r,h+8),n||l?n&&l?t.renderTile(e,8*this.position4,16,i,s,r+8,h+8):t.renderTile(e,l?8:16,n?8:16,i,s,r+8,h+8):t.renderTile(e,16,16,i,s,r+8,h+8),a&&!A&&o&&t.renderTile(e,32,0,i,s,r,h-8),a&&!l&&d&&t.renderTile(e,24,0,i,s,r+8,h-8)}update(t,e,i){t.tickCount%10==0&&(this.shouldAnimate=!0)}}(0),grass:new o(1),sand:new class extends l{constructor(t){super(t),this.color=16498468}render(t,e,i,s,r,h){t.renderTile(e,40,0,i,s,r,h),t.renderTile(e,40,0,i,s,r+8,h),t.renderTile(e,40,0,i,s,r,h+8),t.renderTile(e,40,0,i,s,r+8,h+8)}}(2),tree:new class extends l{constructor(t){super(t),this.isFarmable=!0,this.isPassable=!1,this.isOnGrass=!0,this.color=417606}render(t,e,i,s,r,h){t.renderTile(e,16,72,i,s,r,h),t.renderTile(e,24,72,i,s,r+8,h),t.renderTile(e,16,80,i,s,r,h+8),t.renderTile(e,24,80,i,s,r+8,h+8)}getOutcome(){return{amount:3,type:"wood"}}}(3),rock:new class extends l{constructor(t){super(t),this.isFarmable=!0,this.isPassable=!1,this.color=10265519}render(t,e,i,s,r,h){const a=t.getTile(i,s-1).id===this.id,n=t.getTile(i,s+1).id===this.id,A=t.getTile(i-1,s).id===this.id,l=t.getTile(i+1,s).id===this.id,o=t.getTile(i-1,s-1).id===this.id,d=t.getTile(i+1,s-1).id===this.id,g=t.getTile(i-1,s+1).id===this.id,c=t.getTile(i+1,s+1).id===this.id;a||A?a&&A&&!o?t.renderTile(e,32,56,i,s,r,h):t.renderTile(e,A?8:0,a?56:48,i,s,r,h):t.renderTile(e,0,48,i,s,r,h),a||l?a&&l&&!d?t.renderTile(e,24,56,i,s,r+8,h):t.renderTile(e,l?8:16,a?56:48,i,s,r+8,h):t.renderTile(e,16,48,i,s,r+8,h),n||A?n&&A&&!g?t.renderTile(e,32,48,i,s,r,h+8):t.renderTile(e,A?8:0,n?56:64,i,s,r,h+8):t.renderTile(e,0,64,i,s,r,h+8),n||l?n&&l&&!c?t.renderTile(e,24,48,i,s,r+8,h+8):t.renderTile(e,l?8:16,n?56:64,i,s,r+8,h+8):t.renderTile(e,16,64,i,s,r+8,h+8)}getOutcome(){return{amount:3,type:"stone"}}}(4),flower:new class extends l{constructor(t){super(t),this.isOnGrass=!0,this.color=1096065}render(t,e,i,s,r,h){t.renderTile(e,48,0,i,s,r+4,h+4)}}(5),cactus:new class extends l{constructor(t){super(t),this.isOnSand=!0,this.color=16498468}render(t,e,i,s,r,h){t.renderTile(e,56,0,i,s,r,h),t.renderTile(e,64,0,i,s,r+8,h),t.renderTile(e,56,8,i,s,r,h+8),t.renderTile(e,64,8,i,s,r+8,h+8)}}(6),dirt:new class extends l{constructor(t){super(t),this.color=7877903}render(t,e,i,s,r,h){const a=t.getTile(i,s-1).id===this.id,n=t.getTile(i,s+1).id===this.id,A=t.getTile(i-1,s).id===this.id,l=t.getTile(i+1,s).id===this.id,o=t.getTile(i-1,s-1).id===this.id,d=t.getTile(i+1,s-1).id===this.id,g=t.getTile(i-1,s+1).id===this.id,c=t.getTile(i+1,s+1).id===this.id;a||A?a&&A&&!o?t.renderTile(e,72,32,i,s,r,h):t.renderTile(e,A?48:40,a?32:24,i,s,r,h):t.renderTile(e,40,24,i,s,r,h),a||l?a&&l&&!d?t.renderTile(e,64,32,i,s,r+8,h):t.renderTile(e,l?48:56,a?32:24,i,s,r+8,h):t.renderTile(e,56,24,i,s,r+8,h),n||A?n&&A&&!g?t.renderTile(e,72,24,i,s,r,h+8):t.renderTile(e,A?48:40,n?32:40,i,s,r,h+8):t.renderTile(e,40,40,i,s,r,h+8),n||l?n&&l&&!c?t.renderTile(e,64,24,i,s,r+8,h+8):t.renderTile(e,l?48:56,n?32:40,i,s,r+8,h+8):t.renderTile(e,56,40,i,s,r+8,h+8)}}(7),startingPosition:new o(999)},g=Object.entries(d).map((([t,e])=>e));var c,w;(w=c||(c={}))[w.OWNED=1]="OWNED",w[w.VISIBLE=6]="VISIBLE";class u{constructor(t,i,s){e(this,"map2d"),e(this,"imageData"),e(this,"minimapCanvas",document.createElement("canvas")),e(this,"width"),e(this,"height"),this.map2d=t,this.width=i,this.height=s,this.imageData=t.createImageData(i,s),this.minimapCanvas.width=this.imageData.width,this.minimapCanvas.height=this.imageData.height}getRGB(t){return[t>>16&255,t>>8&255,255&t]}render(t,e,i,s){const r=Math.floor(this.map2d.canvas.width/s)-t.width/(i+s+10)-8,h=Math.round(t.width/(i+s+10));for(let a=0;a<this.height;a++)for(let t=0;t<this.width;t++){const i=t+a*this.width,s=e.getTile(t,a),[r,h,n]=this.getRGB(s.color);e.getTileState(t,a,c.OWNED)?(this.imageData.data[4*i]=255,this.imageData.data[4*i+1]=0,this.imageData.data[4*i+2]=0,this.imageData.data[4*i+3]=255):e.getTileState(t,a,c.VISIBLE)>=1?(this.imageData.data[4*i]=r,this.imageData.data[4*i+1]=h,this.imageData.data[4*i+2]=n,this.imageData.data[4*i+3]=255):(this.imageData.data[4*i]=0,this.imageData.data[4*i+1]=0,this.imageData.data[4*i+2]=0,this.imageData.data[4*i+3]=255)}this.minimapCanvas.getContext("2d").putImageData(this.imageData,0,0),this.map2d.drawImage(this.minimapCanvas,r,8,h,h),this.map2d.strokeStyle="rgba(255, 255, 255, 0.35)",this.map2d.strokeRect(r,8,h,h)}}let m=!1,T=!1;window.onload=()=>{m=!0,k()};let f=!1,M=!1,v=0,p=0,y=0,D=0,x=0,I=0;let S=3;let C=0;const B=(t=>{const e=new Image;return C++,e.onload=()=>{C--,0===C&&k()},e.src=t,e})(i),Q=document.querySelector("#map"),E=Q.getContext("2d"),b=new class{constructor(){e(this,"scrollX",0),e(this,"scrollY",0),e(this,"scrollSpeed",3),e(this,"keys",[]),window.onkeydown=t=>{this.keys[t.keyCode]=!0},window.onkeyup=t=>{this.keys[t.keyCode]=!1}}update(t,e,i,s){return this.scrollX=t,this.scrollY=e,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&i&&i(),this.keys[49]&&s&&s(),[this.scrollX,this.scrollY]}};let P;const O=new Array(1);for(let _=0;_<O.length;_++)O[_]={name:"Base",imageX:0,imageY:9};const Y=new class{constructor(t,s,r){e(this,"tiles"),e(this,"data"),e(this,"tilesState"),e(this,"tileSize",16),e(this,"tickCount",0),e(this,"tileImage"),e(this,"imagesToLoad",0),e(this,"width"),e(this,"height"),e(this,"seed"),e(this,"entities",[]),this.width=t,this.height=s,this.seed=r,this.tiles=new Array(t*s),this.data=new Array(t*s),this.tilesState=new Array(t*s),this.tileImage=this.loadImage(i)}loadImage(t){var e=new Image;return this.imagesToLoad++,e.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},e.src=t,e}init(){const t=((t,e,i=Math.random()*Number.MAX_SAFE_INTEGER)=>{for(;;){const s=a(t,e,i),r=new Array(256);for(let i=0;i<t*e;i++)r[255&s[0][i]]++;if(!(r[255&d.rock.id]<100||r[255&d.sand.id]<100||r[255&d.grass.id]<100||r[255&d.tree.id]<100))return s}})(this.width,this.height,this.seed);this.tiles=t[0],this.tilesState=t[1],this.data=t[1],this.tilesState.fill(0);for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++)if(this.tiles[t+e*this.width]===d.startingPosition.id)for(let i=0;i<5;i++)this.entities.push(new s(t,e))}update(){this.tickCount++,this.tickCount>=Number.MAX_VALUE&&(this.tickCount=0);for(let t=0;t<this.width*this.height/50;t++){const t=Math.round(Math.random()*this.width),e=Math.round(Math.random()*this.height);this.getTile(t,e).update(this,t,e)}this.entities.forEach((t=>t.update(this)))}render(t,e,i,s,r){const h=Math.floor(-i/this.tileSize),a=Math.floor(-s/this.tileSize),n=Math.ceil((-i+t.width/r)/this.tileSize),A=Math.ceil((-s+t.height/r)/this.tileSize);for(let l=a;l<A;l++)for(let t=h;t<n;t++){const r=this.getTile(t,l),h=this.getTileState(t,l,1);if(r.isOnGrass){g.find((t=>t.id===d.grass.id)).render(this,e,t,l,i,s)}else if(r.isOnSand){g.find((t=>t.id===d.sand.id)).render(this,e,t,l,i,s)}r.render(this,e,t,l,i,s),1===h&&e.drawImage(this.tileImage,0,72,16,16,t*this.tileSize+i,l*this.tileSize+s,16,16)}this.entities.forEach((t=>t.render(e,this.tileImage,i,s)));for(let l=a;l<A;l++)for(let t=h;t<n;t++){const r=this.getTileState(t,l,6);if(1===r)e.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+i+0,l*this.tileSize+s+0,8,8),e.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+i+8,l*this.tileSize+s+0,8,8),e.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+i+0,l*this.tileSize+s+8,8,8),e.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+i+8,l*this.tileSize+s+8,8,8);else for(let h=0;h<4;h++){const a=h%2*2-1,n=2*(h>>1)-1,A=this.getTileState(t,l+n,6)!==r,o=this.getTileState(t+a,l,6)!==r;let d=25,g=1;3===r&&(g+=3),A&&(g+=n),o&&(d+=a),e.drawImage(this.tileImage,8*d,8*g,8,8,t*this.tileSize+i+h%2*8,l*this.tileSize+s+8*(h>>1),8,8)}}}renderTile(t,e,i,s,r,h,a){t.drawImage(this.tileImage,e,i,8,8,s*this.tileSize+h,r*this.tileSize+a,8,8)}getTile(t,e){if(t<0||e<0||t>=this.width||e>=this.height)return d.water;const i=g.find((i=>this.tiles[t+e*this.width]===i.id));return null!=i?i:d.water}getTileState(t,e,i){return t<0||e<0||t>=this.width||e>=this.height?0:6===i?(this.tilesState[t+e*this.width]&i)>>1:this.tilesState[t+e*this.width]&i}setTileState(t,e,i,s){if(!(t<0||e<0||t>=this.width||e>=this.height))if(6===s){const s=this.tilesState[t+e*this.width];this.tilesState[t+e*this.width]=i<<1|1&s}else this.tilesState[t+e*this.width]^=i,this.tiles[t+e*this.width]=d.dirt.id}setTile(t,e,i){t<0||e<0||t>=this.width||e>=this.height||(this.tiles[t+e*this.width]=i.id)}setData(t,e,i){t<0||e<0||t>=this.width||e>=this.height||(this.data[t+e*this.width]=i)}getData(t,e){return t<0||e<0||t>=this.width||e>=this.height?0:255&this.data[t+e*this.width]}recalcVisibility(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++){let i=this.getTileState(e,t,6);3===i&&(i>>=1),this.setTileState(e,t,i,6)}for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++){this.getTileState(e,t,1)&&this.revealTile(e,t,4)}}revealTile(t,e,i){for(let s=e-i;s<=e+i;s++)if(!(s<0||s>=this.height))for(let r=t-i;r<=t+i;r++){if(r<0||r>=this.width)continue;const h=r-t,a=s-e;if(h*h+a*a<=i*i+2){if(0===s||0===r||r===this.width-1||s===this.height-1)continue;this.setTileState(r,s,3,6)}}}}(128,128),k=()=>{if(m&&!(C>0)){if(Q.width=window.innerWidth,Q.height=window.innerHeight,P=new u(E,128,128),Q.onmousedown=t=>{t.preventDefault(),f=!0,M=!1,v=t.clientX,p=t.clientY},Q.onclick=t=>{if(f=!1,!M){const e=Math.floor(y+16*-x+window.innerWidth/S/2),i=Math.floor(D+16*-I+window.innerHeight/S/2),s=Math.floor((t.clientX/S-e)/16),r=Math.floor((t.clientY/S-i)/16);X(s,r,t.clientX/S,t.clientY/S)}},window.onmousemove=t=>{if(!f)return;t.preventDefault();const e=t.clientX-v,i=t.clientY-p;(M||e*e+i*i>64)&&(M=!0,y+=e/S,D+=i/S,v=t.clientX,p=t.clientY)},!T){for(let t=0;t<128;t++)for(let e=0;e<128;e++){const i=e+128*t;Y.tiles[i]===d.startingPosition.id&&(x=e,I=t,Y.setTileState(x,I,1,c.OWNED),Y.recalcVisibility())}N(),T=!0}W()}};window.onresize=k;let H=null,z=null,G=!1;const X=(t,e,i=800,s=600)=>{const r=Math.floor(E.canvas.width/S),h=Math.floor(E.canvas.height/S);if(i>=0&&i<=r&&s>=h-35&&s<=h&&H&&z){return void(Y.getTile(H,z).isPassable&&q(i,s))}if(t<0||e<0||t>128||e>128)return H=null,void(z=null);const a=Y.getTileState(t,e,c.VISIBLE);if(0===a)return H=null,void(z=null);H===t&&z===e||(H=t,z=e,G=3===a)};let F=Date.now(),U=Date.now(),L=0;const N=()=>{requestAnimationFrame(N),F=U,U=Date.now(),L+=U-F,L>=60&&(L=0,J());const t=b.update(y,D,(()=>{}),(()=>{if(H&&z){for(let t=0;t<5;t++)Y.entities.push(new s(H,z));Y.setTileState(H,z,1,c.OWNED),Y.recalcVisibility(),H=null,z=null}}));y===t[0]&&D===t[1]||(y=t[0],D=t[1]),W()},J=()=>{Y.update()},W=()=>{S=Math.max(Math.floor(Q.height/300+1),Math.floor(Q.width/(16/9*300)+1)),y>16*x&&(y=16*x),D>16*I&&(D=16*I),y<16*x-2016&&(y=16*x-2016),D<16*I-2016&&(D=16*I-2016),E.imageSmoothingEnabled=!1,E.setTransform(S,0,0,S,0,0);const t=Math.floor(y+16*-x+window.innerWidth/S/2),e=Math.floor(D+16*-I+window.innerHeight/S/2);Y.render(Q,E,t,e,S);for(var i=0;i<O.length;i++){const t=Math.floor(E.canvas.width/S),e=Math.floor(E.canvas.height/S);E.fillStyle="rgba(255, 255, 255, 0.3)",E.fillRect(0,e-35,t,e),K(O[i].name,t/2+2,e-25-5,3),Z(O[i].imageX,O[i].imageY,t/2,e-25)}if(H&&z&&(E.strokeStyle="white",E.strokeRect(16*H+t,16*z+e,16,16),G)){const i=Y.getTile(H,z).getOutcome();i&&(E.fillStyle="rgba(0, 0, 0, 0.3)",E.fillRect(16*H+t+16,16*z+e,18,16),E.drawImage(B,8*A[i.type].imageX,8*A[i.type].imageY,8,8,16*H+t+18,16*z+e+4,8,8),K(`${i.amount}`,16*H+t+27,16*z+e+5,5))}V(),P.render(Q,Y,16,S)},j=[{imageX:0,imageY:11},{imageX:1,imageY:11}],V=()=>{for(let t=0;t<j.length;t++)E.drawImage(B,8*j[t].imageX,8*j[t].imageY,8,8,4,4+14*t,8,8),K("0",14,5+14*t,6)},R="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",K=(t,e,i,s=8)=>{t=t.toUpperCase();for(var r=0;r<t.length;r++){var h=R.indexOf(t.charAt(r)),a=0+h%32,n=29+(h>>5);E.drawImage(B,8*a,8*n,8,8,e+r*s,i,s,s)}},q=(t,e)=>{const i=Math.floor(E.canvas.width/S)/2,s=Math.floor(E.canvas.height/S)-25;t>=i&&t<=i+16&&e>=s&&e<=s+16&&H&&z&&(Y.setTileState(H,z,1,c.OWNED),Y.recalcVisibility(),H=null,z=null)},Z=(t,e,i,s)=>{E.beginPath(),E.strokeStyle="yellow",E.rect(i,s,16,16),E.stroke(),E.drawImage(B,8*t,8*e,16,16,i,s,16,16)};

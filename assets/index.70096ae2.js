var t=Object.defineProperty,i=("undefined"!=typeof require&&require,(i,e,s)=>(((i,e,s)=>{e in i?t(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s})(i,"symbol"!=typeof e?e+"":e,s),s));!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver((t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)})).observe(document,{childList:!0,subtree:!0})}function i(t){if(t.ep)return;t.ep=!0;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?i.credentials="include":"anonymous"===t.crossorigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();var e="data:image/png;base64,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";class s{constructor(t,e){i(this,"x"),i(this,"y"),i(this,"xa",0),i(this,"ya",0),i(this,"dirX",0),this.x=t,this.y=e}update(t){}move(t){if(0!==this.xa||0!==this.ya){let i=!0;return 0!==this.xa&&this.move2(t,this.xa,0)&&(i=!1),0!==this.ya&&this.move2(t,0,this.ya)&&(i=!1),0===this.xa||0===this.ya||this.move3(t,this.xa,this.ya)||(this.xa=0,this.ya=0),!i}return!0}move3(t,i,e){const s=this.x+i,h=this.y+e;return!!t.getTile(1===i?Math.floor(s):Math.round(s),1===e?Math.floor(h):Math.round(h)).isPassable}move2(t,i,e){const s=this.x-0,h=this.y-0,r=this.x+0,a=this.y+0,n=this.x+i-0,o=this.y+e-0,A=this.x+i+0,l=this.y+e+0;let d=!1;for(let g=o;g<=l;g++)for(let i=n;i<=A;i++)if(!(i>=s&&i<=r&&g>=h&&g<=a||t.getTile(Math.round(i),Math.round(g)).isPassable))return d=!0,!1;return!d&&(this.x+=i/16,this.y+=e/16,!0)}}class h extends s{constructor(){super(...arguments),i(this,"tx",0),i(this,"maxTx",4),i(this,"ty",12),i(this,"movingTx",4),i(this,"maxMovingTx",10),i(this,"moving",!0),i(this,"animation",0),i(this,"movingAnimation",0)}render(t,i,e,s){t.renderEntity(i,this.moving?8*this.movingTx:8*this.tx,-1===this.xa||1===this.dirX?8*(this.ty+2):8*this.ty,this.x,this.y,e,s)}update(t){1===this.xa||1===this.ya?(this.moving=!0,this.dirX=0):-1===this.xa||-1===this.ya?(this.moving=!0,this.dirX=1):this.moving=!1,this.move(t)?0===Math.floor(20*Math.random())&&(this.xa=Math.floor(3*Math.random())-1,this.ya=Math.floor(3*Math.random())-1):(this.xa=0,this.ya=0),this.animation+=1,this.movingAnimation+=1,this.animation%5!=0||this.moving||(this.animation=0,this.tx+=2,this.tx%this.maxTx==0&&(this.tx=0)),this.movingAnimation%2==0&&this.moving&&(this.movingAnimation=0,this.movingTx+=2,this.movingTx%this.maxMovingTx==0&&(this.movingTx=4))}}class r extends s{constructor(){super(...arguments),i(this,"tx",0),i(this,"maxTx",4),i(this,"ty",16),i(this,"movingTx",4),i(this,"maxMovingTx",10),i(this,"moving",!0),i(this,"animation",0),i(this,"movingAnimation",0)}render(t,i,e,s){t.renderEntity(i,this.moving?8*this.movingTx:8*this.tx,-1===this.xa||1===this.dirX?8*(this.ty+2):8*this.ty,this.x,this.y,e,s)}update(t){1===this.xa||1===this.ya?(this.moving=!0,this.dirX=0):-1===this.xa||-1===this.ya?(this.moving=!0,this.dirX=1):this.moving=!1,this.move(t)?0===Math.floor(20*Math.random())&&(this.xa=Math.floor(3*Math.random())-1,this.ya=Math.floor(3*Math.random())-1):(this.xa=0,this.ya=0),this.animation+=1,this.movingAnimation+=1,this.animation%7!=0||this.moving||(this.animation=0,this.tx+=2,this.tx%this.maxTx==0&&(this.tx=0)),this.movingAnimation%2==0&&this.moving&&(this.movingAnimation=0,this.movingTx+=2,this.movingTx%this.maxMovingTx==0&&(this.movingTx=4))}}Math.seed=t=>{const i=4294967295;let e=123456789+t&i,s=987654321-t&i;return()=>{s=36969*(65535&s)+(s>>>16)&i,e=18e3*(65535&e)+(e>>>16)&i;let t=(s<<16)+(65535&e)>>>0;return t/=4294967296,t}};let a=Math.seed(Math.random()*(10+90*Math.random()));class n{constructor(t,e,s){i(this,"w"),i(this,"h"),i(this,"values"),this.w=t,this.h=e,this.values=new Array(t*e);for(let i=0;i<e;i+=s)for(let e=0;e<t;e+=s)this.setSample(e,i,2*a()-1);let h=s,r=1/t,n=1;do{const i=h/2;for(let s=0;s<e;s+=h)for(let e=0;e<t;e+=h){const t=(this.sample(e,s)+this.sample(e+h,s)+this.sample(e,s+h)+this.sample(e+h,s+h))/4+(2*a()-1)*h*r;this.setSample(e+i,s+i,t)}for(let e=0;e<t;e+=h)for(let s=0;s<t;s+=h){const t=this.sample(s,e),n=this.sample(s+h,e),o=this.sample(s,e+h),A=this.sample(s+i,e+i),l=this.sample(s+i,e-i),d=this.sample(s-i,e+i),g=(t+n+A+l)/4+(2*a()-1)*h*r*.5,m=(t+o+A+d)/4+(2*a()-1)*h*r*.5;this.setSample(s+i,e,g),this.setSample(s,e+i,m)}h/=2,r*=n+.8,n*=.3}while(h>1)}sample(t,i){return this.values[(t&this.w-1)+(i&this.h-1)*this.w]}setSample(t,i,e){this.values[(t&this.w-1)+(i&this.h-1)*this.w]=e}}const o=(t,i,e=Math.random()*Number.MAX_SAFE_INTEGER)=>{a=Math.seed(e);const s=new n(t,i,16),h=new n(t,i,16),r=new n(t,i,16),o=new n(t,i,32),l=new n(t,i,32),d=new Array(t*i),g=new Array(t*i);for(let a=0;a<i;a++)for(let e=0;e<t;e++){const n=e+a*t;let A=3*Math.abs(o.values[n]-l.values[n])-2,g=Math.abs(s.values[n]-h.values[n]);g=3*Math.abs(g-r.values[n])-2;let c=e/(t-1)*2-1,w=a/(i-1)*2-1;c<0&&(c=-c),w<0&&(w=-w);let f=c>=w?c:w;f*=f*f*f,f*=f*f*f,A=A+1-20*f,d[n]=A<-.5?m.water.id:A>.5&&g<-1.5?m.rock.id:m.grass.id}for(let n=0;n<t*i/2800;n++){let e=Math.round(a()*t),s=Math.round(a()*i);for(let h=0;h<10;h++){let h=e+Math.round(21*a()-10),r=s+Math.round(21*a()-10);for(let e=0;e<100;e++){let e=h+Math.round(5*a())-Math.round(5*a()),s=r+Math.round(5*a())-Math.round(5*a());for(let h=s-1;h<=s+1;h++)for(let s=e-1;s<=e+1;s++)s>=0&&h>=0&&s<t&&h<i&&1==d[s+h*t]&&(d[s+h*t]=m.sand.id)}}}for(let n=0;n<t*i/400;n++){const e=Math.round(a()*t),s=Math.round(a()*i);for(let h=0;h<200;h++){const h=e+Math.round(15*a())-Math.round(15*a()),r=s+Math.round(15*a())-Math.round(15*a());h>=0&&r>=0&&h<t&&r<i&&d[h+r*t]==m.grass.id&&(d[h+r*t]=m.tree.id)}}for(let n=0;n<t*i/40;n++){const e=Math.round(a()*t),s=Math.round(a()*i);e>=0&&s>=0&&e<t&&s<<i&&d[e+s*t]===m.sand.id&&(d[e+s*t]=m.cactus.id)}for(let n=0;n<t*i/400;n++){const e=Math.round(a()*t),s=Math.round(a()*i);for(let h=0;h<30;h++){const h=e+Math.round(5*a())-Math.round(5*a()),r=s+Math.round(5*a())-Math.round(5*a());h>=0&&r>=0&&h<t&&r<i&&d[h+r*t]==m.grass.id&&(d[h+r*t]=m.flower.id)}}let c=-1,w=-1;for(;-1===c||-1===w;){c=Math.round(a()*t),w=Math.round(a()*i);t:for(let i=w-1;i<=w+1;i++)for(let e=c-1;e<=c+1;e++)if(d[e+i*t]===m.water.id||d[e+i*t]===m.rock.id||d[e+i*t]===m.tree.id){c=-1,w=-1;break t}const e=A(d,t,c,w,3,3,m.tree.id),s=A(d,t,c,w,5,1,m.rock.id);e&&s||(c=-1,w=-1)}return d[c+w*t]=m.startingPosition.id,[d,g]},A=(t,i,e,s,h,r,a)=>{let n=0;for(let o=s-h;o<=s+h;o++)for(let s=e-h;s<=e+h;s++)t[s+o*i]===a&&n++;return n>=r},l={wood:{imageX:0,imageY:11},stone:{imageX:1,imageY:11}};class d{constructor(t){i(this,"id"),i(this,"isFarmable",!1),i(this,"isPassable",!0),i(this,"isOnGrass",!1),i(this,"isOnSand",!1),i(this,"color",0),this.id=t}update(t,i,e){}getOutcome(){}}class g extends d{constructor(t){super(t),this.color=1096065}render(t,i,e,s,h,r){const a=t.getTile(e,s-1).id===this.id||t.getTile(e,s-1).id===m.tree.id||t.getTile(e,s-1).id===m.flower.id,n=t.getTile(e,s+1).id===this.id||t.getTile(e,s+1).id===m.tree.id||t.getTile(e,s+1).id===m.flower.id,o=t.getTile(e-1,s).id===this.id||t.getTile(e-1,s).id===m.tree.id||t.getTile(e-1,s).id===m.flower.id,A=t.getTile(e+1,s).id===this.id||t.getTile(e+1,s).id===m.tree.id||t.getTile(e+1,s).id===m.flower.id,l=t.getTile(e-1,s-1).id===this.id||t.getTile(e-1,s-1).id===m.tree.id||t.getTile(e-1,s-1).id===m.flower.id,d=t.getTile(e+1,s-1).id===this.id||t.getTile(e+1,s-1).id===m.tree.id||t.getTile(e+1,s-1).id===m.flower.id,g=t.getTile(e-1,s+1).id===this.id||t.getTile(e-1,s+1).id===m.tree.id||t.getTile(e-1,s+1).id===m.flower.id,c=t.getTile(e+1,s+1).id===this.id||t.getTile(e+1,s+1).id===m.tree.id||t.getTile(e+1,s+1).id===m.flower.id;a||o?a&&o&&!l?t.renderTile(i,32,32,e,s,h,r):t.renderTile(i,o?8:0,a?32:24,e,s,h,r):t.renderTile(i,0,24,e,s,h,r),a||A?a&&A&&!d?t.renderTile(i,24,32,e,s,h+8,r):t.renderTile(i,A?8:16,a?32:24,e,s,h+8,r):t.renderTile(i,16,24,e,s,h+8,r),n||o?n&&o&&!g?t.renderTile(i,32,24,e,s,h,r+8):t.renderTile(i,o?8:0,n?32:40,e,s,h,r+8):t.renderTile(i,0,40,e,s,h,r+8),n||A?n&&A&&!c?t.renderTile(i,24,24,e,s,h+8,r+8):t.renderTile(i,A?8:16,n?32:40,e,s,h+8,r+8):t.renderTile(i,16,40,e,s,h+8,r+8)}}const m={water:new class extends d{constructor(t){super(t),i(this,"position1",0),i(this,"position2",0),i(this,"position3",0),i(this,"position4",0),i(this,"shouldAnimate",!0),this.isPassable=!1,this.color=3900150}render(t,i,e,s,h,r){this.shouldAnimate&&(this.position1=Math.round(3+3*Math.random()),this.position2=Math.round(3+3*Math.random()),this.position3=Math.round(3+3*Math.random()),this.position4=Math.round(3+3*Math.random()),this.shouldAnimate=!1);const a=t.getTile(e,s-1).id===this.id,n=t.getTile(e,s+1).id===this.id,o=t.getTile(e-1,s).id===this.id,A=t.getTile(e+1,s).id===this.id,l=t.getTile(e-1,s-1).id===this.id,d=t.getTile(e+1,s-1).id===this.id;a||o?a&&o&&!l?t.renderTile(i,32,8,e,s,h,r):a&&o?t.renderTile(i,8*this.position1,16,e,s,h,r):t.renderTile(i,o?8:0,a?8:0,e,s,h,r):t.renderTile(i,0,0,e,s,h,r),a||A?a&&A&&!d?t.renderTile(i,24,8,e,s,h+8,r):a&&A?t.renderTile(i,8*this.position2,16,e,s,h+8,r):t.renderTile(i,A?8:16,a?8:0,e,s,h+8,r):t.renderTile(i,16,0,e,s,h+8,r),n||o?n&&o?t.renderTile(i,8*this.position3,16,e,s,h,r+8):t.renderTile(i,o?8:0,n?8:16,e,s,h,r+8):t.renderTile(i,0,16,e,s,h,r+8),n||A?n&&A?t.renderTile(i,8*this.position4,16,e,s,h+8,r+8):t.renderTile(i,A?8:16,n?8:16,e,s,h+8,r+8):t.renderTile(i,16,16,e,s,h+8,r+8),a&&!o&&l&&t.renderTile(i,32,0,e,s,h,r-8),a&&!A&&d&&t.renderTile(i,24,0,e,s,h+8,r-8)}update(t,i,e){t.tickCount%10==0&&(this.shouldAnimate=!0)}}(0),grass:new g(1),sand:new class extends d{constructor(t){super(t),this.color=16498468}render(t,i,e,s,h,r){t.renderTile(i,40,0,e,s,h,r),t.renderTile(i,40,0,e,s,h+8,r),t.renderTile(i,40,0,e,s,h,r+8),t.renderTile(i,40,0,e,s,h+8,r+8)}}(2),tree:new class extends d{constructor(t){super(t),this.isFarmable=!0,this.isPassable=!1,this.isOnGrass=!0,this.color=417606}render(t,i,e,s,h,r){t.onTopTiles.find((t=>t.x===e&&t.y===s))||(t.onTopTiles.push({sx:16,sy:72,x:e,y:s,xExtraOffset:0,yExtraOffset:0}),t.onTopTiles.push({sx:24,sy:72,x:e,y:s,xExtraOffset:8,yExtraOffset:0})),t.renderTile(i,16,80,e,s,h,r+8),t.renderTile(i,24,80,e,s,h+8,r+8)}getOutcome(){return{amount:3,type:"wood"}}}(3),rock:new class extends d{constructor(t){super(t),this.isFarmable=!0,this.isPassable=!1,this.color=10265519}render(t,i,e,s,h,r){const a=t.getTile(e,s-1).id===this.id,n=t.getTile(e,s+1).id===this.id,o=t.getTile(e-1,s).id===this.id,A=t.getTile(e+1,s).id===this.id,l=t.getTile(e-1,s-1).id===this.id,d=t.getTile(e+1,s-1).id===this.id,g=t.getTile(e-1,s+1).id===this.id,m=t.getTile(e+1,s+1).id===this.id;a||o?a&&o&&!l?t.renderTile(i,32,56,e,s,h,r):t.renderTile(i,o?8:0,a?56:48,e,s,h,r):t.renderTile(i,0,48,e,s,h,r),a||A?a&&A&&!d?t.renderTile(i,24,56,e,s,h+8,r):t.renderTile(i,A?8:16,a?56:48,e,s,h+8,r):t.renderTile(i,16,48,e,s,h+8,r),n||o?n&&o&&!g?t.renderTile(i,32,48,e,s,h,r+8):t.renderTile(i,o?8:0,n?56:64,e,s,h,r+8):t.renderTile(i,0,64,e,s,h,r+8),n||A?n&&A&&!m?t.renderTile(i,24,48,e,s,h+8,r+8):t.renderTile(i,A?8:16,n?56:64,e,s,h+8,r+8):t.renderTile(i,16,64,e,s,h+8,r+8)}getOutcome(){return{amount:3,type:"stone"}}}(4),flower:new class extends d{constructor(t){super(t),this.isOnGrass=!0,this.color=1096065}render(t,i,e,s,h,r){t.renderTile(i,48,0,e,s,h+4,r+4)}}(5),cactus:new class extends d{constructor(t){super(t),this.isOnSand=!0,this.color=16498468}render(t,i,e,s,h,r){t.renderTile(i,56,0,e,s,h,r),t.renderTile(i,64,0,e,s,h+8,r),t.renderTile(i,56,8,e,s,h,r+8),t.renderTile(i,64,8,e,s,h+8,r+8)}}(6),dirt:new class extends d{constructor(t){super(t),this.color=7877903}render(t,i,e,s,h,r){const a=t.getTile(e,s-1).id===this.id,n=t.getTile(e,s+1).id===this.id,o=t.getTile(e-1,s).id===this.id,A=t.getTile(e+1,s).id===this.id,l=t.getTile(e-1,s-1).id===this.id,d=t.getTile(e+1,s-1).id===this.id,g=t.getTile(e-1,s+1).id===this.id,m=t.getTile(e+1,s+1).id===this.id;a||o?a&&o&&!l?t.renderTile(i,72,32,e,s,h,r):t.renderTile(i,o?48:40,a?32:24,e,s,h,r):t.renderTile(i,40,24,e,s,h,r),a||A?a&&A&&!d?t.renderTile(i,64,32,e,s,h+8,r):t.renderTile(i,A?48:56,a?32:24,e,s,h+8,r):t.renderTile(i,56,24,e,s,h+8,r),n||o?n&&o&&!g?t.renderTile(i,72,24,e,s,h,r+8):t.renderTile(i,o?48:40,n?32:40,e,s,h,r+8):t.renderTile(i,40,40,e,s,h,r+8),n||A?n&&A&&!m?t.renderTile(i,64,24,e,s,h+8,r+8):t.renderTile(i,A?48:56,n?32:40,e,s,h+8,r+8):t.renderTile(i,56,40,e,s,h+8,r+8)}}(7),startingPosition:new g(999)},c=Object.entries(m).map((([t,i])=>i));var w,f;(f=w||(w={}))[f.OWNED=1]="OWNED",f[f.VISIBLE=6]="VISIBLE";class u{constructor(t,e,s){i(this,"map2d"),i(this,"imageData"),i(this,"minimapCanvas",document.createElement("canvas")),i(this,"width"),i(this,"height"),this.map2d=t,this.width=e,this.height=s,this.imageData=t.createImageData(e,s),this.minimapCanvas.width=this.imageData.width,this.minimapCanvas.height=this.imageData.height}getRGB(t){return[t>>16&255,t>>8&255,255&t]}render(t,i,e,s){const h=Math.floor(this.map2d.canvas.width/s)-t.width/(e+s+10)-8,r=Math.round(t.width/(e+s+10));for(let a=0;a<this.height;a++)for(let t=0;t<this.width;t++){const e=t+a*this.width,s=i.getTile(t,a),[h,r,n]=this.getRGB(s.color);i.getTileState(t,a,w.OWNED)?(this.imageData.data[4*e]=255,this.imageData.data[4*e+1]=0,this.imageData.data[4*e+2]=0,this.imageData.data[4*e+3]=255):i.getTileState(t,a,w.VISIBLE)>=1?(this.imageData.data[4*e]=h,this.imageData.data[4*e+1]=r,this.imageData.data[4*e+2]=n,this.imageData.data[4*e+3]=255):(this.imageData.data[4*e]=0,this.imageData.data[4*e+1]=0,this.imageData.data[4*e+2]=0,this.imageData.data[4*e+3]=255)}this.minimapCanvas.getContext("2d").putImageData(this.imageData,0,0),this.map2d.drawImage(this.minimapCanvas,h,8,r,r),this.map2d.strokeStyle="rgba(255, 255, 255, 0.35)",this.map2d.strokeRect(h,8,r,r)}}let T=!1,M=!1;window.onload=()=>{T=!0,O()};let v=!1,x=!1,p=0,B=0,D=0,y=0,E=0,S=0;let I=3;let Y=0;const Q=(t=>{const i=new Image;return Y++,i.onload=()=>{Y--,0===Y&&O()},i.src=t,i})(e),C=document.querySelector("#map"),b=C.getContext("2d"),L=new class{constructor(){i(this,"scrollX",0),i(this,"scrollY",0),i(this,"scrollSpeed",3),i(this,"keys",[]),window.onkeydown=t=>{this.keys[t.keyCode]=!0},window.onkeyup=t=>{this.keys[t.keyCode]=!1}}update(t,i,e,s){return this.scrollX=t,this.scrollY=i,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&e&&e(),this.keys[49]&&s&&s(),[this.scrollX,this.scrollY]}};let z;const P=new Array(1);for(let tt=0;tt<P.length;tt++)P[tt]={name:"Base",imageX:0,imageY:9};const H=new class{constructor(t,s,h){i(this,"tiles"),i(this,"data"),i(this,"tilesState"),i(this,"tileSize",16),i(this,"tickCount",0),i(this,"tileImage"),i(this,"imagesToLoad",0),i(this,"width"),i(this,"height"),i(this,"seed"),i(this,"entities",[]),i(this,"onTopTiles",[]),this.width=t,this.height=s,this.seed=h,this.tiles=new Array(t*s),this.data=new Array(t*s),this.tilesState=new Array(t*s),this.tileImage=this.loadImage(e)}loadImage(t){var i=new Image;return this.imagesToLoad++,i.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},i.src=t,i}init(){const t=((t,i,e=Math.random()*Number.MAX_SAFE_INTEGER)=>{for(;;){const s=o(t,i,e),h=new Array(256);for(let e=0;e<t*i;e++)h[255&s[0][e]]++;if(!(h[255&m.rock.id]<100||h[255&m.sand.id]<100||h[255&m.grass.id]<100||h[255&m.tree.id]<100))return s}})(this.width,this.height,this.seed);this.tiles=t[0],this.tilesState=[...t[1]],this.data=[...t[1]],this.tilesState.fill(0);for(let i=0;i<this.height;i++)for(let t=0;t<this.width;t++){if(this.tiles[t+i*this.width]===m.startingPosition.id)for(let e=0;e<5;e++)this.entities.push(0===Math.round(1*Math.random())?new h(t,i):new r(t,i))}}update(){this.tickCount++,this.tickCount>=Number.MAX_VALUE&&(this.tickCount=0);for(let t=0;t<this.width*this.height/50;t++){const t=Math.round(Math.random()*this.width),i=Math.round(Math.random()*this.height);this.getTile(t,i).update(this,t,i)}this.entities.forEach((t=>t.update(this)))}render(t,i,e,s,h){const r=Math.floor(-e/this.tileSize),a=Math.floor(-s/this.tileSize),n=Math.ceil((-e+t.width/h)/this.tileSize),o=Math.ceil((-s+t.height/h)/this.tileSize);for(let A=a;A<o;A++)for(let t=r;t<n;t++){const h=this.getTile(t,A),r=this.getTileState(t,A,1);if(h.isOnGrass){c.find((t=>t.id===m.grass.id)).render(this,i,t,A,e,s)}else if(h.isOnSand){c.find((t=>t.id===m.sand.id)).render(this,i,t,A,e,s)}h.render(this,i,t,A,e,s),1===r&&i.drawImage(this.tileImage,0,72,16,16,t*this.tileSize+e,A*this.tileSize+s,16,16)}this.entities.forEach((t=>t.render(this,i,e,s))),this.onTopTiles.forEach((t=>{this.renderTile(i,t.sx,t.sy,t.x,t.y,t.xExtraOffset+e,t.yExtraOffset+s)}));for(let A=a;A<o;A++)for(let t=r;t<n;t++){const h=this.getTileState(t,A,6);if(1===h)i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+0,A*this.tileSize+s+0,8,8),i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+8,A*this.tileSize+s+0,8,8),i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+0,A*this.tileSize+s+8,8,8),i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+8,A*this.tileSize+s+8,8,8);else for(let r=0;r<4;r++){const a=r%2*2-1,n=2*(r>>1)-1,o=this.getTileState(t,A+n,6)!==h,l=this.getTileState(t+a,A,6)!==h;let d=25,g=1;3===h&&(g+=3),o&&(g+=n),l&&(d+=a),i.drawImage(this.tileImage,8*d,8*g,8,8,t*this.tileSize+e+r%2*8,A*this.tileSize+s+8*(r>>1),8,8)}}}renderEntity(t,i,e,s,h,r,a){t.drawImage(this.tileImage,i,e,this.tileSize,this.tileSize,s*this.tileSize+r,h*this.tileSize+a,this.tileSize,this.tileSize)}renderTile(t,i,e,s,h,r,a){t.drawImage(this.tileImage,i,e,8,8,s*this.tileSize+r,h*this.tileSize+a,8,8)}getTile(t,i){if(t<0||i<0||t>=this.width||i>=this.height)return m.water;const e=c.find((e=>this.tiles[t+i*this.width]===e.id));return null!=e?e:m.water}getTileState(t,i,e){return t<0||i<0||t>=this.width||i>=this.height?0:6===e?(this.tilesState[t+i*this.width]&e)>>1:this.tilesState[t+i*this.width]&e}setTileState(t,i,e,s){if(!(t<0||i<0||t>=this.width||i>=this.height))if(6===s){const s=this.tilesState[t+i*this.width];this.tilesState[t+i*this.width]=e<<1|1&s}else this.tilesState[t+i*this.width]^=e,this.tiles[t+i*this.width]=m.dirt.id}setTile(t,i,e){t<0||i<0||t>=this.width||i>=this.height||(this.tiles[t+i*this.width]=e.id)}setData(t,i,e){t<0||i<0||t>=this.width||i>=this.height||(this.data[t+i*this.width]=e)}getData(t,i){return t<0||i<0||t>=this.width||i>=this.height?0:255&this.data[t+i*this.width]}recalcVisibility(){for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++){let e=this.getTileState(i,t,6);3===e&&(e>>=1),this.setTileState(i,t,e,6)}for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++){this.getTileState(i,t,1)&&this.revealTile(i,t,4)}}revealTile(t,i,e){for(let s=i-e;s<=i+e;s++)if(!(s<0||s>=this.height))for(let h=t-e;h<=t+e;h++){if(h<0||h>=this.width)continue;const r=h-t,a=s-i;if(r*r+a*a<=e*e+2){if(0===s||0===h||h===this.width-1||s===this.height-1)continue;this.setTileState(h,s,3,6)}}}}(128,128),O=()=>{if(T&&!(Y>0)){if(C.width=window.innerWidth,C.height=window.innerHeight,z=new u(b,128,128),C.onmousedown=t=>{t.preventDefault(),v=!0,x=!1,p=t.clientX,B=t.clientY},C.onclick=t=>{if(v=!1,!x){const i=Math.floor(D+16*-E+window.innerWidth/I/2),e=Math.floor(y+16*-S+window.innerHeight/I/2),s=Math.floor((t.clientX/I-i)/16),h=Math.floor((t.clientY/I-e)/16);k(s,h,t.clientX/I,t.clientY/I)}},window.onmousemove=t=>{if(!v)return;t.preventDefault();const i=t.clientX-p,e=t.clientY-B;(x||i*i+e*e>64)&&(x=!0,D+=i/I,y+=e/I,p=t.clientX,B=t.clientY)},!M){for(let t=0;t<128;t++)for(let i=0;i<128;i++){const e=i+128*t;H.tiles[e]===m.startingPosition.id&&(E=i,S=t,H.setTileState(E,S,1,w.OWNED),H.recalcVisibility())}F(),M=!0}J()}};window.onresize=O;let R=null,N=null,X=!1;const k=(t,i,e=800,s=600)=>{const h=Math.floor(b.canvas.width/I),r=Math.floor(b.canvas.height/I);if(e>=0&&e<=h&&s>=r-35&&s<=r&&R&&N){return void(H.getTile(R,N).isPassable&&_(e,s))}if(t<0||i<0||t>128||i>128)return R=null,void(N=null);const a=H.getTileState(t,i,w.VISIBLE);if(0===a)return R=null,void(N=null);R===t&&N===i||(R=t,N=i,X=3===a)};let G=Date.now(),W=Date.now(),q=0;const F=()=>{requestAnimationFrame(F),G=W,W=Date.now(),q+=W-G,q>=60&&(q=0,U());const t=L.update(D,y,(()=>{}),(()=>{if(R&&N){for(let t=0;t<5;t++)H.entities.push(0===Math.round(1*Math.random())?new h(R,N):new r(R,N));H.setTileState(R,N,1,w.OWNED),H.recalcVisibility(),R=null,N=null}}));D===t[0]&&y===t[1]||(D=t[0],y=t[1]),J()},U=()=>{H.update()},J=()=>{I=Math.max(Math.floor(C.height/300+1),Math.floor(C.width/(16/9*300)+1)),D>16*E&&(D=16*E),y>16*S&&(y=16*S),D<16*E-2016&&(D=16*E-2016),y<16*S-2016&&(y=16*S-2016),b.imageSmoothingEnabled=!1,b.setTransform(I,0,0,I,0,0);const t=Math.floor(D+16*-E+window.innerWidth/I/2),i=Math.floor(y+16*-S+window.innerHeight/I/2);H.render(C,b,t,i,I);for(var e=0;e<P.length;e++){const t=Math.floor(b.canvas.width/I),i=Math.floor(b.canvas.height/I);b.fillStyle="rgba(255, 255, 255, 0.3)",b.fillRect(0,i-35,t,i),Z(P[e].name,t/2+2,i-25-5,3),$(P[e].imageX,P[e].imageY,t/2,i-25)}if(R&&N&&(b.strokeStyle="white",b.strokeRect(16*R+t,16*N+i,16,16),X)){const e=H.getTile(R,N).getOutcome();e&&(b.fillStyle="rgba(0, 0, 0, 0.3)",b.fillRect(16*R+t+16,16*N+i,18,16),b.drawImage(Q,8*l[e.type].imageX,8*l[e.type].imageY,8,8,16*R+t+18,16*N+i+4,8,8),Z(`${e.amount}`,16*R+t+27,16*N+i+5,5))}K(),z.render(C,H,16,I)},V=[{imageX:0,imageY:11},{imageX:1,imageY:11}],K=()=>{for(let t=0;t<V.length;t++)b.drawImage(Q,8*V[t].imageX,8*V[t].imageY,8,8,4,4+14*t,8,8),Z("0",14,5+14*t,6)},j="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",Z=(t,i,e,s=8)=>{t=t.toUpperCase();for(var h=0;h<t.length;h++){var r=j.indexOf(t.charAt(h)),a=0+r%32,n=29+(r>>5);b.drawImage(Q,8*a,8*n,8,8,i+h*s,e,s,s)}},_=(t,i)=>{const e=Math.floor(b.canvas.width/I)/2,s=Math.floor(b.canvas.height/I)-25;t>=e&&t<=e+16&&i>=s&&i<=s+16&&R&&N&&(H.setTileState(R,N,1,w.OWNED),H.recalcVisibility(),R=null,N=null)},$=(t,i,e,s)=>{b.beginPath(),b.strokeStyle="yellow",b.rect(e,s,16,16),b.stroke(),b.drawImage(Q,8*t,8*i,16,16,e,s,16,16)};

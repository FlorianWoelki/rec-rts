var e=Object.defineProperty,t=("undefined"!=typeof require&&require,(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s));!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i="data:image/png;base64,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";class s{constructor(e,i,s){t(this,"w"),t(this,"h"),t(this,"values"),this.w=e,this.h=i,this.values=new Array(e*i);for(let t=0;t<i;t+=s)for(let i=0;i<e;i+=s)this.setSample(i,t,2*Math.random()-1);let r=s,l=1/e,d=1;do{const t=r/2;for(let s=0;s<i;s+=r)for(let i=0;i<e;i+=r){const e=(this.sample(i,s)+this.sample(i+r,s)+this.sample(i,s+r)+this.sample(i+r,s+r))/4+(2*Math.random()-1)*r*l;this.setSample(i+t,s+t,e)}for(let i=0;i<e;i+=r)for(let s=0;s<e;s+=r){const e=this.sample(s,i),d=this.sample(s+r,i),h=this.sample(s,i+r),n=this.sample(s+t,i+t),A=this.sample(s+t,i-t),a=this.sample(s-t,i+t),o=(e+d+n+A)/4+(2*Math.random()-1)*r*l*.5,g=(e+h+n+a)/4+(2*Math.random()-1)*r*l*.5;this.setSample(s+t,i,o),this.setSample(s,i+t,g)}r/=2,l*=d+.8,d*=.3}while(r>1)}sample(e,t){return this.values[(e&this.w-1)+(t&this.h-1)*this.w]}setSample(e,t,i){this.values[(e&this.w-1)+(t&this.h-1)*this.w]=i}}const r=(e,t)=>{const i=new s(e,t,16),r=new s(e,t,16),d=new s(e,t,16),h=new s(e,t,32),n=new s(e,t,32),a=new Array(e*t),o=new Array(e*t);for(let s=0;s<t;s++)for(let l=0;l<e;l++){const o=l+s*e;let g=3*Math.abs(h.values[o]-n.values[o])-2,c=Math.abs(i.values[o]-r.values[o]);c=3*Math.abs(c-d.values[o])-2;let w=l/(e-1)*2-1,u=s/(t-1)*2-1;w<0&&(w=-w),u<0&&(u=-u);let f=w>=u?w:u;f*=f*f*f,f*=f*f*f,g=g+1-20*f,a[o]=g<-.5?A.water.id:g>.5&&c<-1.5?A.rock.id:A.grass.id}for(let s=0;s<e*t/2800;s++){let i=Math.round(Math.random()*e),s=Math.round(Math.random()*t);for(let r=0;r<10;r++){let r=i+Math.round(21*Math.random()-10),l=s+Math.round(21*Math.random()-10);for(let i=0;i<100;i++){let i=r+Math.round(5*Math.random())-Math.round(5*Math.random()),s=l+Math.round(5*Math.random())-Math.round(5*Math.random());for(let r=s-1;r<=s+1;r++)for(let s=i-1;s<=i+1;s++)s>=0&&r>=0&&s<e&&r<t&&1==a[s+r*e]&&(a[s+r*e]=A.sand.id)}}}for(let s=0;s<e*t/400;s++){const i=Math.round(Math.random()*e),s=Math.round(Math.random()*t);for(let r=0;r<200;r++){const r=i+Math.round(15*Math.random())-Math.round(15*Math.random()),l=s+Math.round(15*Math.random())-Math.round(15*Math.random());r>=0&&l>=0&&r<e&&l<t&&a[r+l*e]==A.grass.id&&(a[r+l*e]=A.tree.id)}}for(let s=0;s<e*t/40;s++){const i=Math.round(Math.random()*e),s=Math.round(Math.random()*t);i>=0&&s>=0&&i<e&&s<<t&&a[i+s*e]===A.sand.id&&(a[i+s*e]=A.cactus.id)}for(let s=0;s<e*t/400;s++){const i=Math.round(Math.random()*e),s=Math.round(Math.random()*t);for(let r=0;r<30;r++){const r=i+Math.round(5*Math.random())-Math.round(5*Math.random()),l=s+Math.round(5*Math.random())-Math.round(5*Math.random());r>=0&&l>=0&&r<e&&l<t&&a[r+l*e]==A.grass.id&&(a[r+l*e]=A.flower.id)}}let g=-1,c=-1;for(;-1===g||-1===c;){g=Math.round(Math.random()*e),c=Math.round(Math.random()*t);e:for(let t=c-1;t<=c+1;t++)for(let i=g-1;i<=g+1;i++)if(a[i+t*e]===A.water.id||a[i+t*e]===A.rock.id||a[i+t*e]===A.tree.id){g=-1,c=-1;break e}const i=l(a,e,g,c,3,3,A.tree.id),s=l(a,e,g,c,5,1,A.rock.id);i&&s||(g=-1,c=-1)}return a[g+c*e]=A.startingPosition.id,[a,o]},l=(e,t,i,s,r,l,d)=>{let h=0;for(let n=s-r;n<=s+r;n++)for(let s=i-r;s<=i+r;s++)e[s+n*t]===d&&h++;return h>=l},d={wood:{imageX:0,imageY:11},stone:{imageX:1,imageY:11}};class h{constructor(e){t(this,"id"),t(this,"isFarmable",!1),t(this,"isPassable",!0),t(this,"isOnGrass",!1),t(this,"isOnSand",!1),this.id=e}update(e,t,i){}getOutcome(){}}class n extends h{render(e,t,i,s,r,l){const d=e.getTile(i,s-1).id===this.id||e.getTile(i,s-1).id===A.tree.id||e.getTile(i,s-1).id===A.flower.id,h=e.getTile(i,s+1).id===this.id||e.getTile(i,s+1).id===A.tree.id||e.getTile(i,s+1).id===A.flower.id,n=e.getTile(i-1,s).id===this.id||e.getTile(i-1,s).id===A.tree.id||e.getTile(i-1,s).id===A.flower.id,a=e.getTile(i+1,s).id===this.id||e.getTile(i+1,s).id===A.tree.id||e.getTile(i+1,s).id===A.flower.id,o=e.getTile(i-1,s-1).id===this.id||e.getTile(i-1,s-1).id===A.tree.id||e.getTile(i-1,s-1).id===A.flower.id,g=e.getTile(i+1,s-1).id===this.id||e.getTile(i+1,s-1).id===A.tree.id||e.getTile(i+1,s-1).id===A.flower.id,c=e.getTile(i-1,s+1).id===this.id||e.getTile(i-1,s+1).id===A.tree.id||e.getTile(i-1,s+1).id===A.flower.id,w=e.getTile(i+1,s+1).id===this.id||e.getTile(i+1,s+1).id===A.tree.id||e.getTile(i+1,s+1).id===A.flower.id;d||n?d&&n&&!o?e.renderTile(t,32,32,i,s,r,l):e.renderTile(t,n?8:0,d?32:24,i,s,r,l):e.renderTile(t,0,24,i,s,r,l),d||a?d&&a&&!g?e.renderTile(t,24,32,i,s,r+8,l):e.renderTile(t,a?8:16,d?32:24,i,s,r+8,l):e.renderTile(t,16,24,i,s,r+8,l),h||n?h&&n&&!c?e.renderTile(t,32,24,i,s,r,l+8):e.renderTile(t,n?8:0,h?32:40,i,s,r,l+8):e.renderTile(t,0,40,i,s,r,l+8),h||a?h&&a&&!w?e.renderTile(t,24,24,i,s,r+8,l+8):e.renderTile(t,a?8:16,h?32:40,i,s,r+8,l+8):e.renderTile(t,16,40,i,s,r+8,l+8)}}const A={water:new class extends h{constructor(e){super(e),t(this,"position1",0),t(this,"position2",0),t(this,"position3",0),t(this,"position4",0),t(this,"shouldAnimate",!0),this.isPassable=!1}render(e,t,i,s,r,l){this.shouldAnimate&&(this.position1=Math.round(3+3*Math.random()),this.position2=Math.round(3+3*Math.random()),this.position3=Math.round(3+3*Math.random()),this.position4=Math.round(3+3*Math.random()),this.shouldAnimate=!1);const d=e.getTile(i,s-1).id===this.id,h=e.getTile(i,s+1).id===this.id,n=e.getTile(i-1,s).id===this.id,A=e.getTile(i+1,s).id===this.id,a=e.getTile(i-1,s-1).id===this.id,o=e.getTile(i+1,s-1).id===this.id;d||n?d&&n&&!a?e.renderTile(t,32,8,i,s,r,l):d&&n?e.renderTile(t,8*this.position1,16,i,s,r,l):e.renderTile(t,n?8:0,d?8:0,i,s,r,l):e.renderTile(t,0,0,i,s,r,l),d||A?d&&A&&!o?e.renderTile(t,24,8,i,s,r+8,l):d&&A?e.renderTile(t,8*this.position2,16,i,s,r+8,l):e.renderTile(t,A?8:16,d?8:0,i,s,r+8,l):e.renderTile(t,16,0,i,s,r+8,l),h||n?h&&n?e.renderTile(t,8*this.position3,16,i,s,r,l+8):e.renderTile(t,n?8:0,h?8:16,i,s,r,l+8):e.renderTile(t,0,16,i,s,r,l+8),h||A?h&&A?e.renderTile(t,8*this.position4,16,i,s,r+8,l+8):e.renderTile(t,A?8:16,h?8:16,i,s,r+8,l+8):e.renderTile(t,16,16,i,s,r+8,l+8),d&&!n&&a&&e.renderTile(t,32,0,i,s,r,l-8),d&&!A&&o&&e.renderTile(t,24,0,i,s,r+8,l-8)}update(e,t,i){e.tickCount%40==0&&(this.shouldAnimate=!0)}}(0),grass:new n(1),sand:new class extends h{render(e,t,i,s,r,l){e.renderTile(t,40,0,i,s,r,l),e.renderTile(t,40,0,i,s,r+8,l),e.renderTile(t,40,0,i,s,r,l+8),e.renderTile(t,40,0,i,s,r+8,l+8)}}(2),tree:new class extends h{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1,this.isOnGrass=!0}render(e,t,i,s,r,l){e.renderTile(t,16,72,i,s,r,l),e.renderTile(t,24,72,i,s,r+8,l),e.renderTile(t,16,80,i,s,r,l+8),e.renderTile(t,24,80,i,s,r+8,l+8)}getOutcome(){return{amount:3,type:"wood"}}}(3),rock:new class extends h{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1}render(e,t,i,s,r,l){const d=e.getTile(i,s-1).id===this.id,h=e.getTile(i,s+1).id===this.id,n=e.getTile(i-1,s).id===this.id,A=e.getTile(i+1,s).id===this.id,a=e.getTile(i-1,s-1).id===this.id,o=e.getTile(i+1,s-1).id===this.id,g=e.getTile(i-1,s+1).id===this.id,c=e.getTile(i+1,s+1).id===this.id;d||n?d&&n&&!a?e.renderTile(t,32,56,i,s,r,l):e.renderTile(t,n?8:0,d?56:48,i,s,r,l):e.renderTile(t,0,48,i,s,r,l),d||A?d&&A&&!o?e.renderTile(t,24,56,i,s,r+8,l):e.renderTile(t,A?8:16,d?56:48,i,s,r+8,l):e.renderTile(t,16,48,i,s,r+8,l),h||n?h&&n&&!g?e.renderTile(t,32,48,i,s,r,l+8):e.renderTile(t,n?8:0,h?56:64,i,s,r,l+8):e.renderTile(t,0,64,i,s,r,l+8),h||A?h&&A&&!c?e.renderTile(t,24,48,i,s,r+8,l+8):e.renderTile(t,A?8:16,h?56:64,i,s,r+8,l+8):e.renderTile(t,16,64,i,s,r+8,l+8)}getOutcome(){return{amount:3,type:"stone"}}}(4),flower:new class extends h{constructor(e){super(e),this.isOnGrass=!0}render(e,t,i,s,r,l){e.renderTile(t,48,0,i,s,r+4,l+4)}}(5),cactus:new class extends h{constructor(e){super(e),this.isOnSand=!0}render(e,t,i,s,r,l){e.renderTile(t,56,0,i,s,r,l),e.renderTile(t,64,0,i,s,r+8,l),e.renderTile(t,56,8,i,s,r,l+8),e.renderTile(t,64,8,i,s,r+8,l+8)}}(6),dirt:new class extends h{render(e,t,i,s,r,l){const d=e.getTile(i,s-1).id===this.id,h=e.getTile(i,s+1).id===this.id,n=e.getTile(i-1,s).id===this.id,A=e.getTile(i+1,s).id===this.id,a=e.getTile(i-1,s-1).id===this.id,o=e.getTile(i+1,s-1).id===this.id,g=e.getTile(i-1,s+1).id===this.id,c=e.getTile(i+1,s+1).id===this.id;d||n?d&&n&&!a?e.renderTile(t,72,32,i,s,r,l):e.renderTile(t,n?48:40,d?32:24,i,s,r,l):e.renderTile(t,40,24,i,s,r,l),d||A?d&&A&&!o?e.renderTile(t,64,32,i,s,r+8,l):e.renderTile(t,A?48:56,d?32:24,i,s,r+8,l):e.renderTile(t,56,24,i,s,r+8,l),h||n?h&&n&&!g?e.renderTile(t,72,24,i,s,r,l+8):e.renderTile(t,n?48:40,h?32:40,i,s,r,l+8):e.renderTile(t,40,40,i,s,r,l+8),h||A?h&&A&&!c?e.renderTile(t,64,24,i,s,r+8,l+8):e.renderTile(t,A?48:56,h?32:40,i,s,r+8,l+8):e.renderTile(t,56,40,i,s,r+8,l+8)}}(7),startingPosition:new n(999)},a=Object.entries(A).map((([e,t])=>t));var o,g;(g=o||(o={}))[g.OWNED=1]="OWNED",g[g.VISIBLE=6]="VISIBLE";let c=!1;window.onload=()=>{c=!0,k(),E()};let w=!1,u=!1,f=0,T=0,m=0,M=0,S=0,p=0;let B=3;let D=0;const v=(e=>{const t=new Image;return D++,t.onload=()=>{D--,0===D&&E()},t.src=e,t})(i),y=document.querySelector("#map"),X=y.getContext("2d"),b=new class{constructor(){t(this,"scrollX",0),t(this,"scrollY",0),t(this,"scrollSpeed",3),t(this,"keys",[]),window.onkeydown=e=>{this.keys[e.keyCode]=!0},window.onkeyup=e=>{this.keys[e.keyCode]=!1}}update(e,t,i,s){return this.scrollX=e,this.scrollY=t,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&i&&i(),this.keys[49]&&s&&s(),[this.scrollX,this.scrollY]}},H=new Array(1);for(let U=0;U<H.length;U++)H[U]={name:"Base",imageX:0,imageY:9};const O=new class{constructor(e,s){t(this,"tiles"),t(this,"data"),t(this,"tilesState"),t(this,"tileSize",16),t(this,"tickCount",0),t(this,"tileImage"),t(this,"imagesToLoad",0),t(this,"width"),t(this,"height"),this.width=e,this.height=s,this.tiles=new Array(e*s),this.data=new Array(e*s),this.tilesState=new Array(e*s),this.tileImage=this.loadImage(i)}loadImage(e){var t=new Image;return this.imagesToLoad++,t.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},t.src=e,t}init(){const e=((e,t)=>{for(;;){const i=r(e,t),s=new Array(256);for(let r=0;r<e*t;r++)s[255&i[0][r]]++;if(!(s[2]<100||s[1]<100))return i}})(this.width,this.height);this.tiles=e[0],this.tilesState=e[1],this.data=e[1],this.tilesState.fill(0)}update(){this.tickCount++,this.tickCount>=Number.MAX_VALUE&&(this.tickCount=0);for(let e=0;e<this.width*this.height/50;e++){const e=Math.round(Math.random()*this.width),t=Math.round(Math.random()*this.height);this.getTile(e,t).update(this,e,t)}}render(e,t,i,s,r){const l=Math.floor(-i/this.tileSize),d=Math.floor(-s/this.tileSize),h=Math.ceil((-i+e.width/r)/this.tileSize),n=Math.ceil((-s+e.height/r)/this.tileSize);for(let o=d;o<n;o++)for(let e=l;e<h;e++){const r=this.getTile(e,o),l=this.getTileState(e,o,1);if(r.isOnGrass){a.find((e=>e.id===A.grass.id)).render(this,t,e,o,i,s)}else if(r.isOnSand){a.find((e=>e.id===A.sand.id)).render(this,t,e,o,i,s)}r.render(this,t,e,o,i,s),1===l&&t.drawImage(this.tileImage,0,72,16,16,e*this.tileSize+i,o*this.tileSize+s,16,16)}for(let A=d;A<n;A++)for(let e=l;e<h;e++){const r=this.getTileState(e,A,6);if(1===r)t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,A*this.tileSize+s+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,A*this.tileSize+s+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,A*this.tileSize+s+8,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,A*this.tileSize+s+8,8,8);else for(let l=0;l<4;l++){const d=l%2*2-1,h=2*(l>>1)-1,n=this.getTileState(e,A+h,6)!==r,a=this.getTileState(e+d,A,6)!==r;let o=25,g=1;3===r&&(g+=3),n&&(g+=h),a&&(o+=d),t.drawImage(this.tileImage,8*o,8*g,8,8,e*this.tileSize+i+l%2*8,A*this.tileSize+s+8*(l>>1),8,8)}}}renderTile(e,t,i,s,r,l,d){e.drawImage(this.tileImage,t,i,8,8,s*this.tileSize+l,r*this.tileSize+d,8,8)}getTile(e,t){if(e<0||t<0||e>=this.width||t>=this.height)return A.water;const i=a.find((i=>this.tiles[e+t*this.width]===i.id));return null!=i?i:A.water}getTileState(e,t,i){return e<0||t<0||e>=this.width||t>=this.height?0:6===i?(this.tilesState[e+t*this.width]&i)>>1:this.tilesState[e+t*this.width]&i}setTileState(e,t,i,s){if(!(e<0||t<0||e>=this.width||t>=this.height))if(6===s){const s=this.tilesState[e+t*this.width];this.tilesState[e+t*this.width]=i<<1|1&s}else this.tilesState[e+t*this.width]^=i,this.tiles[e+t*this.width]=A.dirt.id}setTile(e,t,i){e<0||t<0||e>=this.width||t>=this.height||(this.tiles[e+t*this.width]=i.id)}setData(e,t,i){e<0||t<0||e>=this.width||t>=this.height||(this.data[e+t*this.width]=i)}getData(e,t){return e<0||t<0||e>=this.width||t>=this.height?0:255&this.data[e+t*this.width]}recalcVisibility(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){let i=this.getTileState(t,e,6);3===i&&(i>>=1),this.setTileState(t,e,i,6)}for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){this.getTileState(t,e,1)&&this.revealTile(t,e,4)}}revealTile(e,t,i){for(let s=t-i;s<=t+i;s++)if(!(s<0||s>=this.height))for(let r=e-i;r<=e+i;r++){if(r<0||r>=this.width)continue;const l=r-e,d=s-t;if(l*l+d*d<=i*i+2){if(0===s||0===r||r===this.width-1||s===this.height-1)continue;this.setTileState(r,s,3,6)}}}}(128,128),E=()=>{!c||D>0||(y.width=window.innerWidth,y.height=window.innerHeight,y.onmousedown=e=>{e.preventDefault(),w=!0,u=!1,f=e.clientX,T=e.clientY},y.onclick=e=>{if(w=!1,!u){const t=Math.floor(m+16*-S+window.innerWidth/B/2),i=Math.floor(M+16*-p+window.innerHeight/B/2),s=Math.floor((e.clientX/B-t)/16),r=Math.floor((e.clientY/B-i)/16);G(s,r,e.clientX/B,e.clientY/B)}},window.onmousemove=e=>{if(!w)return;e.preventDefault();const t=e.clientX-f,i=e.clientY-T;(u||t*t+i*i>64)&&(u=!0,m+=t/B,M+=i/B,f=e.clientX,T=e.clientY)},P())},k=()=>{for(let e=0;e<128;e++)for(let t=0;t<128;t++){const i=t+128*e;O.tiles[i]===A.startingPosition.id&&(S=t,p=e,O.setTileState(S,p,1,o.OWNED),O.recalcVisibility())}Q()};window.onresize=E;let C=null,I=null,z=!1;const G=(e,t,i=800,s=600)=>{const r=Math.floor(X.canvas.width/B),l=Math.floor(X.canvas.height/B);if(i>=0&&i<=r&&s>=l-35&&s<=l&&C&&I){return void(O.getTile(C,I).isPassable&&L(i,s))}if(e<0||t<0||e>128||t>128)return C=null,void(I=null);const d=O.getTileState(e,t,o.VISIBLE);if(0===d)return C=null,void(I=null);C===e&&I===t||(C=e,I=t,z=3===d)},Q=()=>{requestAnimationFrame(Q);const e=b.update(m,M,(()=>{}),(()=>{C&&I&&(O.setTileState(C,I,1,o.OWNED),O.recalcVisibility(),C=null,I=null)}));m===e[0]&&M===e[1]||(m=e[0],M=e[1]),O.update()},P=()=>{requestAnimationFrame(P);B=Math.max(Math.floor(y.height/300+1),Math.floor(y.width/(16/9*300)+1)),m>16*S&&(m=16*S),M>16*p&&(M=16*p),m<16*S-2016&&(m=16*S-2016),M<16*p-2016&&(M=16*p-2016),X.imageSmoothingEnabled=!1,X.setTransform(B,0,0,B,0,0);const e=Math.floor(m+16*-S+window.innerWidth/B/2),t=Math.floor(M+16*-p+window.innerHeight/B/2);O.render(y,X,e,t,B);for(var i=0;i<H.length;i++){const e=Math.floor(X.canvas.width/B),t=Math.floor(X.canvas.height/B);X.fillStyle="rgba(255, 255, 255, 0.3)",X.fillRect(0,t-35,e,t),F(H[i].name,e/2+2,t-25-5,3),W(H[i].imageX,H[i].imageY,e/2,t-25)}if(C&&I&&(X.strokeStyle="white",X.strokeRect(16*C+e,16*I+t,16,16),z)){const i=O.getTile(C,I).getOutcome();i&&(X.fillStyle="rgba(0, 0, 0, 0.3)",X.fillRect(16*C+e+16,16*I+t,18,16),X.drawImage(v,8*d[i.type].imageX,8*d[i.type].imageY,8,8,16*C+e+18,16*I+t+4,8,8),F(`${i.amount}`,16*C+e+27,16*I+t+5,5))}Y()},N=[{imageX:0,imageY:11},{imageX:1,imageY:11}],Y=()=>{for(let e=0;e<N.length;e++)X.drawImage(v,8*N[e].imageX,8*N[e].imageY,8,8,4,4+14*e,8,8),F("0",14,5+14*e,6)},x="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",F=(e,t,i,s=8)=>{e=e.toUpperCase();for(var r=0;r<e.length;r++){var l=x.indexOf(e.charAt(r)),d=0+l%32,h=29+(l>>5);X.drawImage(v,8*d,8*h,8,8,t+r*s,i,s,s)}},L=(e,t)=>{const i=Math.floor(X.canvas.width/B)/2,s=Math.floor(X.canvas.height/B)-25;e>=i&&e<=i+16&&t>=s&&t<=s+16&&C&&I&&(O.setTileState(C,I,1,o.OWNED),O.recalcVisibility(),C=null,I=null)},W=(e,t,i,s)=>{X.beginPath(),X.strokeStyle="yellow",X.rect(i,s,16,16),X.stroke(),X.drawImage(v,8*e,8*t,16,16,i,s,16,16)};

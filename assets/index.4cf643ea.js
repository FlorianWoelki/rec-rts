var e=Object.defineProperty,t=("undefined"!=typeof require&&require,(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s));!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i="data:image/png;base64,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";Math.seed=e=>{const t=4294967295;let i=123456789+e&t,s=987654321-e&t;return()=>{s=36969*(65535&s)+(s>>>16)&t,i=18e3*(65535&i)+(i>>>16)&t;let e=(s<<16)+(65535&i)>>>0;return e/=4294967296,e}};let s=Math.seed(Math.random()*(10+90*Math.random()));class r{constructor(e,i,r){t(this,"w"),t(this,"h"),t(this,"values"),this.w=e,this.h=i,this.values=new Array(e*i);for(let t=0;t<i;t+=r)for(let i=0;i<e;i+=r)this.setSample(i,t,2*s()-1);let l=r,h=1/e,a=1;do{const t=l/2;for(let r=0;r<i;r+=l)for(let i=0;i<e;i+=l){const e=(this.sample(i,r)+this.sample(i+l,r)+this.sample(i,r+l)+this.sample(i+l,r+l))/4+(2*s()-1)*l*h;this.setSample(i+t,r+t,e)}for(let i=0;i<e;i+=l)for(let r=0;r<e;r+=l){const e=this.sample(r,i),a=this.sample(r+l,i),d=this.sample(r,i+l),n=this.sample(r+t,i+t),A=this.sample(r+t,i-t),o=this.sample(r-t,i+t),g=(e+a+n+A)/4+(2*s()-1)*l*h*.5,c=(e+d+n+o)/4+(2*s()-1)*l*h*.5;this.setSample(r+t,i,g),this.setSample(r,i+t,c)}l/=2,h*=a+.8,a*=.3}while(l>1)}sample(e,t){return this.values[(e&this.w-1)+(t&this.h-1)*this.w]}setSample(e,t,i){this.values[(e&this.w-1)+(t&this.h-1)*this.w]=i}}const l=(e,t,i=Math.random()*Number.MAX_SAFE_INTEGER)=>{s=Math.seed(i);const l=new r(e,t,16),a=new r(e,t,16),d=new r(e,t,16),n=new r(e,t,32),o=new r(e,t,32),g=new Array(e*t),c=new Array(e*t);for(let s=0;s<t;s++)for(let i=0;i<e;i++){const r=i+s*e;let h=3*Math.abs(n.values[r]-o.values[r])-2,c=Math.abs(l.values[r]-a.values[r]);c=3*Math.abs(c-d.values[r])-2;let w=i/(e-1)*2-1,u=s/(t-1)*2-1;w<0&&(w=-w),u<0&&(u=-u);let f=w>=u?w:u;f*=f*f*f,f*=f*f*f,h=h+1-20*f,g[r]=h<-.5?A.water.id:h>.5&&c<-1.5?A.rock.id:A.grass.id}for(let r=0;r<e*t/2800;r++){let i=Math.round(s()*e),r=Math.round(s()*t);for(let l=0;l<10;l++){let l=i+Math.round(21*s()-10),h=r+Math.round(21*s()-10);for(let i=0;i<100;i++){let i=l+Math.round(5*s())-Math.round(5*s()),r=h+Math.round(5*s())-Math.round(5*s());for(let s=r-1;s<=r+1;s++)for(let r=i-1;r<=i+1;r++)r>=0&&s>=0&&r<e&&s<t&&1==g[r+s*e]&&(g[r+s*e]=A.sand.id)}}}for(let r=0;r<e*t/400;r++){const i=Math.round(s()*e),r=Math.round(s()*t);for(let l=0;l<200;l++){const l=i+Math.round(15*s())-Math.round(15*s()),h=r+Math.round(15*s())-Math.round(15*s());l>=0&&h>=0&&l<e&&h<t&&g[l+h*e]==A.grass.id&&(g[l+h*e]=A.tree.id)}}for(let r=0;r<e*t/40;r++){const i=Math.round(s()*e),r=Math.round(s()*t);i>=0&&r>=0&&i<e&&r<<t&&g[i+r*e]===A.sand.id&&(g[i+r*e]=A.cactus.id)}for(let r=0;r<e*t/400;r++){const i=Math.round(s()*e),r=Math.round(s()*t);for(let l=0;l<30;l++){const l=i+Math.round(5*s())-Math.round(5*s()),h=r+Math.round(5*s())-Math.round(5*s());l>=0&&h>=0&&l<e&&h<t&&g[l+h*e]==A.grass.id&&(g[l+h*e]=A.flower.id)}}let w=-1,u=-1;for(;-1===w||-1===u;){w=Math.round(s()*e),u=Math.round(s()*t);e:for(let t=u-1;t<=u+1;t++)for(let i=w-1;i<=w+1;i++)if(g[i+t*e]===A.water.id||g[i+t*e]===A.rock.id||g[i+t*e]===A.tree.id){w=-1,u=-1;break e}const i=h(g,e,w,u,3,3,A.tree.id),r=h(g,e,w,u,5,1,A.rock.id);i&&r||(w=-1,u=-1)}return g[w+u*e]=A.startingPosition.id,[g,c]},h=(e,t,i,s,r,l,h)=>{let a=0;for(let d=s-r;d<=s+r;d++)for(let s=i-r;s<=i+r;s++)e[s+d*t]===h&&a++;return a>=l},a={wood:{imageX:0,imageY:11},stone:{imageX:1,imageY:11}};class d{constructor(e){t(this,"id"),t(this,"isFarmable",!1),t(this,"isPassable",!0),t(this,"isOnGrass",!1),t(this,"isOnSand",!1),t(this,"color",0),this.id=e}update(e,t,i){}getOutcome(){}}class n extends d{constructor(e){super(e),this.color=1096065}render(e,t,i,s,r,l){const h=e.getTile(i,s-1).id===this.id||e.getTile(i,s-1).id===A.tree.id||e.getTile(i,s-1).id===A.flower.id,a=e.getTile(i,s+1).id===this.id||e.getTile(i,s+1).id===A.tree.id||e.getTile(i,s+1).id===A.flower.id,d=e.getTile(i-1,s).id===this.id||e.getTile(i-1,s).id===A.tree.id||e.getTile(i-1,s).id===A.flower.id,n=e.getTile(i+1,s).id===this.id||e.getTile(i+1,s).id===A.tree.id||e.getTile(i+1,s).id===A.flower.id,o=e.getTile(i-1,s-1).id===this.id||e.getTile(i-1,s-1).id===A.tree.id||e.getTile(i-1,s-1).id===A.flower.id,g=e.getTile(i+1,s-1).id===this.id||e.getTile(i+1,s-1).id===A.tree.id||e.getTile(i+1,s-1).id===A.flower.id,c=e.getTile(i-1,s+1).id===this.id||e.getTile(i-1,s+1).id===A.tree.id||e.getTile(i-1,s+1).id===A.flower.id,w=e.getTile(i+1,s+1).id===this.id||e.getTile(i+1,s+1).id===A.tree.id||e.getTile(i+1,s+1).id===A.flower.id;h||d?h&&d&&!o?e.renderTile(t,32,32,i,s,r,l):e.renderTile(t,d?8:0,h?32:24,i,s,r,l):e.renderTile(t,0,24,i,s,r,l),h||n?h&&n&&!g?e.renderTile(t,24,32,i,s,r+8,l):e.renderTile(t,n?8:16,h?32:24,i,s,r+8,l):e.renderTile(t,16,24,i,s,r+8,l),a||d?a&&d&&!c?e.renderTile(t,32,24,i,s,r,l+8):e.renderTile(t,d?8:0,a?32:40,i,s,r,l+8):e.renderTile(t,0,40,i,s,r,l+8),a||n?a&&n&&!w?e.renderTile(t,24,24,i,s,r+8,l+8):e.renderTile(t,n?8:16,a?32:40,i,s,r+8,l+8):e.renderTile(t,16,40,i,s,r+8,l+8)}}const A={water:new class extends d{constructor(e){super(e),t(this,"position1",0),t(this,"position2",0),t(this,"position3",0),t(this,"position4",0),t(this,"shouldAnimate",!0),this.isPassable=!1,this.color=3900150}render(e,t,i,s,r,l){this.shouldAnimate&&(this.position1=Math.round(3+3*Math.random()),this.position2=Math.round(3+3*Math.random()),this.position3=Math.round(3+3*Math.random()),this.position4=Math.round(3+3*Math.random()),this.shouldAnimate=!1);const h=e.getTile(i,s-1).id===this.id,a=e.getTile(i,s+1).id===this.id,d=e.getTile(i-1,s).id===this.id,n=e.getTile(i+1,s).id===this.id,A=e.getTile(i-1,s-1).id===this.id,o=e.getTile(i+1,s-1).id===this.id;h||d?h&&d&&!A?e.renderTile(t,32,8,i,s,r,l):h&&d?e.renderTile(t,8*this.position1,16,i,s,r,l):e.renderTile(t,d?8:0,h?8:0,i,s,r,l):e.renderTile(t,0,0,i,s,r,l),h||n?h&&n&&!o?e.renderTile(t,24,8,i,s,r+8,l):h&&n?e.renderTile(t,8*this.position2,16,i,s,r+8,l):e.renderTile(t,n?8:16,h?8:0,i,s,r+8,l):e.renderTile(t,16,0,i,s,r+8,l),a||d?a&&d?e.renderTile(t,8*this.position3,16,i,s,r,l+8):e.renderTile(t,d?8:0,a?8:16,i,s,r,l+8):e.renderTile(t,0,16,i,s,r,l+8),a||n?a&&n?e.renderTile(t,8*this.position4,16,i,s,r+8,l+8):e.renderTile(t,n?8:16,a?8:16,i,s,r+8,l+8):e.renderTile(t,16,16,i,s,r+8,l+8),h&&!d&&A&&e.renderTile(t,32,0,i,s,r,l-8),h&&!n&&o&&e.renderTile(t,24,0,i,s,r+8,l-8)}update(e,t,i){e.tickCount%10==0&&(this.shouldAnimate=!0)}}(0),grass:new n(1),sand:new class extends d{constructor(e){super(e),this.color=16498468}render(e,t,i,s,r,l){e.renderTile(t,40,0,i,s,r,l),e.renderTile(t,40,0,i,s,r+8,l),e.renderTile(t,40,0,i,s,r,l+8),e.renderTile(t,40,0,i,s,r+8,l+8)}}(2),tree:new class extends d{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1,this.isOnGrass=!0,this.color=417606}render(e,t,i,s,r,l){e.renderTile(t,16,72,i,s,r,l),e.renderTile(t,24,72,i,s,r+8,l),e.renderTile(t,16,80,i,s,r,l+8),e.renderTile(t,24,80,i,s,r+8,l+8)}getOutcome(){return{amount:3,type:"wood"}}}(3),rock:new class extends d{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1,this.color=10265519}render(e,t,i,s,r,l){const h=e.getTile(i,s-1).id===this.id,a=e.getTile(i,s+1).id===this.id,d=e.getTile(i-1,s).id===this.id,n=e.getTile(i+1,s).id===this.id,A=e.getTile(i-1,s-1).id===this.id,o=e.getTile(i+1,s-1).id===this.id,g=e.getTile(i-1,s+1).id===this.id,c=e.getTile(i+1,s+1).id===this.id;h||d?h&&d&&!A?e.renderTile(t,32,56,i,s,r,l):e.renderTile(t,d?8:0,h?56:48,i,s,r,l):e.renderTile(t,0,48,i,s,r,l),h||n?h&&n&&!o?e.renderTile(t,24,56,i,s,r+8,l):e.renderTile(t,n?8:16,h?56:48,i,s,r+8,l):e.renderTile(t,16,48,i,s,r+8,l),a||d?a&&d&&!g?e.renderTile(t,32,48,i,s,r,l+8):e.renderTile(t,d?8:0,a?56:64,i,s,r,l+8):e.renderTile(t,0,64,i,s,r,l+8),a||n?a&&n&&!c?e.renderTile(t,24,48,i,s,r+8,l+8):e.renderTile(t,n?8:16,a?56:64,i,s,r+8,l+8):e.renderTile(t,16,64,i,s,r+8,l+8)}getOutcome(){return{amount:3,type:"stone"}}}(4),flower:new class extends d{constructor(e){super(e),this.isOnGrass=!0,this.color=1096065}render(e,t,i,s,r,l){e.renderTile(t,48,0,i,s,r+4,l+4)}}(5),cactus:new class extends d{constructor(e){super(e),this.isOnSand=!0,this.color=16498468}render(e,t,i,s,r,l){e.renderTile(t,56,0,i,s,r,l),e.renderTile(t,64,0,i,s,r+8,l),e.renderTile(t,56,8,i,s,r,l+8),e.renderTile(t,64,8,i,s,r+8,l+8)}}(6),dirt:new class extends d{constructor(e){super(e),this.color=7877903}render(e,t,i,s,r,l){const h=e.getTile(i,s-1).id===this.id,a=e.getTile(i,s+1).id===this.id,d=e.getTile(i-1,s).id===this.id,n=e.getTile(i+1,s).id===this.id,A=e.getTile(i-1,s-1).id===this.id,o=e.getTile(i+1,s-1).id===this.id,g=e.getTile(i-1,s+1).id===this.id,c=e.getTile(i+1,s+1).id===this.id;h||d?h&&d&&!A?e.renderTile(t,72,32,i,s,r,l):e.renderTile(t,d?48:40,h?32:24,i,s,r,l):e.renderTile(t,40,24,i,s,r,l),h||n?h&&n&&!o?e.renderTile(t,64,32,i,s,r+8,l):e.renderTile(t,n?48:56,h?32:24,i,s,r+8,l):e.renderTile(t,56,24,i,s,r+8,l),a||d?a&&d&&!g?e.renderTile(t,72,24,i,s,r,l+8):e.renderTile(t,d?48:40,a?32:40,i,s,r,l+8):e.renderTile(t,40,40,i,s,r,l+8),a||n?a&&n&&!c?e.renderTile(t,64,24,i,s,r+8,l+8):e.renderTile(t,n?48:56,a?32:40,i,s,r+8,l+8):e.renderTile(t,56,40,i,s,r+8,l+8)}}(7),startingPosition:new n(999)},o=Object.entries(A).map((([e,t])=>t));var g,c;(c=g||(g={}))[c.OWNED=1]="OWNED",c[c.VISIBLE=6]="VISIBLE";class w{constructor(e,i,s){t(this,"map2d"),t(this,"imageData"),t(this,"minimapCanvas",document.createElement("canvas")),t(this,"width"),t(this,"height"),this.map2d=e,this.width=i,this.height=s,this.imageData=e.createImageData(i,s),this.minimapCanvas.width=this.imageData.width,this.minimapCanvas.height=this.imageData.height}getRGB(e){return[e>>16&255,e>>8&255,255&e]}render(e,t,i,s){const r=Math.floor(this.map2d.canvas.width/s)-e.width/(i+s+10)-8,l=Math.round(e.width/(i+s+10));for(let h=0;h<this.height;h++)for(let e=0;e<this.width;e++){const i=e+h*this.width,s=t.getTile(e,h),[r,l,a]=this.getRGB(s.color);t.getTileState(e,h,g.OWNED)?(this.imageData.data[4*i]=255,this.imageData.data[4*i+1]=0,this.imageData.data[4*i+2]=0,this.imageData.data[4*i+3]=255):t.getTileState(e,h,g.VISIBLE)>=1?(this.imageData.data[4*i]=r,this.imageData.data[4*i+1]=l,this.imageData.data[4*i+2]=a,this.imageData.data[4*i+3]=255):(this.imageData.data[4*i]=0,this.imageData.data[4*i+1]=0,this.imageData.data[4*i+2]=0,this.imageData.data[4*i+3]=255)}this.minimapCanvas.getContext("2d").putImageData(this.imageData,0,0),this.map2d.drawImage(this.minimapCanvas,r,8,l,l),this.map2d.strokeStyle="rgba(255, 255, 255, 0.35)",this.map2d.strokeRect(r,8,l,l)}}let u=!1,f=!1;window.onload=()=>{u=!0,Q()};let m=!1,T=!1,p=0,D=0,v=0,M=0,S=0,P=0;let I=3;let O=0;const b=(e=>{const t=new Image;return O++,t.onload=()=>{O--,0===O&&Q()},t.src=e,t})(i),B=document.querySelector("#map"),H=B.getContext("2d"),y=new class{constructor(){t(this,"scrollX",0),t(this,"scrollY",0),t(this,"scrollSpeed",3),t(this,"keys",[]),window.onkeydown=e=>{this.keys[e.keyCode]=!0},window.onkeyup=e=>{this.keys[e.keyCode]=!1}}update(e,t,i,s){return this.scrollX=e,this.scrollY=t,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&i&&i(),this.keys[49]&&s&&s(),[this.scrollX,this.scrollY]}};let E;const C=new Array(1);for(let Z=0;Z<C.length;Z++)C[Z]={name:"Base",imageX:0,imageY:9};const z=new class{constructor(e,s,r){t(this,"tiles"),t(this,"data"),t(this,"tilesState"),t(this,"tileSize",16),t(this,"tickCount",0),t(this,"tileImage"),t(this,"imagesToLoad",0),t(this,"width"),t(this,"height"),t(this,"seed"),this.width=e,this.height=s,this.seed=r,this.tiles=new Array(e*s),this.data=new Array(e*s),this.tilesState=new Array(e*s),this.tileImage=this.loadImage(i)}loadImage(e){var t=new Image;return this.imagesToLoad++,t.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},t.src=e,t}init(){const e=((e,t,i=Math.random()*Number.MAX_SAFE_INTEGER)=>{for(;;){const s=l(e,t,i),r=new Array(256);for(let i=0;i<e*t;i++)r[255&s[0][i]]++;if(!(r[255&A.rock.id]<100||r[255&A.sand.id]<100||r[255&A.grass.id]<100||r[255&A.tree.id]<100))return s}})(this.width,this.height,this.seed);this.tiles=e[0],this.tilesState=e[1],this.data=e[1],this.tilesState.fill(0)}update(){this.tickCount++,this.tickCount>=Number.MAX_VALUE&&(this.tickCount=0);for(let e=0;e<this.width*this.height/50;e++){const e=Math.round(Math.random()*this.width),t=Math.round(Math.random()*this.height);this.getTile(e,t).update(this,e,t)}}render(e,t,i,s,r){const l=Math.floor(-i/this.tileSize),h=Math.floor(-s/this.tileSize),a=Math.ceil((-i+e.width/r)/this.tileSize),d=Math.ceil((-s+e.height/r)/this.tileSize);for(let n=h;n<d;n++)for(let e=l;e<a;e++){const r=this.getTile(e,n),l=this.getTileState(e,n,1);if(r.isOnGrass){o.find((e=>e.id===A.grass.id)).render(this,t,e,n,i,s)}else if(r.isOnSand){o.find((e=>e.id===A.sand.id)).render(this,t,e,n,i,s)}r.render(this,t,e,n,i,s),1===l&&t.drawImage(this.tileImage,0,72,16,16,e*this.tileSize+i,n*this.tileSize+s,16,16)}for(let n=h;n<d;n++)for(let e=l;e<a;e++){const r=this.getTileState(e,n,6);if(1===r)t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,n*this.tileSize+s+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,n*this.tileSize+s+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,n*this.tileSize+s+8,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,n*this.tileSize+s+8,8,8);else for(let l=0;l<4;l++){const h=l%2*2-1,a=2*(l>>1)-1,d=this.getTileState(e,n+a,6)!==r,A=this.getTileState(e+h,n,6)!==r;let o=25,g=1;3===r&&(g+=3),d&&(g+=a),A&&(o+=h),t.drawImage(this.tileImage,8*o,8*g,8,8,e*this.tileSize+i+l%2*8,n*this.tileSize+s+8*(l>>1),8,8)}}}renderTile(e,t,i,s,r,l,h){e.drawImage(this.tileImage,t,i,8,8,s*this.tileSize+l,r*this.tileSize+h,8,8)}getTile(e,t){if(e<0||t<0||e>=this.width||t>=this.height)return A.water;const i=o.find((i=>this.tiles[e+t*this.width]===i.id));return null!=i?i:A.water}getTileState(e,t,i){return e<0||t<0||e>=this.width||t>=this.height?0:6===i?(this.tilesState[e+t*this.width]&i)>>1:this.tilesState[e+t*this.width]&i}setTileState(e,t,i,s){if(!(e<0||t<0||e>=this.width||t>=this.height))if(6===s){const s=this.tilesState[e+t*this.width];this.tilesState[e+t*this.width]=i<<1|1&s}else this.tilesState[e+t*this.width]^=i,this.tiles[e+t*this.width]=A.dirt.id}setTile(e,t,i){e<0||t<0||e>=this.width||t>=this.height||(this.tiles[e+t*this.width]=i.id)}setData(e,t,i){e<0||t<0||e>=this.width||t>=this.height||(this.data[e+t*this.width]=i)}getData(e,t){return e<0||t<0||e>=this.width||t>=this.height?0:255&this.data[e+t*this.width]}recalcVisibility(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){let i=this.getTileState(t,e,6);3===i&&(i>>=1),this.setTileState(t,e,i,6)}for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){this.getTileState(t,e,1)&&this.revealTile(t,e,4)}}revealTile(e,t,i){for(let s=t-i;s<=t+i;s++)if(!(s<0||s>=this.height))for(let r=e-i;r<=e+i;r++){if(r<0||r>=this.width)continue;const l=r-e,h=s-t;if(l*l+h*h<=i*i+2){if(0===s||0===r||r===this.width-1||s===this.height-1)continue;this.setTileState(r,s,3,6)}}}}(128,128),Q=()=>{if(u&&!(O>0)){if(B.width=window.innerWidth,B.height=window.innerHeight,E=new w(H,128,128),B.onmousedown=e=>{e.preventDefault(),m=!0,T=!1,p=e.clientX,D=e.clientY},B.onclick=e=>{if(m=!1,!T){const t=Math.floor(v+16*-S+window.innerWidth/I/2),i=Math.floor(M+16*-P+window.innerHeight/I/2),s=Math.floor((e.clientX/I-t)/16),r=Math.floor((e.clientY/I-i)/16);F(s,r,e.clientX/I,e.clientY/I)}},window.onmousemove=e=>{if(!m)return;e.preventDefault();const t=e.clientX-p,i=e.clientY-D;(T||t*t+i*i>64)&&(T=!0,v+=t/I,M+=i/I,p=e.clientX,D=e.clientY)},!f){for(let e=0;e<128;e++)for(let t=0;t<128;t++){const i=t+128*e;z.tiles[i]===A.startingPosition.id&&(S=t,P=e,z.setTileState(S,P,1,g.OWNED),z.recalcVisibility())}G(),f=!0}q()}};window.onresize=Q;let k=null,L=null,X=!1;const F=(e,t,i=800,s=600)=>{const r=Math.floor(H.canvas.width/I),l=Math.floor(H.canvas.height/I);if(i>=0&&i<=r&&s>=l-35&&s<=l&&k&&L){return void(z.getTile(k,L).isPassable&&R(i,s))}if(e<0||t<0||e>128||t>128)return k=null,void(L=null);const h=z.getTileState(e,t,g.VISIBLE);if(0===h)return k=null,void(L=null);k===e&&L===t||(k=e,L=t,X=3===h)};let N=Date.now(),Y=Date.now(),x=0;const G=()=>{requestAnimationFrame(G),N=Y,Y=Date.now(),x+=Y-N,x>=60&&(x=0,U());const e=y.update(v,M,(()=>{}),(()=>{k&&L&&(z.setTileState(k,L,1,g.OWNED),z.recalcVisibility(),k=null,L=null)}));v===e[0]&&M===e[1]||(v=e[0],M=e[1]),q()},U=()=>{z.update()},q=()=>{I=Math.max(Math.floor(B.height/300+1),Math.floor(B.width/(16/9*300)+1)),v>16*S&&(v=16*S),M>16*P&&(M=16*P),v<16*S-2016&&(v=16*S-2016),M<16*P-2016&&(M=16*P-2016),H.imageSmoothingEnabled=!1,H.setTransform(I,0,0,I,0,0);const e=Math.floor(v+16*-S+window.innerWidth/I/2),t=Math.floor(M+16*-P+window.innerHeight/I/2);z.render(B,H,e,t,I);for(var i=0;i<C.length;i++){const e=Math.floor(H.canvas.width/I),t=Math.floor(H.canvas.height/I);H.fillStyle="rgba(255, 255, 255, 0.3)",H.fillRect(0,t-35,e,t),V(C[i].name,e/2+2,t-25-5,3),j(C[i].imageX,C[i].imageY,e/2,t-25)}if(k&&L&&(H.strokeStyle="white",H.strokeRect(16*k+e,16*L+t,16,16),X)){const i=z.getTile(k,L).getOutcome();i&&(H.fillStyle="rgba(0, 0, 0, 0.3)",H.fillRect(16*k+e+16,16*L+t,18,16),H.drawImage(b,8*a[i.type].imageX,8*a[i.type].imageY,8,8,16*k+e+18,16*L+t+4,8,8),V(`${i.amount}`,16*k+e+27,16*L+t+5,5))}K(),E.render(B,z,16,I)},J=[{imageX:0,imageY:11},{imageX:1,imageY:11}],K=()=>{for(let e=0;e<J.length;e++)H.drawImage(b,8*J[e].imageX,8*J[e].imageY,8,8,4,4+14*e,8,8),V("0",14,5+14*e,6)},W="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",V=(e,t,i,s=8)=>{e=e.toUpperCase();for(var r=0;r<e.length;r++){var l=W.indexOf(e.charAt(r)),h=0+l%32,a=29+(l>>5);H.drawImage(b,8*h,8*a,8,8,t+r*s,i,s,s)}},R=(e,t)=>{const i=Math.floor(H.canvas.width/I)/2,s=Math.floor(H.canvas.height/I)-25;e>=i&&e<=i+16&&t>=s&&t<=s+16&&k&&L&&(z.setTileState(k,L,1,g.OWNED),z.recalcVisibility(),k=null,L=null)},j=(e,t,i,s)=>{H.beginPath(),H.strokeStyle="yellow",H.rect(i,s,16,16),H.stroke(),H.drawImage(b,8*e,8*t,16,16,i,s,16,16)};

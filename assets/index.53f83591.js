var e=Object.defineProperty,t=("undefined"!=typeof require&&require,(t,i,r)=>(((t,i,r)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r})(t,"symbol"!=typeof i?i+"":i,r),r));!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i="data:image/png;base64,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";class r{constructor(e,i,r){t(this,"w"),t(this,"h"),t(this,"values"),this.w=e,this.h=i,this.values=new Array(e*i);for(let t=0;t<i;t+=r)for(let i=0;i<e;i+=r)this.setSample(i,t,2*Math.random()-1);let s=r,l=1/e,n=1;do{const t=s/2;for(let r=0;r<i;r+=s)for(let i=0;i<e;i+=s){const e=(this.sample(i,r)+this.sample(i+s,r)+this.sample(i,r+s)+this.sample(i+s,r+s))/4+(2*Math.random()-1)*s*l;this.setSample(i+t,r+t,e)}for(let i=0;i<e;i+=s)for(let r=0;r<e;r+=s){const e=this.sample(r,i),n=this.sample(r+s,i),A=this.sample(r,i+s),d=this.sample(r+t,i+t),a=this.sample(r+t,i-t),h=this.sample(r-t,i+t),o=(e+n+d+a)/4+(2*Math.random()-1)*s*l*.5,g=(e+A+d+h)/4+(2*Math.random()-1)*s*l*.5;this.setSample(r+t,i,o),this.setSample(r,i+t,g)}s/=2,l*=n+.8,n*=.3}while(s>1)}sample(e,t){return this.values[(e&this.w-1)+(t&this.h-1)*this.w]}setSample(e,t,i){this.values[(e&this.w-1)+(t&this.h-1)*this.w]=i}}const s=(e,t)=>{const i=new r(e,t,16),s=new r(e,t,16),n=new r(e,t,16),A=new r(e,t,32),d=new r(e,t,32),h=new Array(e*t),o=new Array(e*t);for(let r=0;r<t;r++)for(let l=0;l<e;l++){const o=l+r*e;let g=3*Math.abs(A.values[o]-d.values[o])-2,c=Math.abs(i.values[o]-s.values[o]);c=3*Math.abs(c-n.values[o])-2;let w=l/(e-1)*2-1,f=r/(t-1)*2-1;w<0&&(w=-w),f<0&&(f=-f);let u=w>=f?w:f;u*=u*u*u,u*=u*u*u,g=g+1-20*u,h[o]=g<-.5?a.water.id:g>.5&&c<-1.5?a.rock.id:a.grass.id}for(let r=0;r<e*t/2800;r++){let i=Math.round(Math.random()*e),r=Math.round(Math.random()*t);for(let s=0;s<10;s++){let s=i+Math.round(21*Math.random()-10),l=r+Math.round(21*Math.random()-10);for(let i=0;i<100;i++){let i=s+Math.round(5*Math.random())-Math.round(5*Math.random()),r=l+Math.round(5*Math.random())-Math.round(5*Math.random());for(let s=r-1;s<=r+1;s++)for(let r=i-1;r<=i+1;r++)r>=0&&s>=0&&r<e&&s<t&&1==h[r+s*e]&&(h[r+s*e]=a.sand.id)}}}for(let r=0;r<e*t/400;r++){const i=Math.round(Math.random()*e),r=Math.round(Math.random()*t);for(let s=0;s<200;s++){const s=i+Math.round(15*Math.random())-Math.round(15*Math.random()),l=r+Math.round(15*Math.random())-Math.round(15*Math.random());s>=0&&l>=0&&s<e&&l<t&&h[s+l*e]==a.grass.id&&(h[s+l*e]=a.tree.id)}}for(let r=0;r<e*t/40;r++){const i=Math.round(Math.random()*e),r=Math.round(Math.random()*t);i>=0&&r>=0&&i<e&&r<<t&&h[i+r*e]===a.sand.id&&(h[i+r*e]=a.cactus.id)}for(let r=0;r<e*t/400;r++){const i=Math.round(Math.random()*e),r=Math.round(Math.random()*t);for(let s=0;s<30;s++){const s=i+Math.round(5*Math.random())-Math.round(5*Math.random()),l=r+Math.round(5*Math.random())-Math.round(5*Math.random());s>=0&&l>=0&&s<e&&l<t&&h[s+l*e]==a.grass.id&&(h[s+l*e]=a.flower.id)}}let g=-1,c=-1;for(;-1===g||-1===c;){g=Math.round(Math.random()*e),c=Math.round(Math.random()*t);e:for(let t=c-1;t<=c+1;t++)for(let i=g-1;i<=g+1;i++)if(h[i+t*e]===a.water.id||h[i+t*e]===a.rock.id||h[i+t*e]===a.tree.id){g=-1,c=-1;break e}const i=l(h,e,g,c,3,3,a.tree.id),r=l(h,e,g,c,5,1,a.rock.id);i&&r||(g=-1,c=-1)}return h[g+c*e]=a.startingPosition.id,[h,o]},l=(e,t,i,r,s,l,n)=>{let A=0;for(let d=r-s;d<=r+s;d++)for(let r=i-s;r<=i+s;r++)e[r+d*t]===n&&A++;return A>=l},n={wood:{imageX:0,imageY:11},stone:{imageX:1,imageY:11}};class A{constructor(e){t(this,"id"),t(this,"isFarmable",!1),t(this,"isPassable",!0),t(this,"isOnGrass",!1),t(this,"isOnSand",!1),this.id=e}getOutcome(){}}class d extends A{render(e,t,i,r,s,l){const n=e.getTile(i,r-1).id===this.id||e.getTile(i,r-1).id===a.tree.id||e.getTile(i,r-1).id===a.flower.id,A=e.getTile(i,r+1).id===this.id||e.getTile(i,r+1).id===a.tree.id||e.getTile(i,r+1).id===a.flower.id,d=e.getTile(i-1,r).id===this.id||e.getTile(i-1,r).id===a.tree.id||e.getTile(i-1,r).id===a.flower.id,h=e.getTile(i+1,r).id===this.id||e.getTile(i+1,r).id===a.tree.id||e.getTile(i+1,r).id===a.flower.id,o=e.getTile(i-1,r-1).id===this.id||e.getTile(i-1,r-1).id===a.tree.id||e.getTile(i-1,r-1).id===a.flower.id,g=e.getTile(i+1,r-1).id===this.id||e.getTile(i+1,r-1).id===a.tree.id||e.getTile(i+1,r-1).id===a.flower.id,c=e.getTile(i-1,r+1).id===this.id||e.getTile(i-1,r+1).id===a.tree.id||e.getTile(i-1,r+1).id===a.flower.id,w=e.getTile(i+1,r+1).id===this.id||e.getTile(i+1,r+1).id===a.tree.id||e.getTile(i+1,r+1).id===a.flower.id;n||d?n&&d&&!o?e.renderTile(t,32,32,i,r,s,l):e.renderTile(t,d?8:0,n?32:24,i,r,s,l):e.renderTile(t,0,24,i,r,s,l),n||h?n&&h&&!g?e.renderTile(t,24,32,i,r,s+8,l):e.renderTile(t,h?8:16,n?32:24,i,r,s+8,l):e.renderTile(t,16,24,i,r,s+8,l),A||d?A&&d&&!c?e.renderTile(t,32,24,i,r,s,l+8):e.renderTile(t,d?8:0,A?32:40,i,r,s,l+8):e.renderTile(t,0,40,i,r,s,l+8),A||h?A&&h&&!w?e.renderTile(t,24,24,i,r,s+8,l+8):e.renderTile(t,h?8:16,A?32:40,i,r,s+8,l+8):e.renderTile(t,16,40,i,r,s+8,l+8)}}const a={water:new class extends A{constructor(e){super(e),this.isPassable=!1}render(e,t,i,r,s,l){const n=e.getTile(i,r-1).id===this.id,A=e.getTile(i,r+1).id===this.id,d=e.getTile(i-1,r).id===this.id,a=e.getTile(i+1,r).id===this.id,h=e.getTile(i-1,r-1).id===this.id,o=e.getTile(i+1,r-1).id===this.id;n||d?n&&d&&!h?e.renderTile(t,32,8,i,r,s,l):e.renderTile(t,d?8:0,n?8:0,i,r,s,l):e.renderTile(t,0,0,i,r,s,l),n||a?n&&a&&!o?e.renderTile(t,24,8,i,r,s+8,l):e.renderTile(t,a?8:16,n?8:0,i,r,s+8,l):e.renderTile(t,16,0,i,r,s+8,l),A||d?e.renderTile(t,d?8:0,A?8:16,i,r,s,l+8):e.renderTile(t,0,16,i,r,s,l+8),A||a?e.renderTile(t,a?8:16,A?8:16,i,r,s+8,l+8):e.renderTile(t,16,16,i,r,s+8,l+8),n&&!d&&h&&e.renderTile(t,32,0,i,r,s,l-8),n&&!a&&o&&e.renderTile(t,24,0,i,r,s+8,l-8)}}(0),grass:new d(1),sand:new class extends A{render(e,t,i,r,s,l){e.renderTile(t,40,0,i,r,s,l),e.renderTile(t,40,0,i,r,s+8,l),e.renderTile(t,40,0,i,r,s,l+8),e.renderTile(t,40,0,i,r,s+8,l+8)}}(2),tree:new class extends A{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1,this.isOnGrass=!0}render(e,t,i,r,s,l){e.renderTile(t,16,72,i,r,s,l),e.renderTile(t,24,72,i,r,s+8,l),e.renderTile(t,16,80,i,r,s,l+8),e.renderTile(t,24,80,i,r,s+8,l+8)}getOutcome(){return{amount:3,type:"wood"}}}(3),rock:new class extends A{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1}render(e,t,i,r,s,l){const n=e.getTile(i,r-1).id===this.id,A=e.getTile(i,r+1).id===this.id,d=e.getTile(i-1,r).id===this.id,a=e.getTile(i+1,r).id===this.id,h=e.getTile(i-1,r-1).id===this.id,o=e.getTile(i+1,r-1).id===this.id,g=e.getTile(i-1,r+1).id===this.id,c=e.getTile(i+1,r+1).id===this.id;n||d?n&&d&&!h?e.renderTile(t,32,56,i,r,s,l):e.renderTile(t,d?8:0,n?56:48,i,r,s,l):e.renderTile(t,0,48,i,r,s,l),n||a?n&&a&&!o?e.renderTile(t,24,56,i,r,s+8,l):e.renderTile(t,a?8:16,n?56:48,i,r,s+8,l):e.renderTile(t,16,48,i,r,s+8,l),A||d?A&&d&&!g?e.renderTile(t,32,48,i,r,s,l+8):e.renderTile(t,d?8:0,A?56:64,i,r,s,l+8):e.renderTile(t,0,64,i,r,s,l+8),A||a?A&&a&&!c?e.renderTile(t,24,48,i,r,s+8,l+8):e.renderTile(t,a?8:16,A?56:64,i,r,s+8,l+8):e.renderTile(t,16,64,i,r,s+8,l+8)}getOutcome(){return{amount:3,type:"stone"}}}(4),flower:new class extends A{constructor(e){super(e),this.isOnGrass=!0}render(e,t,i,r,s,l){e.renderTile(t,48,0,i,r,s+4,l+4)}}(5),cactus:new class extends A{constructor(e){super(e),this.isOnSand=!0}render(e,t,i,r,s,l){e.renderTile(t,56,0,i,r,s,l),e.renderTile(t,64,0,i,r,s+8,l),e.renderTile(t,56,8,i,r,s,l+8),e.renderTile(t,64,8,i,r,s+8,l+8)}}(6),dirt:new class extends A{render(e,t,i,r,s,l){const n=e.getTile(i,r-1).id===this.id,A=e.getTile(i,r+1).id===this.id,d=e.getTile(i-1,r).id===this.id,a=e.getTile(i+1,r).id===this.id,h=e.getTile(i-1,r-1).id===this.id,o=e.getTile(i+1,r-1).id===this.id,g=e.getTile(i-1,r+1).id===this.id,c=e.getTile(i+1,r+1).id===this.id;n||d?n&&d&&!h?e.renderTile(t,72,32,i,r,s,l):e.renderTile(t,d?48:40,n?32:24,i,r,s,l):e.renderTile(t,40,24,i,r,s,l),n||a?n&&a&&!o?e.renderTile(t,64,32,i,r,s+8,l):e.renderTile(t,a?48:56,n?32:24,i,r,s+8,l):e.renderTile(t,56,24,i,r,s+8,l),A||d?A&&d&&!g?e.renderTile(t,72,24,i,r,s,l+8):e.renderTile(t,d?48:40,A?32:40,i,r,s,l+8):e.renderTile(t,40,40,i,r,s,l+8),A||a?A&&a&&!c?e.renderTile(t,64,24,i,r,s+8,l+8):e.renderTile(t,a?48:56,A?32:40,i,r,s+8,l+8):e.renderTile(t,56,40,i,r,s+8,l+8)}}(7),startingPosition:new d(999)},h=Object.entries(a).map((([e,t])=>t));var o,g;(g=o||(o={}))[g.OWNED=1]="OWNED",g[g.VISIBLE=6]="VISIBLE";let c=!1;window.onload=()=>{c=!0,C(),Y()};let w=!1,f=!1,u=0,T=0,m=0,M=0,v=0,S=0;let D=3;let B=0;const O=(e=>{const t=new Image;return B++,t.onload=()=>{B--,0===B&&Y()},t.src=e,t})(i),P=document.querySelector("#map"),p=P.getContext("2d"),y=new class{constructor(){t(this,"scrollX",0),t(this,"scrollY",0),t(this,"scrollSpeed",3),t(this,"keys",[]),window.onkeydown=e=>{this.keys[e.keyCode]=!0},window.onkeyup=e=>{this.keys[e.keyCode]=!1}}update(e,t,i,r){return this.scrollX=e,this.scrollY=t,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&i&&i(),this.keys[49]&&r&&r(),[this.scrollX,this.scrollY]}},H=new Array(1);for(let U=0;U<H.length;U++)H[U]={name:"Base",imageX:0,imageY:9};const Q=new class{constructor(e,r){t(this,"tiles"),t(this,"tilesState"),t(this,"tileSize",16),t(this,"tileImage"),t(this,"imagesToLoad",0),t(this,"width"),t(this,"height"),this.width=e,this.height=r,this.tiles=new Array(e*r),this.tilesState=new Array(e*r),this.tileImage=this.loadImage(i)}loadImage(e){var t=new Image;return this.imagesToLoad++,t.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},t.src=e,t}init(){const e=((e,t)=>{for(;;){const i=s(e,t),r=new Array(256);for(let s=0;s<e*t;s++)r[255&i[0][s]]++;if(!(r[2]<100||r[1]<100))return i}})(this.width,this.height);this.tiles=e[0],this.tilesState=e[1],this.tilesState.fill(0)}render(e,t,i,r,s){const l=Math.floor(-i/this.tileSize),n=Math.floor(-r/this.tileSize),A=Math.ceil((-i+e.width/s)/this.tileSize),d=Math.ceil((-r+e.height/s)/this.tileSize);for(let o=n;o<d;o++)for(let e=l;e<A;e++){const s=this.getTile(e,o),l=this.getTileState(e,o,1);if(s.isOnGrass){h.find((e=>e.id===a.grass.id)).render(this,t,e,o,i,r)}else if(s.isOnSand){h.find((e=>e.id===a.sand.id)).render(this,t,e,o,i,r)}s.render(this,t,e,o,i,r),1===l&&t.drawImage(this.tileImage,0,72,16,16,e*this.tileSize+i,o*this.tileSize+r,16,16)}for(let a=n;a<d;a++)for(let e=l;e<A;e++){const s=this.getTileState(e,a,6);if(1===s)t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,a*this.tileSize+r+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,a*this.tileSize+r+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,a*this.tileSize+r+8,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,a*this.tileSize+r+8,8,8);else for(let l=0;l<4;l++){const n=l%2*2-1,A=2*(l>>1)-1,d=this.getTileState(e,a+A,6)!==s,h=this.getTileState(e+n,a,6)!==s;let o=25,g=1;3===s&&(g+=3),d&&(g+=A),h&&(o+=n),t.drawImage(this.tileImage,8*o,8*g,8,8,e*this.tileSize+i+l%2*8,a*this.tileSize+r+8*(l>>1),8,8)}}}renderTile(e,t,i,r,s,l,n){e.drawImage(this.tileImage,t,i,8,8,r*this.tileSize+l,s*this.tileSize+n,8,8)}getTile(e,t){if(e<0||t<0||e>=this.width||t>=this.height)return a.water;const i=h.find((i=>this.tiles[e+t*this.width]===i.id));return null!=i?i:a.water}getTileState(e,t,i){return e<0||t<0||e>=this.width||t>=this.height?0:6===i?(this.tilesState[e+t*this.width]&i)>>1:this.tilesState[e+t*this.width]&i}setTileState(e,t,i,r){if(!(e<0||t<0||e>=this.width||t>=this.height))if(6===r){const r=this.tilesState[e+t*this.width];this.tilesState[e+t*this.width]=i<<1|1&r}else this.tilesState[e+t*this.width]^=i,this.tiles[e+t*this.width]=a.dirt.id}setTile(e,t,i){e<0||t<0||e>=this.width||t>=this.height||(this.tiles[e+t*this.width]=i.id)}recalcVisibility(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){let i=this.getTileState(t,e,6);3===i&&(i>>=1),this.setTileState(t,e,i,6)}for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){this.getTileState(t,e,1)&&this.revealTile(t,e,4)}}revealTile(e,t,i){for(let r=t-i;r<=t+i;r++)if(!(r<0||r>=this.height))for(let s=e-i;s<=e+i;s++){if(s<0||s>=this.width)continue;const l=s-e,n=r-t;if(l*l+n*n<=i*i+2){if(0===r||0===s||s===this.width-1||r===this.height-1)continue;this.setTileState(s,r,3,6)}}}}(128,128),Y=()=>{!c||B>0||(P.width=window.innerWidth,P.height=window.innerHeight,P.onmousedown=e=>{e.preventDefault(),w=!0,f=!1,u=e.clientX,T=e.clientY},P.onclick=e=>{if(w=!1,!f){const t=Math.floor(m+16*-v+window.innerWidth/D/2),i=Math.floor(M+16*-S+window.innerHeight/D/2),r=Math.floor((e.clientX/D-t)/16),s=Math.floor((e.clientY/D-i)/16);z(r,s,e.clientX/D,e.clientY/D)}},window.onmousemove=e=>{if(!w)return;e.preventDefault();const t=e.clientX-u,i=e.clientY-T;(f||t*t+i*i>64)&&(f=!0,m+=t/D,M+=i/D,u=e.clientX,T=e.clientY,requestAnimationFrame(E))},E())},C=()=>{for(let e=0;e<128;e++)for(let t=0;t<128;t++){const i=t+128*e;Q.tiles[i]===a.startingPosition.id&&(v=t,S=e,Q.setTileState(v,S,1,o.OWNED),Q.recalcVisibility())}k()};window.onresize=Y;let I=null,b=null,X=!1;const z=(e,t,i=800,r=600)=>{const s=Math.floor(p.canvas.width/D),l=Math.floor(p.canvas.height/D);if(i>=0&&i<=s&&r>=l-35&&r<=l&&I&&b){return void(Q.getTile(I,b).isPassable&&j(i,r))}if(e<0||t<0||e>128||t>128)return I=null,void(b=null);const n=Q.getTileState(e,t,o.VISIBLE);if(0===n)return I=null,b=null,void requestAnimationFrame(E);I===e&&b===t||(I=e,b=t,X=3===n),requestAnimationFrame(E)},k=()=>{requestAnimationFrame(k);const e=y.update(m,M,(()=>{}),(()=>{I&&b&&(Q.setTileState(I,b,1,o.OWNED),Q.recalcVisibility(),requestAnimationFrame(E),I=null,b=null)}));m===e[0]&&M===e[1]||(m=e[0],M=e[1],requestAnimationFrame(E))},E=()=>{D=Math.max(Math.floor(P.height/300+1),Math.floor(P.width/(16/9*300)+1)),m>16*v&&(m=16*v),M>16*S&&(M=16*S),m<16*v-2016&&(m=16*v-2016),M<16*S-2016&&(M=16*S-2016),p.imageSmoothingEnabled=!1,p.setTransform(D,0,0,D,0,0);const e=Math.floor(m+16*-v+window.innerWidth/D/2),t=Math.floor(M+16*-S+window.innerHeight/D/2);Q.render(P,p,e,t,D);for(var i=0;i<H.length;i++){const e=Math.floor(p.canvas.width/D),t=Math.floor(p.canvas.height/D);p.fillStyle="rgba(255, 255, 255, 0.3)",p.fillRect(0,t-35,e,t),x(H[i].name,e/2+2,t-25-5,3),G(H[i].imageX,H[i].imageY,e/2,t-25)}if(I&&b&&(p.strokeStyle="white",p.strokeRect(16*I+e,16*b+t,16,16),X)){const i=Q.getTile(I,b).getOutcome();i&&(p.fillStyle="rgba(0, 0, 0, 0.3)",p.fillRect(16*I+e+16,16*b+t,18,16),p.drawImage(O,8*n[i.type].imageX,8*n[i.type].imageY,8,8,16*I+e+18,16*b+t+4,8,8),x(`${i.amount}`,16*I+e+27,16*b+t+5,5))}q()},F=[{imageX:0,imageY:11},{imageX:1,imageY:11}],q=()=>{for(let e=0;e<F.length;e++)p.drawImage(O,8*F[e].imageX,8*F[e].imageY,8,8,4,4+14*e,8,8),x("0",14,5+14*e,6)},L="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",x=(e,t,i,r=8)=>{e=e.toUpperCase();for(var s=0;s<e.length;s++){var l=L.indexOf(e.charAt(s)),n=0+l%32,A=29+(l>>5);p.drawImage(O,8*n,8*A,8,8,t+s*r,i,r,r)}},j=(e,t)=>{const i=Math.floor(p.canvas.width/D)/2,r=Math.floor(p.canvas.height/D)-25;e>=i&&e<=i+16&&t>=r&&t<=r+16&&I&&b&&(Q.setTileState(I,b,1,o.OWNED),Q.recalcVisibility(),requestAnimationFrame(E),I=null,b=null)},G=(e,t,i,r)=>{p.beginPath(),p.strokeStyle="yellow",p.rect(i,r,16,16),p.stroke(),p.drawImage(O,8*e,8*t,16,16,i,r,16,16)};

!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&o(e)})).observe(document,{childList:!0,subtree:!0})}function o(e){if(e.ep)return;e.ep=!0;const o=function(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?o.credentials="include":"anonymous"===e.crossorigin?o.credentials="omit":o.credentials="same-origin",o}(e);fetch(e.href,o)}}();let e=!1;window.onload=()=>{e=!0,g()},window.onresize=g;let o=!1,t=!1,n=0,r=0,i=0,a=0;var l,c,d=3,f=(l="../assets/spritesheet.png",c=new Image,s++,c.onload=function(){0==--s&&g()},c.src=l,c),s=0,m=new Array(6);for(let q=0;q<m.length;q++)m[q]={name:"Base",imageX:0,imageY:6};var u=new Array(1024);for(let q=0;q<32;q++)for(let e=0;e<32;e++)u[e+32*q]={color:16711935,visible:!1,owned:!1,land:2-Math.floor(Math.random()*Math.random()*3)};const h=[];function g(){if(!e||s>0)return;const l=document.querySelector("#map");l.width=window.innerWidth,l.height=window.innerHeight,window.onkeydown=function(e){h[e.keyCode]=!0},window.onkeyup=function(e){h[e.keyCode]=!1},l.onmousedown=function(e){e.preventDefault(),o=!0,t=!1,n=e.clientX,r=e.clientY},l.onclick=function(e){if(o=!1,!t){const o=document.querySelector("#map");var n=Math.floor(i+(o.width/d-512)/2),r=Math.floor(a+(o.height/d-512)/2);!function(e,o){if(e>0&&o>0&&e<32&&o<32){var t=b(e,o);t.owned=!t.owned,function(){for(var e=0;e<32;e++)for(var o=0;o<32;o++)u[o+32*e].visible&=1;for(e=0;e<32;e++)for(o=0;o<32;o++)u[o+32*e].owned&&p(o,e,4)}()}w=e,v=o,console.log(w,v),M()}(Math.floor((e.clientX/d-n)/16),Math.floor((e.clientY/d-r)/16))}},window.onmousemove=function(e){if(o){e.preventDefault();var l=e.clientX-n,c=e.clientY-r;(t||l*l+c*c>64)&&(t=!0,i+=l/d,a+=c/d,n=e.clientX,r=e.clientY,M())}},y(),M()}let w=0,v=0;function p(e,o,t){for(var n=o-t;n<=o+t;n++)if(!(n<0||n>=32))for(var r=e-t;r<=e+t;r++)if(!(r<0||r>=32)){var i=r-e,a=n-o;if(i*i+a*a<=t*t+2){if(0===n||0===r||31===r||31===n)continue;u[r+32*n].visible=3}}}function y(){requestAnimationFrame(y)}function M(){const e=document.querySelector("#map");d=Math.max(Math.floor(e.height/300+1),Math.floor(e.width/(16/9*300)+1));var o=Math.max(0,576-e.width/d)/2,t=Math.max(0,576-e.height/d)/2;i<-o&&(i=-o),a<-t&&(a=-t),i>o&&(i=o),a>t&&(a=t);const n=e.getContext("2d");n.imageSmoothingEnabled=!1,n.setTransform(d,0,0,d,0,0);for(var r=Math.floor(i+(e.width/d-512)/2),l=Math.floor(a+(e.height/d-512)/2),c=Math.floor(-r/16),s=Math.floor(-l/16),u=Math.ceil((-r+e.width/d)/16),h=Math.ceil((-l+e.height/d)/16),g=s;g<h;g++)for(var w=c;w<u;w++){if(0==(C=b(w,g)).land)n.drawImage(f,40,0,8,8,16*w+r+0,16*g+l+0,8,8),n.drawImage(f,40,0,8,8,16*w+r+8,16*g+l+0,8,8),n.drawImage(f,40,0,8,8,16*w+r+0,16*g+l+8,8,8),n.drawImage(f,40,0,8,8,16*w+r+8,16*g+l+8,8,8);else for(var v=0;v<4;v++){var p=v%2*2-1,y=b(w,g+(X=2*(v>>1)-1)).land!==C.land,M=b(w+p,g).land!==C.land,I=b(w+p,g+X).land!==C.land,q=1,x=1+3*(C.land-1);y&&(x+=X),M&&(q+=p),y||M||!I||(q+=3-v%2,x-=v>>1),n.drawImage(f,8*q,8*x,8,8,16*w+r+v%2*8,16*g+l+8*(v>>1),8,8)}C.owned&&n.drawImage(f,0,48,16,16,16*w+r,16*g+l,16,16)}for(g=s;g<h;g++)for(w=c;w<u;w++){var C;if(1==(C=b(w,g)).visible)n.drawImage(f,240,16,8,8,16*w+r+0,16*g+l+0,8,8),n.drawImage(f,240,16,8,8,16*w+r+8,16*g+l+0,8,8),n.drawImage(f,240,16,8,8,16*w+r+0,16*g+l+8,8,8),n.drawImage(f,240,16,8,8,16*w+r+8,16*g+l+8,8,8);else for(v=0;v<4;v++){var X;p=v%2*2-1,y=b(w,g+(X=2*(v>>1)-1)).visible!==C.visible,M=b(w+p,g).visible!==C.visible,I=b(w+p,g+X).visible!==C.visible,q=28,x=1;3==C.visible&&(x+=3),y&&(x+=X),M&&(q+=p),y||M||!I||(q+=3-v%2,x-=v>>1),n.drawImage(f,8*q,8*x,8,8,16*w+r+v%2*8,16*g+l+8*(v>>1),8,8)}}S("GOLD: 500",4,4),S("FOOD: 0/100",4,14),function(){const e=document.querySelector("#map").getContext("2d");e.beginPath(),e.fillStyle="rgba(255, 255, 255, 0.3)",e.fillRect(0,30,24,24*m.length+6),e.stroke()}();for(v=0;v<m.length;v++)S(m[v].name,6,34+24*v,3),k(m[v].imageX,m[v].imageY,4,38+24*v)}function b(e,o){return e<0||o<0||e>=32||o>=32?u[0]:u[e+32*o]}var I="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ";function S(e,o,t,n=8){e=e.toUpperCase();const r=document.querySelector("#map").getContext("2d");for(var i=0;i<e.length;i++){var a=I.indexOf(e.charAt(i)),l=0+a%32,c=29+(a>>5);r.drawImage(f,8*l,8*c,8,8,o+i*n,t,n,n)}}function k(e,o,t,n){const r=document.querySelector("#map").getContext("2d");r.beginPath(),r.strokeStyle="yellow",r.rect(t,n,16,16),r.stroke(),r.drawImage(f,8*e,8*o,16,16,t,n,16,16)}

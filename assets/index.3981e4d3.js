var t=Object.defineProperty,i=("undefined"!=typeof require&&require,(i,e,s)=>(((i,e,s)=>{e in i?t(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s})(i,"symbol"!=typeof e?e+"":e,s),s));!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver((t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)})).observe(document,{childList:!0,subtree:!0})}function i(t){if(t.ep)return;t.ep=!0;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?i.credentials="include":"anonymous"===t.crossorigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();var e="data:image/png;base64,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";class s{constructor(t,e){i(this,"x"),i(this,"y"),i(this,"xa",0),i(this,"ya",0),i(this,"dirX",0),i(this,"isDead",!1),i(this,"isPlayingDeadAnimation",!1),this.x=t,this.y=e}update(t){}move(t){if(0!==this.xa||0!==this.ya){let i=!0;return 0!==this.xa&&this.move2(t,this.xa,0)&&(i=!1),0!==this.ya&&this.move2(t,0,this.ya)&&(i=!1),0===this.xa||0===this.ya||this.move3(t,this.xa,this.ya)||(this.xa=0,this.ya=0),!i}return!0}move3(t,i,e){const s=this.x+i,h=this.y+e;return!!t.getTile(1===i?Math.floor(s):Math.round(s),1===e?Math.floor(h):Math.round(h)).isPassable}move2(t,i,e){const s=this.x-0,h=this.y-0,a=this.x+0,r=this.y+0,n=this.x+i-0,o=this.y+e-0,A=this.x+i+0,d=this.y+e+0;let l=!1;for(let g=o;g<=d;g++)for(let i=n;i<=A;i++)if(!(i>=s&&i<=a&&g>=h&&g<=r||t.getTile(Math.round(i),Math.round(g)).isPassable))return l=!0,!1;return!l&&(this.x+=i/16,this.y+=e/16,!0)}}class h extends s{constructor(){super(...arguments),i(this,"tx",0),i(this,"maxTx",4),i(this,"ty",12),i(this,"movingTx",4),i(this,"maxMovingTx",10),i(this,"moving",!0),i(this,"animation",0),i(this,"movingAnimation",0),i(this,"deadAnimationTx",8),i(this,"maxDeadAnimationTx",14),i(this,"deadAnimation",0)}render(t,i,e,s){this.isPlayingDeadAnimation||this.isDead?t.renderEntity(i,8*this.deadAnimationTx,1===this.dirX?8*(this.ty+2):8*this.ty,this.x,this.y,e,s):t.renderEntity(i,this.moving?8*this.movingTx:8*this.tx,-1===this.xa||1===this.dirX?8*(this.ty+2):8*this.ty,this.x,this.y,e,s)}update(t){0===Math.round(100*Math.random())&&(this.isPlayingDeadAnimation=!0),this.isPlayingDeadAnimation?this.playDeadAnimation():(1===this.xa||1===this.ya?(this.moving=!0,this.dirX=0):-1===this.xa||-1===this.ya?(this.moving=!0,this.dirX=1):this.moving=!1,this.move(t)?0===Math.floor(20*Math.random())&&(this.xa=Math.floor(3*Math.random())-1,this.ya=Math.floor(3*Math.random())-1):(this.xa=0,this.ya=0),this.animation+=1,this.movingAnimation+=1,this.animation%5!=0||this.moving||(this.animation=0,this.tx+=2,this.tx%this.maxTx==0&&(this.tx=0)),this.movingAnimation%2==0&&this.moving&&(this.movingAnimation=0,this.movingTx+=2,this.movingTx%this.maxMovingTx==0&&(this.movingTx=4)))}playDeadAnimation(){this.isDead||(this.deadAnimation+=1,this.deadAnimation%2==0&&(this.deadAnimation=0,this.deadAnimationTx+=2,this.deadAnimationTx===this.maxDeadAnimationTx&&(this.isDead=!0)))}}class a extends s{constructor(){super(...arguments),i(this,"tx",0),i(this,"maxTx",4),i(this,"ty",16),i(this,"movingTx",4),i(this,"maxMovingTx",10),i(this,"moving",!0),i(this,"animation",0),i(this,"movingAnimation",0),i(this,"deadAnimationTx",8),i(this,"maxDeadAnimationTx",14),i(this,"deadAnimation",0)}render(t,i,e,s){this.isPlayingDeadAnimation||this.isDead?t.renderEntity(i,8*this.deadAnimationTx,1===this.dirX?8*(this.ty+2):8*this.ty,this.x,this.y,e,s):t.renderEntity(i,this.moving?8*this.movingTx:8*this.tx,-1===this.xa||1===this.dirX?8*(this.ty+2):8*this.ty,this.x,this.y,e,s)}update(t){0===Math.round(100*Math.random())&&(this.isPlayingDeadAnimation=!0),this.isPlayingDeadAnimation?this.playDeadAnimation():(1===this.xa||1===this.ya?(this.moving=!0,this.dirX=0):-1===this.xa||-1===this.ya?(this.moving=!0,this.dirX=1):this.moving=!1,this.move(t)?0===Math.floor(20*Math.random())&&(this.xa=Math.floor(3*Math.random())-1,this.ya=Math.floor(3*Math.random())-1):(this.xa=0,this.ya=0),this.animation+=1,this.movingAnimation+=1,this.animation%7!=0||this.moving||(this.animation=0,this.tx+=2,this.tx%this.maxTx==0&&(this.tx=0)),this.movingAnimation%2==0&&this.moving&&(this.movingAnimation=0,this.movingTx+=2,this.movingTx%this.maxMovingTx==0&&(this.movingTx=4)))}playDeadAnimation(){this.isDead||(this.deadAnimation+=1,this.deadAnimation%2==0&&(this.deadAnimation=0,this.deadAnimationTx+=2,this.deadAnimationTx===this.maxDeadAnimationTx&&(this.isDead=!0)))}}Math.seed=t=>{const i=4294967295;let e=123456789+t&i,s=987654321-t&i;return()=>{s=36969*(65535&s)+(s>>>16)&i,e=18e3*(65535&e)+(e>>>16)&i;let t=(s<<16)+(65535&e)>>>0;return t/=4294967296,t}};let r=Math.seed(Math.random()*(10+90*Math.random()));class n{constructor(t,e,s){i(this,"w"),i(this,"h"),i(this,"values"),this.w=t,this.h=e,this.values=new Array(t*e);for(let i=0;i<e;i+=s)for(let e=0;e<t;e+=s)this.setSample(e,i,2*r()-1);let h=s,a=1/t,n=1;do{const i=h/2;for(let s=0;s<e;s+=h)for(let e=0;e<t;e+=h){const t=(this.sample(e,s)+this.sample(e+h,s)+this.sample(e,s+h)+this.sample(e+h,s+h))/4+(2*r()-1)*h*a;this.setSample(e+i,s+i,t)}for(let e=0;e<t;e+=h)for(let s=0;s<t;s+=h){const t=this.sample(s,e),n=this.sample(s+h,e),o=this.sample(s,e+h),A=this.sample(s+i,e+i),d=this.sample(s+i,e-i),l=this.sample(s-i,e+i),g=(t+n+A+d)/4+(2*r()-1)*h*a*.5,m=(t+o+A+l)/4+(2*r()-1)*h*a*.5;this.setSample(s+i,e,g),this.setSample(s,e+i,m)}h/=2,a*=n+.8,n*=.3}while(h>1)}sample(t,i){return this.values[(t&this.w-1)+(i&this.h-1)*this.w]}setSample(t,i,e){this.values[(t&this.w-1)+(i&this.h-1)*this.w]=e}}const o=(t,i,e=Math.random()*Number.MAX_SAFE_INTEGER)=>{r=Math.seed(e);const s=new n(t,i,16),h=new n(t,i,16),a=new n(t,i,16),o=new n(t,i,32),d=new n(t,i,32),l=new Array(t*i),g=new Array(t*i);for(let r=0;r<i;r++)for(let e=0;e<t;e++){const n=e+r*t;let A=3*Math.abs(o.values[n]-d.values[n])-2,g=Math.abs(s.values[n]-h.values[n]);g=3*Math.abs(g-a.values[n])-2;let c=e/(t-1)*2-1,f=r/(i-1)*2-1;c<0&&(c=-c),f<0&&(f=-f);let w=c>=f?c:f;w*=w*w*w,w*=w*w*w,A=A+1-20*w,l[n]=A<-.5?m.water.id:A>.5&&g<-1.5?m.rock.id:m.grass.id}for(let n=0;n<t*i/2800;n++){let e=Math.round(r()*t),s=Math.round(r()*i);for(let h=0;h<10;h++){let h=e+Math.round(21*r()-10),a=s+Math.round(21*r()-10);for(let e=0;e<100;e++){let e=h+Math.round(5*r())-Math.round(5*r()),s=a+Math.round(5*r())-Math.round(5*r());for(let h=s-1;h<=s+1;h++)for(let s=e-1;s<=e+1;s++)s>=0&&h>=0&&s<t&&h<i&&1==l[s+h*t]&&(l[s+h*t]=m.sand.id)}}}for(let n=0;n<t*i/400;n++){const e=Math.round(r()*t),s=Math.round(r()*i);for(let h=0;h<200;h++){const h=e+Math.round(15*r())-Math.round(15*r()),a=s+Math.round(15*r())-Math.round(15*r());h>=0&&a>=0&&h<t&&a<i&&l[h+a*t]==m.grass.id&&(l[h+a*t]=m.tree.id)}}for(let n=0;n<t*i/40;n++){const e=Math.round(r()*t),s=Math.round(r()*i);e>=0&&s>=0&&e<t&&s<<i&&l[e+s*t]===m.sand.id&&(l[e+s*t]=m.cactus.id)}for(let n=0;n<t*i/400;n++){const e=Math.round(r()*t),s=Math.round(r()*i);for(let h=0;h<30;h++){const h=e+Math.round(5*r())-Math.round(5*r()),a=s+Math.round(5*r())-Math.round(5*r());h>=0&&a>=0&&h<t&&a<i&&l[h+a*t]==m.grass.id&&(l[h+a*t]=m.flower.id)}}let c=-1,f=-1;for(;-1===c||-1===f;){c=Math.round(r()*t),f=Math.round(r()*i);t:for(let i=f-1;i<=f+1;i++)for(let e=c-1;e<=c+1;e++)if(l[e+i*t]===m.water.id||l[e+i*t]===m.rock.id||l[e+i*t]===m.tree.id){c=-1,f=-1;break t}const e=A(l,t,c,f,3,3,m.tree.id),s=A(l,t,c,f,5,1,m.rock.id);e&&s||(c=-1,f=-1)}return l[c+f*t]=m.startingPosition.id,[l,g]},A=(t,i,e,s,h,a,r)=>{let n=0;for(let o=s-h;o<=s+h;o++)for(let s=e-h;s<=e+h;s++)t[s+o*i]===r&&n++;return n>=a},d={wood:{imageX:0,imageY:11},stone:{imageX:1,imageY:11}};class l{constructor(t){i(this,"id"),i(this,"isFarmable",!1),i(this,"isPassable",!0),i(this,"isOnGrass",!1),i(this,"isOnSand",!1),i(this,"color",0),this.id=t}update(t,i,e){}getOutcome(){}}class g extends l{constructor(t){super(t),this.color=1096065}render(t,i,e,s,h,a){const r=t.getTile(e,s-1).id===this.id||t.getTile(e,s-1).id===m.tree.id||t.getTile(e,s-1).id===m.flower.id,n=t.getTile(e,s+1).id===this.id||t.getTile(e,s+1).id===m.tree.id||t.getTile(e,s+1).id===m.flower.id,o=t.getTile(e-1,s).id===this.id||t.getTile(e-1,s).id===m.tree.id||t.getTile(e-1,s).id===m.flower.id,A=t.getTile(e+1,s).id===this.id||t.getTile(e+1,s).id===m.tree.id||t.getTile(e+1,s).id===m.flower.id,d=t.getTile(e-1,s-1).id===this.id||t.getTile(e-1,s-1).id===m.tree.id||t.getTile(e-1,s-1).id===m.flower.id,l=t.getTile(e+1,s-1).id===this.id||t.getTile(e+1,s-1).id===m.tree.id||t.getTile(e+1,s-1).id===m.flower.id,g=t.getTile(e-1,s+1).id===this.id||t.getTile(e-1,s+1).id===m.tree.id||t.getTile(e-1,s+1).id===m.flower.id,c=t.getTile(e+1,s+1).id===this.id||t.getTile(e+1,s+1).id===m.tree.id||t.getTile(e+1,s+1).id===m.flower.id;r||o?r&&o&&!d?t.renderTile(i,32,32,e,s,h,a):t.renderTile(i,o?8:0,r?32:24,e,s,h,a):t.renderTile(i,0,24,e,s,h,a),r||A?r&&A&&!l?t.renderTile(i,24,32,e,s,h+8,a):t.renderTile(i,A?8:16,r?32:24,e,s,h+8,a):t.renderTile(i,16,24,e,s,h+8,a),n||o?n&&o&&!g?t.renderTile(i,32,24,e,s,h,a+8):t.renderTile(i,o?8:0,n?32:40,e,s,h,a+8):t.renderTile(i,0,40,e,s,h,a+8),n||A?n&&A&&!c?t.renderTile(i,24,24,e,s,h+8,a+8):t.renderTile(i,A?8:16,n?32:40,e,s,h+8,a+8):t.renderTile(i,16,40,e,s,h+8,a+8)}}const m={water:new class extends l{constructor(t){super(t),i(this,"position1",0),i(this,"position2",0),i(this,"position3",0),i(this,"position4",0),i(this,"shouldAnimate",!0),this.isPassable=!1,this.color=3900150}render(t,i,e,s,h,a){this.shouldAnimate&&(this.position1=Math.round(3+3*Math.random()),this.position2=Math.round(3+3*Math.random()),this.position3=Math.round(3+3*Math.random()),this.position4=Math.round(3+3*Math.random()),this.shouldAnimate=!1);const r=t.getTile(e,s-1).id===this.id,n=t.getTile(e,s+1).id===this.id,o=t.getTile(e-1,s).id===this.id,A=t.getTile(e+1,s).id===this.id,d=t.getTile(e-1,s-1).id===this.id,l=t.getTile(e+1,s-1).id===this.id;r||o?r&&o&&!d?t.renderTile(i,32,8,e,s,h,a):r&&o?t.renderTile(i,8*this.position1,16,e,s,h,a):t.renderTile(i,o?8:0,r?8:0,e,s,h,a):t.renderTile(i,0,0,e,s,h,a),r||A?r&&A&&!l?t.renderTile(i,24,8,e,s,h+8,a):r&&A?t.renderTile(i,8*this.position2,16,e,s,h+8,a):t.renderTile(i,A?8:16,r?8:0,e,s,h+8,a):t.renderTile(i,16,0,e,s,h+8,a),n||o?n&&o?t.renderTile(i,8*this.position3,16,e,s,h,a+8):t.renderTile(i,o?8:0,n?8:16,e,s,h,a+8):t.renderTile(i,0,16,e,s,h,a+8),n||A?n&&A?t.renderTile(i,8*this.position4,16,e,s,h+8,a+8):t.renderTile(i,A?8:16,n?8:16,e,s,h+8,a+8):t.renderTile(i,16,16,e,s,h+8,a+8),r&&!o&&d&&t.renderTile(i,32,0,e,s,h,a-8),r&&!A&&l&&t.renderTile(i,24,0,e,s,h+8,a-8)}update(t,i,e){t.tickCount%10==0&&(this.shouldAnimate=!0)}}(0),grass:new g(1),sand:new class extends l{constructor(t){super(t),this.color=16498468}render(t,i,e,s,h,a){t.renderTile(i,40,0,e,s,h,a),t.renderTile(i,40,0,e,s,h+8,a),t.renderTile(i,40,0,e,s,h,a+8),t.renderTile(i,40,0,e,s,h+8,a+8)}}(2),tree:new class extends l{constructor(t){super(t),this.isFarmable=!0,this.isPassable=!1,this.isOnGrass=!0,this.color=417606}render(t,i,e,s,h,a){t.onTopTiles.find((t=>t.x===e&&t.y===s))||(t.onTopTiles.push({sx:16,sy:72,x:e,y:s,xExtraOffset:0,yExtraOffset:0}),t.onTopTiles.push({sx:24,sy:72,x:e,y:s,xExtraOffset:8,yExtraOffset:0})),t.renderTile(i,16,80,e,s,h,a+8),t.renderTile(i,24,80,e,s,h+8,a+8)}getOutcome(){return{amount:3,type:"wood"}}}(3),rock:new class extends l{constructor(t){super(t),this.isFarmable=!0,this.isPassable=!1,this.color=10265519}render(t,i,e,s,h,a){const r=t.getTile(e,s-1).id===this.id,n=t.getTile(e,s+1).id===this.id,o=t.getTile(e-1,s).id===this.id,A=t.getTile(e+1,s).id===this.id,d=t.getTile(e-1,s-1).id===this.id,l=t.getTile(e+1,s-1).id===this.id,g=t.getTile(e-1,s+1).id===this.id,m=t.getTile(e+1,s+1).id===this.id;r||o?r&&o&&!d?t.renderTile(i,32,56,e,s,h,a):t.renderTile(i,o?8:0,r?56:48,e,s,h,a):t.renderTile(i,0,48,e,s,h,a),r||A?r&&A&&!l?t.renderTile(i,24,56,e,s,h+8,a):t.renderTile(i,A?8:16,r?56:48,e,s,h+8,a):t.renderTile(i,16,48,e,s,h+8,a),n||o?n&&o&&!g?t.renderTile(i,32,48,e,s,h,a+8):t.renderTile(i,o?8:0,n?56:64,e,s,h,a+8):t.renderTile(i,0,64,e,s,h,a+8),n||A?n&&A&&!m?t.renderTile(i,24,48,e,s,h+8,a+8):t.renderTile(i,A?8:16,n?56:64,e,s,h+8,a+8):t.renderTile(i,16,64,e,s,h+8,a+8)}getOutcome(){return{amount:3,type:"stone"}}}(4),flower:new class extends l{constructor(t){super(t),this.isOnGrass=!0,this.color=1096065}render(t,i,e,s,h,a){t.renderTile(i,48,0,e,s,h+4,a+4)}}(5),cactus:new class extends l{constructor(t){super(t),this.isOnSand=!0,this.color=16498468}render(t,i,e,s,h,a){t.renderTile(i,56,0,e,s,h,a),t.renderTile(i,64,0,e,s,h+8,a),t.renderTile(i,56,8,e,s,h,a+8),t.renderTile(i,64,8,e,s,h+8,a+8)}}(6),dirt:new class extends l{constructor(t){super(t),this.color=7877903}render(t,i,e,s,h,a){const r=t.getTile(e,s-1).id===this.id,n=t.getTile(e,s+1).id===this.id,o=t.getTile(e-1,s).id===this.id,A=t.getTile(e+1,s).id===this.id,d=t.getTile(e-1,s-1).id===this.id,l=t.getTile(e+1,s-1).id===this.id,g=t.getTile(e-1,s+1).id===this.id,m=t.getTile(e+1,s+1).id===this.id;r||o?r&&o&&!d?t.renderTile(i,72,32,e,s,h,a):t.renderTile(i,o?48:40,r?32:24,e,s,h,a):t.renderTile(i,40,24,e,s,h,a),r||A?r&&A&&!l?t.renderTile(i,64,32,e,s,h+8,a):t.renderTile(i,A?48:56,r?32:24,e,s,h+8,a):t.renderTile(i,56,24,e,s,h+8,a),n||o?n&&o&&!g?t.renderTile(i,72,24,e,s,h,a+8):t.renderTile(i,o?48:40,n?32:40,e,s,h,a+8):t.renderTile(i,40,40,e,s,h,a+8),n||A?n&&A&&!m?t.renderTile(i,64,24,e,s,h+8,a+8):t.renderTile(i,A?48:56,n?32:40,e,s,h+8,a+8):t.renderTile(i,56,40,e,s,h+8,a+8)}}(7),startingPosition:new g(999)},c=Object.entries(m).map((([t,i])=>i));var f,w;(w=f||(f={}))[w.OWNED=1]="OWNED",w[w.VISIBLE=6]="VISIBLE";class u{constructor(t,e,s){i(this,"map2d"),i(this,"imageData"),i(this,"minimapCanvas",document.createElement("canvas")),i(this,"width"),i(this,"height"),this.map2d=t,this.width=e,this.height=s,this.imageData=t.createImageData(e,s),this.minimapCanvas.width=this.imageData.width,this.minimapCanvas.height=this.imageData.height}getRGB(t){return[t>>16&255,t>>8&255,255&t]}render(t,i,e,s){const h=Math.floor(this.map2d.canvas.width/s)-t.width/(e+s+10)-8,a=Math.round(t.width/(e+s+10));for(let r=0;r<this.height;r++)for(let t=0;t<this.width;t++){const e=t+r*this.width,s=i.getTile(t,r),[h,a,n]=this.getRGB(s.color);i.getTileState(t,r,f.OWNED)?(this.imageData.data[4*e]=255,this.imageData.data[4*e+1]=0,this.imageData.data[4*e+2]=0,this.imageData.data[4*e+3]=255):i.getTileState(t,r,f.VISIBLE)>=1?(this.imageData.data[4*e]=h,this.imageData.data[4*e+1]=a,this.imageData.data[4*e+2]=n,this.imageData.data[4*e+3]=255):(this.imageData.data[4*e]=0,this.imageData.data[4*e+1]=0,this.imageData.data[4*e+2]=0,this.imageData.data[4*e+3]=255)}this.minimapCanvas.getContext("2d").putImageData(this.imageData,0,0),this.map2d.drawImage(this.minimapCanvas,h,8,a,a),this.map2d.strokeStyle="rgba(255, 255, 255, 0.35)",this.map2d.strokeRect(h,8,a,a)}}let T=!1,v=!1;window.onload=()=>{T=!0,L()};let M=!1,x=!1,y=0,p=0,D=0,B=0,S=0,E=0;let Q=3;let C=0;const I=(t=>{const i=new Image;return C++,i.onload=()=>{C--,0===C&&L()},i.src=t,i})(e),Y=document.querySelector("#map"),b=Y.getContext("2d"),O=new class{constructor(){i(this,"scrollX",0),i(this,"scrollY",0),i(this,"scrollSpeed",3),i(this,"keys",[]),window.onkeydown=t=>{this.keys[t.keyCode]=!0},window.onkeyup=t=>{this.keys[t.keyCode]=!1}}update(t,i,e,s){return this.scrollX=t,this.scrollY=i,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&e&&e(),this.keys[49]&&s&&s(),[this.scrollX,this.scrollY]}};let z;const H=new Array(1);for(let tt=0;tt<H.length;tt++)H[tt]={name:"Base",imageX:0,imageY:9};const P=new class{constructor(t,s,h){i(this,"tiles"),i(this,"data"),i(this,"tilesState"),i(this,"tileSize",16),i(this,"tickCount",0),i(this,"tileImage"),i(this,"imagesToLoad",0),i(this,"width"),i(this,"height"),i(this,"seed"),i(this,"entities",[]),i(this,"onTopTiles",[]),this.width=t,this.height=s,this.seed=h,this.tiles=new Array(t*s),this.data=new Array(t*s),this.tilesState=new Array(t*s),this.tileImage=this.loadImage(e)}loadImage(t){var i=new Image;return this.imagesToLoad++,i.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},i.src=t,i}init(){const t=((t,i,e=Math.random()*Number.MAX_SAFE_INTEGER)=>{for(;;){const s=o(t,i,e),h=new Array(256);for(let e=0;e<t*i;e++)h[255&s[0][e]]++;if(!(h[255&m.rock.id]<100||h[255&m.sand.id]<100||h[255&m.grass.id]<100||h[255&m.tree.id]<100))return s}})(this.width,this.height,this.seed);this.tiles=t[0],this.tilesState=[...t[1]],this.data=[...t[1]],this.tilesState.fill(0);for(let i=0;i<this.height;i++)for(let t=0;t<this.width;t++){if(this.tiles[t+i*this.width]===m.startingPosition.id)for(let e=0;e<5;e++)this.entities.push(0===Math.round(1*Math.random())?new h(t,i):new a(t,i))}}update(){this.tickCount++,this.tickCount>=Number.MAX_VALUE&&(this.tickCount=0);for(let t=0;t<this.width*this.height/50;t++){const t=Math.round(Math.random()*this.width),i=Math.round(Math.random()*this.height);this.getTile(t,i).update(this,t,i)}this.entities.filter((t=>!t.isDead)).forEach((t=>t.update(this)))}render(t,i,e,s,h){const a=Math.floor(-e/this.tileSize),r=Math.floor(-s/this.tileSize),n=Math.ceil((-e+t.width/h)/this.tileSize),o=Math.ceil((-s+t.height/h)/this.tileSize);for(let A=r;A<o;A++)for(let t=a;t<n;t++){const h=this.getTile(t,A),a=this.getTileState(t,A,1);if(h.isOnGrass){c.find((t=>t.id===m.grass.id)).render(this,i,t,A,e,s)}else if(h.isOnSand){c.find((t=>t.id===m.sand.id)).render(this,i,t,A,e,s)}h.render(this,i,t,A,e,s),1===a&&i.drawImage(this.tileImage,0,72,16,16,t*this.tileSize+e,A*this.tileSize+s,16,16)}this.entities.forEach((t=>t.render(this,i,e,s))),this.onTopTiles.forEach((t=>{this.renderTile(i,t.sx,t.sy,t.x,t.y,t.xExtraOffset+e,t.yExtraOffset+s)}));for(let A=r;A<o;A++)for(let t=a;t<n;t++){const h=this.getTileState(t,A,6);if(1===h)i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+0,A*this.tileSize+s+0,8,8),i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+8,A*this.tileSize+s+0,8,8),i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+0,A*this.tileSize+s+8,8,8),i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+8,A*this.tileSize+s+8,8,8);else for(let a=0;a<4;a++){const r=a%2*2-1,n=2*(a>>1)-1,o=this.getTileState(t,A+n,6)!==h,d=this.getTileState(t+r,A,6)!==h;let l=25,g=1;3===h&&(g+=3),o&&(g+=n),d&&(l+=r),i.drawImage(this.tileImage,8*l,8*g,8,8,t*this.tileSize+e+a%2*8,A*this.tileSize+s+8*(a>>1),8,8)}}}renderEntity(t,i,e,s,h,a,r){t.drawImage(this.tileImage,i,e,this.tileSize,this.tileSize,s*this.tileSize+a,h*this.tileSize+r,this.tileSize,this.tileSize)}renderTile(t,i,e,s,h,a,r){t.drawImage(this.tileImage,i,e,8,8,s*this.tileSize+a,h*this.tileSize+r,8,8)}getTile(t,i){if(t<0||i<0||t>=this.width||i>=this.height)return m.water;const e=c.find((e=>this.tiles[t+i*this.width]===e.id));return null!=e?e:m.water}getTileState(t,i,e){return t<0||i<0||t>=this.width||i>=this.height?0:6===e?(this.tilesState[t+i*this.width]&e)>>1:this.tilesState[t+i*this.width]&e}setTileState(t,i,e,s){if(!(t<0||i<0||t>=this.width||i>=this.height))if(6===s){const s=this.tilesState[t+i*this.width];this.tilesState[t+i*this.width]=e<<1|1&s}else this.tilesState[t+i*this.width]^=e,this.tiles[t+i*this.width]=m.dirt.id}setTile(t,i,e){t<0||i<0||t>=this.width||i>=this.height||(this.tiles[t+i*this.width]=e.id)}setData(t,i,e){t<0||i<0||t>=this.width||i>=this.height||(this.data[t+i*this.width]=e)}getData(t,i){return t<0||i<0||t>=this.width||i>=this.height?0:255&this.data[t+i*this.width]}recalcVisibility(){for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++){let e=this.getTileState(i,t,6);3===e&&(e>>=1),this.setTileState(i,t,e,6)}for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++){this.getTileState(i,t,1)&&this.revealTile(i,t,4)}}revealTile(t,i,e){for(let s=i-e;s<=i+e;s++)if(!(s<0||s>=this.height))for(let h=t-e;h<=t+e;h++){if(h<0||h>=this.width)continue;const a=h-t,r=s-i;if(a*a+r*r<=e*e+2){if(0===s||0===h||h===this.width-1||s===this.height-1)continue;this.setTileState(h,s,3,6)}}}}(128,128),L=()=>{if(T&&!(C>0)){if(Y.width=window.innerWidth,Y.height=window.innerHeight,z=new u(b,128,128),Y.onmousedown=t=>{t.preventDefault(),M=!0,x=!1,y=t.clientX,p=t.clientY},Y.onclick=t=>{if(M=!1,!x){const i=Math.floor(D+16*-S+window.innerWidth/Q/2),e=Math.floor(B+16*-E+window.innerHeight/Q/2),s=Math.floor((t.clientX/Q-i)/16),h=Math.floor((t.clientY/Q-e)/16);X(s,h,t.clientX/Q,t.clientY/Q)}},window.onmousemove=t=>{if(!M)return;t.preventDefault();const i=t.clientX-y,e=t.clientY-p;(x||i*i+e*e>64)&&(x=!0,D+=i/Q,B+=e/Q,y=t.clientX,p=t.clientY)},!v){for(let t=0;t<128;t++)for(let i=0;i<128;i++){const e=i+128*t;P.tiles[e]===m.startingPosition.id&&(S=i,E=t,P.setTileState(S,E,1,f.OWNED),P.recalcVisibility())}W(),v=!0}K()}};window.onresize=L;let k=null,G=null,N=!1;const X=(t,i,e=800,s=600)=>{const h=Math.floor(b.canvas.width/Q),a=Math.floor(b.canvas.height/Q);if(e>=0&&e<=h&&s>=a-35&&s<=a&&k&&G){return void(P.getTile(k,G).isPassable&&_(e,s))}if(t<0||i<0||t>128||i>128)return k=null,void(G=null);const r=P.getTileState(t,i,f.VISIBLE);if(0===r)return k=null,void(G=null);k===t&&G===i||(k=t,G=i,N=3===r)};let R=Date.now(),U=Date.now(),F=0;const W=()=>{requestAnimationFrame(W),R=U,U=Date.now(),F+=U-R,F>=60&&(F=0,j());const t=O.update(D,B,(()=>{}),(()=>{if(k&&G){for(let t=0;t<5;t++)P.entities.push(0===Math.round(1*Math.random())?new h(k,G):new a(k,G));P.setTileState(k,G,1,f.OWNED),P.recalcVisibility(),k=null,G=null}}));D===t[0]&&B===t[1]||(D=t[0],B=t[1]),K()},j=()=>{P.update()},K=()=>{Q=Math.max(Math.floor(Y.height/300+1),Math.floor(Y.width/(16/9*300)+1)),D>16*S&&(D=16*S),B>16*E&&(B=16*E),D<16*S-2016&&(D=16*S-2016),B<16*E-2016&&(B=16*E-2016),b.imageSmoothingEnabled=!1,b.setTransform(Q,0,0,Q,0,0);const t=Math.floor(D+16*-S+window.innerWidth/Q/2),i=Math.floor(B+16*-E+window.innerHeight/Q/2);P.render(Y,b,t,i,Q);for(var e=0;e<H.length;e++){const t=Math.floor(b.canvas.width/Q),i=Math.floor(b.canvas.height/Q);b.fillStyle="rgba(255, 255, 255, 0.3)",b.fillRect(0,i-35,t,i),Z(H[e].name,t/2+2,i-25-5,3),$(H[e].imageX,H[e].imageY,t/2,i-25)}if(k&&G&&(b.strokeStyle="white",b.strokeRect(16*k+t,16*G+i,16,16),N)){const e=P.getTile(k,G).getOutcome();e&&(b.fillStyle="rgba(0, 0, 0, 0.3)",b.fillRect(16*k+t+16,16*G+i,18,16),b.drawImage(I,8*d[e.type].imageX,8*d[e.type].imageY,8,8,16*k+t+18,16*G+i+4,8,8),Z(`${e.amount}`,16*k+t+27,16*G+i+5,5))}J(),z.render(Y,P,16,Q)},q=[{imageX:0,imageY:11},{imageX:1,imageY:11}],J=()=>{for(let t=0;t<q.length;t++)b.drawImage(I,8*q[t].imageX,8*q[t].imageY,8,8,4,4+14*t,8,8),Z("0",14,5+14*t,6)},V="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",Z=(t,i,e,s=8)=>{t=t.toUpperCase();for(var h=0;h<t.length;h++){var a=V.indexOf(t.charAt(h)),r=0+a%32,n=29+(a>>5);b.drawImage(I,8*r,8*n,8,8,i+h*s,e,s,s)}},_=(t,i)=>{const e=Math.floor(b.canvas.width/Q)/2,s=Math.floor(b.canvas.height/Q)-25;t>=e&&t<=e+16&&i>=s&&i<=s+16&&k&&G&&(P.setTileState(k,G,1,f.OWNED),P.recalcVisibility(),k=null,G=null)},$=(t,i,e,s)=>{b.beginPath(),b.strokeStyle="yellow",b.rect(e,s,16,16),b.stroke(),b.drawImage(I,8*t,8*i,16,16,e,s,16,16)};

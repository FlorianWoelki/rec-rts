var e=Object.defineProperty,t=("undefined"!=typeof require&&require,(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s));!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i="data:image/png;base64,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";class s{constructor(e,i,s){t(this,"w"),t(this,"h"),t(this,"values"),this.w=e,this.h=i,this.values=new Array(e*i);for(let t=0;t<i;t+=s)for(let i=0;i<e;i+=s)this.setSample(i,t,2*Math.random()-1);let r=s,a=1/e,h=1;do{const t=r/2;for(let s=0;s<i;s+=r)for(let i=0;i<e;i+=r){const e=(this.sample(i,s)+this.sample(i+r,s)+this.sample(i,s+r)+this.sample(i+r,s+r))/4+(2*Math.random()-1)*r*a;this.setSample(i+t,s+t,e)}for(let i=0;i<e;i+=r)for(let s=0;s<e;s+=r){const e=this.sample(s,i),h=this.sample(s+r,i),d=this.sample(s,i+r),l=this.sample(s+t,i+t),n=this.sample(s+t,i-t),o=this.sample(s-t,i+t),A=(e+h+l+n)/4+(2*Math.random()-1)*r*a*.5,g=(e+d+l+o)/4+(2*Math.random()-1)*r*a*.5;this.setSample(s+t,i,A),this.setSample(s,i+t,g)}r/=2,a*=h+.8,h*=.3}while(r>1)}sample(e,t){return this.values[(e&this.w-1)+(t&this.h-1)*this.w]}setSample(e,t,i){this.values[(e&this.w-1)+(t&this.h-1)*this.w]=i}}const r=(e,t)=>{const i=new s(e,t,16),r=new s(e,t,16),h=new s(e,t,16),d=new s(e,t,32),l=new s(e,t,32),o=new Array(e*t),A=new Array(e*t);for(let s=0;s<t;s++)for(let a=0;a<e;a++){const A=a+s*e;let g=3*Math.abs(d.values[A]-l.values[A])-2,c=Math.abs(i.values[A]-r.values[A]);c=3*Math.abs(c-h.values[A])-2;let w=a/(e-1)*2-1,m=s/(t-1)*2-1;w<0&&(w=-w),m<0&&(m=-m);let u=w>=m?w:m;u*=u*u*u,u*=u*u*u,g=g+1-20*u,o[A]=g<-.5?n.water.id:g>.5&&c<-1.5?n.rock.id:n.grass.id}for(let s=0;s<e*t/2800;s++){let i=Math.round(Math.random()*e),s=Math.round(Math.random()*t);for(let r=0;r<10;r++){let r=i+Math.round(21*Math.random()-10),a=s+Math.round(21*Math.random()-10);for(let i=0;i<100;i++){let i=r+Math.round(5*Math.random())-Math.round(5*Math.random()),s=a+Math.round(5*Math.random())-Math.round(5*Math.random());for(let r=s-1;r<=s+1;r++)for(let s=i-1;s<=i+1;s++)s>=0&&r>=0&&s<e&&r<t&&1==o[s+r*e]&&(o[s+r*e]=n.sand.id)}}}for(let s=0;s<e*t/400;s++){const i=Math.round(Math.random()*e),s=Math.round(Math.random()*t);for(let r=0;r<200;r++){const r=i+Math.round(15*Math.random())-Math.round(15*Math.random()),a=s+Math.round(15*Math.random())-Math.round(15*Math.random());r>=0&&a>=0&&r<e&&a<t&&o[r+a*e]==n.grass.id&&(o[r+a*e]=n.tree.id)}}for(let s=0;s<e*t/40;s++){const i=Math.round(Math.random()*e),s=Math.round(Math.random()*t);i>=0&&s>=0&&i<e&&s<<t&&o[i+s*e]===n.sand.id&&(o[i+s*e]=n.cactus.id)}for(let s=0;s<e*t/400;s++){const i=Math.round(Math.random()*e),s=Math.round(Math.random()*t);for(let r=0;r<30;r++){const r=i+Math.round(5*Math.random())-Math.round(5*Math.random()),a=s+Math.round(5*Math.random())-Math.round(5*Math.random());r>=0&&a>=0&&r<e&&a<t&&o[r+a*e]==n.grass.id&&(o[r+a*e]=n.flower.id)}}let g=-1,c=-1;for(;-1===g||-1===c;){g=Math.round(Math.random()*e),c=Math.round(Math.random()*t);e:for(let t=c-1;t<=c+1;t++)for(let i=g-1;i<=g+1;i++)if(o[i+t*e]===n.water.id||o[i+t*e]===n.rock.id||o[i+t*e]===n.tree.id){g=-1,c=-1;break e}const i=a(o,e,g,c,3,3,n.tree.id),s=a(o,e,g,c,5,1,n.rock.id);i&&s||(g=-1,c=-1)}return o[g+c*e]=n.startingPosition.id,[o,A]},a=(e,t,i,s,r,a,h)=>{let d=0;for(let l=s-r;l<=s+r;l++)for(let s=i-r;s<=i+r;s++)e[s+l*t]===h&&d++;return d>=a},h={wood:{imageX:0,imageY:11},stone:{imageX:1,imageY:11}};class d{constructor(e){t(this,"id"),t(this,"isFarmable",!1),t(this,"isPassable",!0),t(this,"isOnGrass",!1),t(this,"isOnSand",!1),t(this,"color",0),this.id=e}update(e,t,i){}getOutcome(){}}class l extends d{constructor(e){super(e),this.color=1096065}render(e,t,i,s,r,a){const h=e.getTile(i,s-1).id===this.id||e.getTile(i,s-1).id===n.tree.id||e.getTile(i,s-1).id===n.flower.id,d=e.getTile(i,s+1).id===this.id||e.getTile(i,s+1).id===n.tree.id||e.getTile(i,s+1).id===n.flower.id,l=e.getTile(i-1,s).id===this.id||e.getTile(i-1,s).id===n.tree.id||e.getTile(i-1,s).id===n.flower.id,o=e.getTile(i+1,s).id===this.id||e.getTile(i+1,s).id===n.tree.id||e.getTile(i+1,s).id===n.flower.id,A=e.getTile(i-1,s-1).id===this.id||e.getTile(i-1,s-1).id===n.tree.id||e.getTile(i-1,s-1).id===n.flower.id,g=e.getTile(i+1,s-1).id===this.id||e.getTile(i+1,s-1).id===n.tree.id||e.getTile(i+1,s-1).id===n.flower.id,c=e.getTile(i-1,s+1).id===this.id||e.getTile(i-1,s+1).id===n.tree.id||e.getTile(i-1,s+1).id===n.flower.id,w=e.getTile(i+1,s+1).id===this.id||e.getTile(i+1,s+1).id===n.tree.id||e.getTile(i+1,s+1).id===n.flower.id;h||l?h&&l&&!A?e.renderTile(t,32,32,i,s,r,a):e.renderTile(t,l?8:0,h?32:24,i,s,r,a):e.renderTile(t,0,24,i,s,r,a),h||o?h&&o&&!g?e.renderTile(t,24,32,i,s,r+8,a):e.renderTile(t,o?8:16,h?32:24,i,s,r+8,a):e.renderTile(t,16,24,i,s,r+8,a),d||l?d&&l&&!c?e.renderTile(t,32,24,i,s,r,a+8):e.renderTile(t,l?8:0,d?32:40,i,s,r,a+8):e.renderTile(t,0,40,i,s,r,a+8),d||o?d&&o&&!w?e.renderTile(t,24,24,i,s,r+8,a+8):e.renderTile(t,o?8:16,d?32:40,i,s,r+8,a+8):e.renderTile(t,16,40,i,s,r+8,a+8)}}const n={water:new class extends d{constructor(e){super(e),t(this,"position1",0),t(this,"position2",0),t(this,"position3",0),t(this,"position4",0),t(this,"shouldAnimate",!0),this.isPassable=!1,this.color=3900150}render(e,t,i,s,r,a){this.shouldAnimate&&(this.position1=Math.round(3+3*Math.random()),this.position2=Math.round(3+3*Math.random()),this.position3=Math.round(3+3*Math.random()),this.position4=Math.round(3+3*Math.random()),this.shouldAnimate=!1);const h=e.getTile(i,s-1).id===this.id,d=e.getTile(i,s+1).id===this.id,l=e.getTile(i-1,s).id===this.id,n=e.getTile(i+1,s).id===this.id,o=e.getTile(i-1,s-1).id===this.id,A=e.getTile(i+1,s-1).id===this.id;h||l?h&&l&&!o?e.renderTile(t,32,8,i,s,r,a):h&&l?e.renderTile(t,8*this.position1,16,i,s,r,a):e.renderTile(t,l?8:0,h?8:0,i,s,r,a):e.renderTile(t,0,0,i,s,r,a),h||n?h&&n&&!A?e.renderTile(t,24,8,i,s,r+8,a):h&&n?e.renderTile(t,8*this.position2,16,i,s,r+8,a):e.renderTile(t,n?8:16,h?8:0,i,s,r+8,a):e.renderTile(t,16,0,i,s,r+8,a),d||l?d&&l?e.renderTile(t,8*this.position3,16,i,s,r,a+8):e.renderTile(t,l?8:0,d?8:16,i,s,r,a+8):e.renderTile(t,0,16,i,s,r,a+8),d||n?d&&n?e.renderTile(t,8*this.position4,16,i,s,r+8,a+8):e.renderTile(t,n?8:16,d?8:16,i,s,r+8,a+8):e.renderTile(t,16,16,i,s,r+8,a+8),h&&!l&&o&&e.renderTile(t,32,0,i,s,r,a-8),h&&!n&&A&&e.renderTile(t,24,0,i,s,r+8,a-8)}update(e,t,i){e.tickCount%10==0&&(this.shouldAnimate=!0)}}(0),grass:new l(1),sand:new class extends d{constructor(e){super(e),this.color=16498468}render(e,t,i,s,r,a){e.renderTile(t,40,0,i,s,r,a),e.renderTile(t,40,0,i,s,r+8,a),e.renderTile(t,40,0,i,s,r,a+8),e.renderTile(t,40,0,i,s,r+8,a+8)}}(2),tree:new class extends d{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1,this.isOnGrass=!0,this.color=417606}render(e,t,i,s,r,a){e.renderTile(t,16,72,i,s,r,a),e.renderTile(t,24,72,i,s,r+8,a),e.renderTile(t,16,80,i,s,r,a+8),e.renderTile(t,24,80,i,s,r+8,a+8)}getOutcome(){return{amount:3,type:"wood"}}}(3),rock:new class extends d{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1,this.color=10265519}render(e,t,i,s,r,a){const h=e.getTile(i,s-1).id===this.id,d=e.getTile(i,s+1).id===this.id,l=e.getTile(i-1,s).id===this.id,n=e.getTile(i+1,s).id===this.id,o=e.getTile(i-1,s-1).id===this.id,A=e.getTile(i+1,s-1).id===this.id,g=e.getTile(i-1,s+1).id===this.id,c=e.getTile(i+1,s+1).id===this.id;h||l?h&&l&&!o?e.renderTile(t,32,56,i,s,r,a):e.renderTile(t,l?8:0,h?56:48,i,s,r,a):e.renderTile(t,0,48,i,s,r,a),h||n?h&&n&&!A?e.renderTile(t,24,56,i,s,r+8,a):e.renderTile(t,n?8:16,h?56:48,i,s,r+8,a):e.renderTile(t,16,48,i,s,r+8,a),d||l?d&&l&&!g?e.renderTile(t,32,48,i,s,r,a+8):e.renderTile(t,l?8:0,d?56:64,i,s,r,a+8):e.renderTile(t,0,64,i,s,r,a+8),d||n?d&&n&&!c?e.renderTile(t,24,48,i,s,r+8,a+8):e.renderTile(t,n?8:16,d?56:64,i,s,r+8,a+8):e.renderTile(t,16,64,i,s,r+8,a+8)}getOutcome(){return{amount:3,type:"stone"}}}(4),flower:new class extends d{constructor(e){super(e),this.isOnGrass=!0,this.color=1096065}render(e,t,i,s,r,a){e.renderTile(t,48,0,i,s,r+4,a+4)}}(5),cactus:new class extends d{constructor(e){super(e),this.isOnSand=!0,this.color=16498468}render(e,t,i,s,r,a){e.renderTile(t,56,0,i,s,r,a),e.renderTile(t,64,0,i,s,r+8,a),e.renderTile(t,56,8,i,s,r,a+8),e.renderTile(t,64,8,i,s,r+8,a+8)}}(6),dirt:new class extends d{constructor(e){super(e),this.color=7877903}render(e,t,i,s,r,a){const h=e.getTile(i,s-1).id===this.id,d=e.getTile(i,s+1).id===this.id,l=e.getTile(i-1,s).id===this.id,n=e.getTile(i+1,s).id===this.id,o=e.getTile(i-1,s-1).id===this.id,A=e.getTile(i+1,s-1).id===this.id,g=e.getTile(i-1,s+1).id===this.id,c=e.getTile(i+1,s+1).id===this.id;h||l?h&&l&&!o?e.renderTile(t,72,32,i,s,r,a):e.renderTile(t,l?48:40,h?32:24,i,s,r,a):e.renderTile(t,40,24,i,s,r,a),h||n?h&&n&&!A?e.renderTile(t,64,32,i,s,r+8,a):e.renderTile(t,n?48:56,h?32:24,i,s,r+8,a):e.renderTile(t,56,24,i,s,r+8,a),d||l?d&&l&&!g?e.renderTile(t,72,24,i,s,r,a+8):e.renderTile(t,l?48:40,d?32:40,i,s,r,a+8):e.renderTile(t,40,40,i,s,r,a+8),d||n?d&&n&&!c?e.renderTile(t,64,24,i,s,r+8,a+8):e.renderTile(t,n?48:56,d?32:40,i,s,r+8,a+8):e.renderTile(t,56,40,i,s,r+8,a+8)}}(7),startingPosition:new l(999)},o=Object.entries(n).map((([e,t])=>t));var A,g;(g=A||(A={}))[g.OWNED=1]="OWNED",g[g.VISIBLE=6]="VISIBLE";class c{constructor(e,i,s){t(this,"map2d"),t(this,"imageData"),t(this,"minimapCanvas",document.createElement("canvas")),t(this,"width"),t(this,"height"),this.map2d=e,this.width=i,this.height=s,this.imageData=e.createImageData(i,s),this.minimapCanvas.width=this.imageData.width,this.minimapCanvas.height=this.imageData.height}getRGB(e){return[e>>16&255,e>>8&255,255&e]}render(e,t,i,s){const r=Math.floor(this.map2d.canvas.width/s)-e.width/(i+s+10)-8,a=Math.round(e.width/(i+s+10));for(let h=0;h<this.height;h++)for(let e=0;e<this.width;e++){const i=e+h*this.width,s=t.getTile(e,h),[r,a,d]=this.getRGB(s.color);t.getTileState(e,h,A.OWNED)?(this.imageData.data[4*i]=255,this.imageData.data[4*i+1]=0,this.imageData.data[4*i+2]=0,this.imageData.data[4*i+3]=255):t.getTileState(e,h,A.VISIBLE)>=1?(this.imageData.data[4*i]=r,this.imageData.data[4*i+1]=a,this.imageData.data[4*i+2]=d,this.imageData.data[4*i+3]=255):(this.imageData.data[4*i]=0,this.imageData.data[4*i+1]=0,this.imageData.data[4*i+2]=0,this.imageData.data[4*i+3]=255)}this.minimapCanvas.getContext("2d").putImageData(this.imageData,0,0),this.map2d.drawImage(this.minimapCanvas,r,8,a,a),this.map2d.strokeStyle="rgba(255, 255, 255, 0.35)",this.map2d.strokeRect(r,8,a,a)}}let w=!1,m=!1;window.onload=()=>{w=!0,Q()};let u=!1,f=!1,T=0,M=0,p=0,D=0,v=0,P=0;let S=3;let I=0;const O=(e=>{const t=new Image;return I++,t.onload=()=>{I--,0===I&&Q()},t.src=e,t})(i),B=document.querySelector("#map"),H=B.getContext("2d"),b=new class{constructor(){t(this,"scrollX",0),t(this,"scrollY",0),t(this,"scrollSpeed",3),t(this,"keys",[]),window.onkeydown=e=>{this.keys[e.keyCode]=!0},window.onkeyup=e=>{this.keys[e.keyCode]=!1}}update(e,t,i,s){return this.scrollX=e,this.scrollY=t,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&i&&i(),this.keys[49]&&s&&s(),[this.scrollX,this.scrollY]}};let y;const C=new Array(1);for(let R=0;R<C.length;R++)C[R]={name:"Base",imageX:0,imageY:9};const z=new class{constructor(e,s){t(this,"tiles"),t(this,"data"),t(this,"tilesState"),t(this,"tileSize",16),t(this,"tickCount",0),t(this,"tileImage"),t(this,"imagesToLoad",0),t(this,"width"),t(this,"height"),this.width=e,this.height=s,this.tiles=new Array(e*s),this.data=new Array(e*s),this.tilesState=new Array(e*s),this.tileImage=this.loadImage(i)}loadImage(e){var t=new Image;return this.imagesToLoad++,t.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},t.src=e,t}init(){const e=((e,t)=>{for(;;){const i=r(e,t),s=new Array(256);for(let r=0;r<e*t;r++)s[255&i[0][r]]++;if(!(s[2]<100||s[1]<100))return i}})(this.width,this.height);this.tiles=e[0],this.tilesState=e[1],this.data=e[1],this.tilesState.fill(0)}update(){this.tickCount++,this.tickCount>=Number.MAX_VALUE&&(this.tickCount=0);for(let e=0;e<this.width*this.height/50;e++){const e=Math.round(Math.random()*this.width),t=Math.round(Math.random()*this.height);this.getTile(e,t).update(this,e,t)}}render(e,t,i,s,r){const a=Math.floor(-i/this.tileSize),h=Math.floor(-s/this.tileSize),d=Math.ceil((-i+e.width/r)/this.tileSize),l=Math.ceil((-s+e.height/r)/this.tileSize);for(let A=h;A<l;A++)for(let e=a;e<d;e++){const r=this.getTile(e,A),a=this.getTileState(e,A,1);if(r.isOnGrass){o.find((e=>e.id===n.grass.id)).render(this,t,e,A,i,s)}else if(r.isOnSand){o.find((e=>e.id===n.sand.id)).render(this,t,e,A,i,s)}r.render(this,t,e,A,i,s),1===a&&t.drawImage(this.tileImage,0,72,16,16,e*this.tileSize+i,A*this.tileSize+s,16,16)}for(let n=h;n<l;n++)for(let e=a;e<d;e++){const r=this.getTileState(e,n,6);if(1===r)t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,n*this.tileSize+s+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,n*this.tileSize+s+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,n*this.tileSize+s+8,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,n*this.tileSize+s+8,8,8);else for(let a=0;a<4;a++){const h=a%2*2-1,d=2*(a>>1)-1,l=this.getTileState(e,n+d,6)!==r,o=this.getTileState(e+h,n,6)!==r;let A=25,g=1;3===r&&(g+=3),l&&(g+=d),o&&(A+=h),t.drawImage(this.tileImage,8*A,8*g,8,8,e*this.tileSize+i+a%2*8,n*this.tileSize+s+8*(a>>1),8,8)}}}renderTile(e,t,i,s,r,a,h){e.drawImage(this.tileImage,t,i,8,8,s*this.tileSize+a,r*this.tileSize+h,8,8)}getTile(e,t){if(e<0||t<0||e>=this.width||t>=this.height)return n.water;const i=o.find((i=>this.tiles[e+t*this.width]===i.id));return null!=i?i:n.water}getTileState(e,t,i){return e<0||t<0||e>=this.width||t>=this.height?0:6===i?(this.tilesState[e+t*this.width]&i)>>1:this.tilesState[e+t*this.width]&i}setTileState(e,t,i,s){if(!(e<0||t<0||e>=this.width||t>=this.height))if(6===s){const s=this.tilesState[e+t*this.width];this.tilesState[e+t*this.width]=i<<1|1&s}else this.tilesState[e+t*this.width]^=i,this.tiles[e+t*this.width]=n.dirt.id}setTile(e,t,i){e<0||t<0||e>=this.width||t>=this.height||(this.tiles[e+t*this.width]=i.id)}setData(e,t,i){e<0||t<0||e>=this.width||t>=this.height||(this.data[e+t*this.width]=i)}getData(e,t){return e<0||t<0||e>=this.width||t>=this.height?0:255&this.data[e+t*this.width]}recalcVisibility(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){let i=this.getTileState(t,e,6);3===i&&(i>>=1),this.setTileState(t,e,i,6)}for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){this.getTileState(t,e,1)&&this.revealTile(t,e,4)}}revealTile(e,t,i){for(let s=t-i;s<=t+i;s++)if(!(s<0||s>=this.height))for(let r=e-i;r<=e+i;r++){if(r<0||r>=this.width)continue;const a=r-e,h=s-t;if(a*a+h*h<=i*i+2){if(0===s||0===r||r===this.width-1||s===this.height-1)continue;this.setTileState(r,s,3,6)}}}}(128,128),Q=()=>{if(w&&!(I>0)){if(B.width=window.innerWidth,B.height=window.innerHeight,y=new c(H,128,128),B.onmousedown=e=>{e.preventDefault(),u=!0,f=!1,T=e.clientX,M=e.clientY},B.onclick=e=>{if(u=!1,!f){const t=Math.floor(p+16*-v+window.innerWidth/S/2),i=Math.floor(D+16*-P+window.innerHeight/S/2),s=Math.floor((e.clientX/S-t)/16),r=Math.floor((e.clientY/S-i)/16);Y(s,r,e.clientX/S,e.clientY/S)}},window.onmousemove=e=>{if(!u)return;e.preventDefault();const t=e.clientX-T,i=e.clientY-M;(f||t*t+i*i>64)&&(f=!0,p+=t/S,D+=i/S,T=e.clientX,M=e.clientY)},!m){for(let e=0;e<128;e++)for(let t=0;t<128;t++){const i=t+128*e;z.tiles[i]===n.startingPosition.id&&(v=t,P=e,z.setTileState(v,P,1,A.OWNED),z.recalcVisibility())}N(),m=!0}U()}};window.onresize=Q;let E=null,L=null,k=!1;const Y=(e,t,i=800,s=600)=>{const r=Math.floor(H.canvas.width/S),a=Math.floor(H.canvas.height/S);if(i>=0&&i<=r&&s>=a-35&&s<=a&&E&&L){return void(z.getTile(E,L).isPassable&&V(i,s))}if(e<0||t<0||e>128||t>128)return E=null,void(L=null);const h=z.getTileState(e,t,A.VISIBLE);if(0===h)return E=null,void(L=null);E===e&&L===t||(E=e,L=t,k=3===h)};let X=Date.now(),F=Date.now(),x=0;const N=()=>{requestAnimationFrame(N),X=F,F=Date.now(),x+=F-X,x>=60&&(x=0,G());const e=b.update(p,D,(()=>{}),(()=>{E&&L&&(z.setTileState(E,L,1,A.OWNED),z.recalcVisibility(),E=null,L=null)}));p===e[0]&&D===e[1]||(p=e[0],D=e[1]),U()},G=()=>{z.update()},U=()=>{S=Math.max(Math.floor(B.height/300+1),Math.floor(B.width/(16/9*300)+1)),p>16*v&&(p=16*v),D>16*P&&(D=16*P),p<16*v-2016&&(p=16*v-2016),D<16*P-2016&&(D=16*P-2016),H.imageSmoothingEnabled=!1,H.setTransform(S,0,0,S,0,0);const e=Math.floor(p+16*-v+window.innerWidth/S/2),t=Math.floor(D+16*-P+window.innerHeight/S/2);z.render(B,H,e,t,S);for(var i=0;i<C.length;i++){const e=Math.floor(H.canvas.width/S),t=Math.floor(H.canvas.height/S);H.fillStyle="rgba(255, 255, 255, 0.3)",H.fillRect(0,t-35,e,t),W(C[i].name,e/2+2,t-25-5,3),j(C[i].imageX,C[i].imageY,e/2,t-25)}if(E&&L&&(H.strokeStyle="white",H.strokeRect(16*E+e,16*L+t,16,16),k)){const i=z.getTile(E,L).getOutcome();i&&(H.fillStyle="rgba(0, 0, 0, 0.3)",H.fillRect(16*E+e+16,16*L+t,18,16),H.drawImage(O,8*h[i.type].imageX,8*h[i.type].imageY,8,8,16*E+e+18,16*L+t+4,8,8),W(`${i.amount}`,16*E+e+27,16*L+t+5,5))}J(),y.render(B,z,16,S)},q=[{imageX:0,imageY:11},{imageX:1,imageY:11}],J=()=>{for(let e=0;e<q.length;e++)H.drawImage(O,8*q[e].imageX,8*q[e].imageY,8,8,4,4+14*e,8,8),W("0",14,5+14*e,6)},K="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",W=(e,t,i,s=8)=>{e=e.toUpperCase();for(var r=0;r<e.length;r++){var a=K.indexOf(e.charAt(r)),h=0+a%32,d=29+(a>>5);H.drawImage(O,8*h,8*d,8,8,t+r*s,i,s,s)}},V=(e,t)=>{const i=Math.floor(H.canvas.width/S)/2,s=Math.floor(H.canvas.height/S)-25;e>=i&&e<=i+16&&t>=s&&t<=s+16&&E&&L&&(z.setTileState(E,L,1,A.OWNED),z.recalcVisibility(),E=null,L=null)},j=(e,t,i,s)=>{H.beginPath(),H.strokeStyle="yellow",H.rect(i,s,16,16),H.stroke(),H.drawImage(O,8*e,8*t,16,16,i,s,16,16)};

var e=Object.defineProperty,t=("undefined"!=typeof require&&require,(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s));!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i="data:image/png;base64,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";Math.seed=e=>{const t=4294967295;let i=123456789+e&t,s=987654321-e&t;return()=>{s=36969*(65535&s)+(s>>>16)&t,i=18e3*(65535&i)+(i>>>16)&t;let e=(s<<16)+(65535&i)>>>0;return e/=4294967296,e}};let s=Math.seed(Math.random()*(10+90*Math.random()));class r{constructor(e,i,r){t(this,"w"),t(this,"h"),t(this,"values"),this.w=e,this.h=i,this.values=new Array(e*i);for(let t=0;t<i;t+=r)for(let i=0;i<e;i+=r)this.setSample(i,t,2*s()-1);let h=r,a=1/e,d=1;do{const t=h/2;for(let r=0;r<i;r+=h)for(let i=0;i<e;i+=h){const e=(this.sample(i,r)+this.sample(i+h,r)+this.sample(i,r+h)+this.sample(i+h,r+h))/4+(2*s()-1)*h*a;this.setSample(i+t,r+t,e)}for(let i=0;i<e;i+=h)for(let r=0;r<e;r+=h){const e=this.sample(r,i),d=this.sample(r+h,i),l=this.sample(r,i+h),n=this.sample(r+t,i+t),o=this.sample(r+t,i-t),A=this.sample(r-t,i+t),g=(e+d+n+o)/4+(2*s()-1)*h*a*.5,c=(e+l+n+A)/4+(2*s()-1)*h*a*.5;this.setSample(r+t,i,g),this.setSample(r,i+t,c)}h/=2,a*=d+.8,d*=.3}while(h>1)}sample(e,t){return this.values[(e&this.w-1)+(t&this.h-1)*this.w]}setSample(e,t,i){this.values[(e&this.w-1)+(t&this.h-1)*this.w]=i}}const h=(e,t,i=Math.random()*Number.MAX_SAFE_INTEGER)=>{s=Math.seed(i);const h=new r(e,t,16),d=new r(e,t,16),l=new r(e,t,16),n=new r(e,t,32),A=new r(e,t,32),g=new Array(e*t),c=new Array(e*t);for(let s=0;s<t;s++)for(let i=0;i<e;i++){const r=i+s*e;let a=3*Math.abs(n.values[r]-A.values[r])-2,c=Math.abs(h.values[r]-d.values[r]);c=3*Math.abs(c-l.values[r])-2;let w=i/(e-1)*2-1,u=s/(t-1)*2-1;w<0&&(w=-w),u<0&&(u=-u);let f=w>=u?w:u;f*=f*f*f,f*=f*f*f,a=a+1-20*f,g[r]=a<-.5?o.water.id:a>.5&&c<-1.5?o.rock.id:o.grass.id}for(let r=0;r<e*t/2800;r++){let i=Math.round(s()*e),r=Math.round(s()*t);for(let h=0;h<10;h++){let h=i+Math.round(21*s()-10),a=r+Math.round(21*s()-10);for(let i=0;i<100;i++){let i=h+Math.round(5*s())-Math.round(5*s()),r=a+Math.round(5*s())-Math.round(5*s());for(let s=r-1;s<=r+1;s++)for(let r=i-1;r<=i+1;r++)r>=0&&s>=0&&r<e&&s<t&&1==g[r+s*e]&&(g[r+s*e]=o.sand.id)}}}for(let r=0;r<e*t/400;r++){const i=Math.round(s()*e),r=Math.round(s()*t);for(let h=0;h<200;h++){const h=i+Math.round(15*s())-Math.round(15*s()),a=r+Math.round(15*s())-Math.round(15*s());h>=0&&a>=0&&h<e&&a<t&&g[h+a*e]==o.grass.id&&(g[h+a*e]=o.tree.id)}}for(let r=0;r<e*t/40;r++){const i=Math.round(s()*e),r=Math.round(s()*t);i>=0&&r>=0&&i<e&&r<<t&&g[i+r*e]===o.sand.id&&(g[i+r*e]=o.cactus.id)}for(let r=0;r<e*t/400;r++){const i=Math.round(s()*e),r=Math.round(s()*t);for(let h=0;h<30;h++){const h=i+Math.round(5*s())-Math.round(5*s()),a=r+Math.round(5*s())-Math.round(5*s());h>=0&&a>=0&&h<e&&a<t&&g[h+a*e]==o.grass.id&&(g[h+a*e]=o.flower.id)}}let w=-1,u=-1;for(;-1===w||-1===u;){w=Math.round(s()*e),u=Math.round(s()*t);e:for(let t=u-1;t<=u+1;t++)for(let i=w-1;i<=w+1;i++)if(g[i+t*e]===o.water.id||g[i+t*e]===o.rock.id||g[i+t*e]===o.tree.id){w=-1,u=-1;break e}const i=a(g,e,w,u,3,3,o.tree.id),r=a(g,e,w,u,5,1,o.rock.id);i&&r||(w=-1,u=-1)}return g[w+u*e]=o.startingPosition.id,[g,c]},a=(e,t,i,s,r,h,a)=>{let d=0;for(let l=s-r;l<=s+r;l++)for(let s=i-r;s<=i+r;s++)e[s+l*t]===a&&d++;return d>=h},d={wood:{imageX:0,imageY:11},stone:{imageX:1,imageY:11}};class l{constructor(e){t(this,"id"),t(this,"isFarmable",!1),t(this,"isPassable",!0),t(this,"isOnGrass",!1),t(this,"isOnSand",!1),t(this,"color",0),this.id=e}update(e,t,i){}getOutcome(){}}class n extends l{constructor(e){super(e),this.color=1096065}render(e,t,i,s,r,h){const a=e.getTile(i,s-1).id===this.id||e.getTile(i,s-1).id===o.tree.id||e.getTile(i,s-1).id===o.flower.id,d=e.getTile(i,s+1).id===this.id||e.getTile(i,s+1).id===o.tree.id||e.getTile(i,s+1).id===o.flower.id,l=e.getTile(i-1,s).id===this.id||e.getTile(i-1,s).id===o.tree.id||e.getTile(i-1,s).id===o.flower.id,n=e.getTile(i+1,s).id===this.id||e.getTile(i+1,s).id===o.tree.id||e.getTile(i+1,s).id===o.flower.id,A=e.getTile(i-1,s-1).id===this.id||e.getTile(i-1,s-1).id===o.tree.id||e.getTile(i-1,s-1).id===o.flower.id,g=e.getTile(i+1,s-1).id===this.id||e.getTile(i+1,s-1).id===o.tree.id||e.getTile(i+1,s-1).id===o.flower.id,c=e.getTile(i-1,s+1).id===this.id||e.getTile(i-1,s+1).id===o.tree.id||e.getTile(i-1,s+1).id===o.flower.id,w=e.getTile(i+1,s+1).id===this.id||e.getTile(i+1,s+1).id===o.tree.id||e.getTile(i+1,s+1).id===o.flower.id;a||l?a&&l&&!A?e.renderTile(t,32,32,i,s,r,h):e.renderTile(t,l?8:0,a?32:24,i,s,r,h):e.renderTile(t,0,24,i,s,r,h),a||n?a&&n&&!g?e.renderTile(t,24,32,i,s,r+8,h):e.renderTile(t,n?8:16,a?32:24,i,s,r+8,h):e.renderTile(t,16,24,i,s,r+8,h),d||l?d&&l&&!c?e.renderTile(t,32,24,i,s,r,h+8):e.renderTile(t,l?8:0,d?32:40,i,s,r,h+8):e.renderTile(t,0,40,i,s,r,h+8),d||n?d&&n&&!w?e.renderTile(t,24,24,i,s,r+8,h+8):e.renderTile(t,n?8:16,d?32:40,i,s,r+8,h+8):e.renderTile(t,16,40,i,s,r+8,h+8)}}const o={water:new class extends l{constructor(e){super(e),t(this,"position1",0),t(this,"position2",0),t(this,"position3",0),t(this,"position4",0),t(this,"shouldAnimate",!0),this.isPassable=!1,this.color=3900150}render(e,t,i,s,r,h){this.shouldAnimate&&(this.position1=Math.round(3+3*Math.random()),this.position2=Math.round(3+3*Math.random()),this.position3=Math.round(3+3*Math.random()),this.position4=Math.round(3+3*Math.random()),this.shouldAnimate=!1);const a=e.getTile(i,s-1).id===this.id,d=e.getTile(i,s+1).id===this.id,l=e.getTile(i-1,s).id===this.id,n=e.getTile(i+1,s).id===this.id,o=e.getTile(i-1,s-1).id===this.id,A=e.getTile(i+1,s-1).id===this.id;a||l?a&&l&&!o?e.renderTile(t,32,8,i,s,r,h):a&&l?e.renderTile(t,8*this.position1,16,i,s,r,h):e.renderTile(t,l?8:0,a?8:0,i,s,r,h):e.renderTile(t,0,0,i,s,r,h),a||n?a&&n&&!A?e.renderTile(t,24,8,i,s,r+8,h):a&&n?e.renderTile(t,8*this.position2,16,i,s,r+8,h):e.renderTile(t,n?8:16,a?8:0,i,s,r+8,h):e.renderTile(t,16,0,i,s,r+8,h),d||l?d&&l?e.renderTile(t,8*this.position3,16,i,s,r,h+8):e.renderTile(t,l?8:0,d?8:16,i,s,r,h+8):e.renderTile(t,0,16,i,s,r,h+8),d||n?d&&n?e.renderTile(t,8*this.position4,16,i,s,r+8,h+8):e.renderTile(t,n?8:16,d?8:16,i,s,r+8,h+8):e.renderTile(t,16,16,i,s,r+8,h+8),a&&!l&&o&&e.renderTile(t,32,0,i,s,r,h-8),a&&!n&&A&&e.renderTile(t,24,0,i,s,r+8,h-8)}update(e,t,i){e.tickCount%10==0&&(this.shouldAnimate=!0)}}(0),grass:new n(1),sand:new class extends l{constructor(e){super(e),this.color=16498468}render(e,t,i,s,r,h){e.renderTile(t,40,0,i,s,r,h),e.renderTile(t,40,0,i,s,r+8,h),e.renderTile(t,40,0,i,s,r,h+8),e.renderTile(t,40,0,i,s,r+8,h+8)}}(2),tree:new class extends l{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1,this.isOnGrass=!0,this.color=417606}render(e,t,i,s,r,h){e.renderTile(t,16,72,i,s,r,h),e.renderTile(t,24,72,i,s,r+8,h),e.renderTile(t,16,80,i,s,r,h+8),e.renderTile(t,24,80,i,s,r+8,h+8)}getOutcome(){return{amount:3,type:"wood"}}}(3),rock:new class extends l{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1,this.color=10265519}render(e,t,i,s,r,h){const a=e.getTile(i,s-1).id===this.id,d=e.getTile(i,s+1).id===this.id,l=e.getTile(i-1,s).id===this.id,n=e.getTile(i+1,s).id===this.id,o=e.getTile(i-1,s-1).id===this.id,A=e.getTile(i+1,s-1).id===this.id,g=e.getTile(i-1,s+1).id===this.id,c=e.getTile(i+1,s+1).id===this.id;a||l?a&&l&&!o?e.renderTile(t,32,56,i,s,r,h):e.renderTile(t,l?8:0,a?56:48,i,s,r,h):e.renderTile(t,0,48,i,s,r,h),a||n?a&&n&&!A?e.renderTile(t,24,56,i,s,r+8,h):e.renderTile(t,n?8:16,a?56:48,i,s,r+8,h):e.renderTile(t,16,48,i,s,r+8,h),d||l?d&&l&&!g?e.renderTile(t,32,48,i,s,r,h+8):e.renderTile(t,l?8:0,d?56:64,i,s,r,h+8):e.renderTile(t,0,64,i,s,r,h+8),d||n?d&&n&&!c?e.renderTile(t,24,48,i,s,r+8,h+8):e.renderTile(t,n?8:16,d?56:64,i,s,r+8,h+8):e.renderTile(t,16,64,i,s,r+8,h+8)}getOutcome(){return{amount:3,type:"stone"}}}(4),flower:new class extends l{constructor(e){super(e),this.isOnGrass=!0,this.color=1096065}render(e,t,i,s,r,h){e.renderTile(t,48,0,i,s,r+4,h+4)}}(5),cactus:new class extends l{constructor(e){super(e),this.isOnSand=!0,this.color=16498468}render(e,t,i,s,r,h){e.renderTile(t,56,0,i,s,r,h),e.renderTile(t,64,0,i,s,r+8,h),e.renderTile(t,56,8,i,s,r,h+8),e.renderTile(t,64,8,i,s,r+8,h+8)}}(6),dirt:new class extends l{constructor(e){super(e),this.color=7877903}render(e,t,i,s,r,h){const a=e.getTile(i,s-1).id===this.id,d=e.getTile(i,s+1).id===this.id,l=e.getTile(i-1,s).id===this.id,n=e.getTile(i+1,s).id===this.id,o=e.getTile(i-1,s-1).id===this.id,A=e.getTile(i+1,s-1).id===this.id,g=e.getTile(i-1,s+1).id===this.id,c=e.getTile(i+1,s+1).id===this.id;a||l?a&&l&&!o?e.renderTile(t,72,32,i,s,r,h):e.renderTile(t,l?48:40,a?32:24,i,s,r,h):e.renderTile(t,40,24,i,s,r,h),a||n?a&&n&&!A?e.renderTile(t,64,32,i,s,r+8,h):e.renderTile(t,n?48:56,a?32:24,i,s,r+8,h):e.renderTile(t,56,24,i,s,r+8,h),d||l?d&&l&&!g?e.renderTile(t,72,24,i,s,r,h+8):e.renderTile(t,l?48:40,d?32:40,i,s,r,h+8):e.renderTile(t,40,40,i,s,r,h+8),d||n?d&&n&&!c?e.renderTile(t,64,24,i,s,r+8,h+8):e.renderTile(t,n?48:56,d?32:40,i,s,r+8,h+8):e.renderTile(t,56,40,i,s,r+8,h+8)}}(7),startingPosition:new n(999)},A=Object.entries(o).map((([e,t])=>t));var g,c;(c=g||(g={}))[c.OWNED=1]="OWNED",c[c.VISIBLE=6]="VISIBLE";class w{constructor(e,i,s){t(this,"map2d"),t(this,"imageData"),t(this,"minimapCanvas",document.createElement("canvas")),t(this,"width"),t(this,"height"),this.map2d=e,this.width=i,this.height=s,this.imageData=e.createImageData(i,s),this.minimapCanvas.width=this.imageData.width,this.minimapCanvas.height=this.imageData.height}getRGB(e){return[e>>16&255,e>>8&255,255&e]}render(e,t,i,s){const r=Math.floor(this.map2d.canvas.width/s)-e.width/(i+s+10)-8,h=Math.round(e.width/(i+s+10));for(let a=0;a<this.height;a++)for(let e=0;e<this.width;e++){const i=e+a*this.width,s=t.getTile(e,a),[r,h,d]=this.getRGB(s.color);t.getTileState(e,a,g.OWNED)?(this.imageData.data[4*i]=255,this.imageData.data[4*i+1]=0,this.imageData.data[4*i+2]=0,this.imageData.data[4*i+3]=255):t.getTileState(e,a,g.VISIBLE)>=1?(this.imageData.data[4*i]=r,this.imageData.data[4*i+1]=h,this.imageData.data[4*i+2]=d,this.imageData.data[4*i+3]=255):(this.imageData.data[4*i]=0,this.imageData.data[4*i+1]=0,this.imageData.data[4*i+2]=0,this.imageData.data[4*i+3]=255)}this.minimapCanvas.getContext("2d").putImageData(this.imageData,0,0),this.map2d.drawImage(this.minimapCanvas,r,8,h,h),this.map2d.strokeStyle="rgba(255, 255, 255, 0.35)",this.map2d.strokeRect(r,8,h,h)}}class u{constructor(e,i){t(this,"x"),t(this,"y"),t(this,"tx",0),t(this,"ty",12),t(this,"animation",0),this.x=e,this.y=i}render(e,t,i,s){e.drawImage(t,8*this.tx,8*this.ty,16,16,16*this.x+i,16*this.y+s,16,16)}update(){this.animation+=1,this.animation%2==0&&(this.tx+=2,this.tx%8==0&&(this.tx=0),this.animation=0)}}let f=!1,m=!1;window.onload=()=>{f=!0,L()};let T=!1,M=!1,p=0,B=0,S=0,D=0,v=0,H=0;let C=3;let I=0;const Q=(e=>{const t=new Image;return I++,t.onload=()=>{I--,0===I&&L()},t.src=e,t})(i),y=document.querySelector("#map"),P=y.getContext("2d"),b=new class{constructor(){t(this,"scrollX",0),t(this,"scrollY",0),t(this,"scrollSpeed",3),t(this,"keys",[]),window.onkeydown=e=>{this.keys[e.keyCode]=!0},window.onkeyup=e=>{this.keys[e.keyCode]=!1}}update(e,t,i,s){return this.scrollX=e,this.scrollY=t,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&i&&i(),this.keys[49]&&s&&s(),[this.scrollX,this.scrollY]}};let x;const O=new Array(1);for(let _=0;_<O.length;_++)O[_]={name:"Base",imageX:0,imageY:9};const E=new class{constructor(e,s,r){t(this,"tiles"),t(this,"data"),t(this,"tilesState"),t(this,"tileSize",16),t(this,"tickCount",0),t(this,"tileImage"),t(this,"imagesToLoad",0),t(this,"width"),t(this,"height"),t(this,"seed"),t(this,"entities",[]),this.width=e,this.height=s,this.seed=r,this.tiles=new Array(e*s),this.data=new Array(e*s),this.tilesState=new Array(e*s),this.tileImage=this.loadImage(i)}loadImage(e){var t=new Image;return this.imagesToLoad++,t.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},t.src=e,t}init(){const e=((e,t,i=Math.random()*Number.MAX_SAFE_INTEGER)=>{for(;;){const s=h(e,t,i),r=new Array(256);for(let i=0;i<e*t;i++)r[255&s[0][i]]++;if(!(r[255&o.rock.id]<100||r[255&o.sand.id]<100||r[255&o.grass.id]<100||r[255&o.tree.id]<100))return s}})(this.width,this.height,this.seed);this.tiles=e[0],this.tilesState=e[1],this.data=e[1],this.tilesState.fill(0)}update(){this.tickCount++,this.tickCount>=Number.MAX_VALUE&&(this.tickCount=0);for(let e=0;e<this.width*this.height/50;e++){const e=Math.round(Math.random()*this.width),t=Math.round(Math.random()*this.height);this.getTile(e,t).update(this,e,t)}this.entities.forEach((e=>e.update()))}render(e,t,i,s,r){const h=Math.floor(-i/this.tileSize),a=Math.floor(-s/this.tileSize),d=Math.ceil((-i+e.width/r)/this.tileSize),l=Math.ceil((-s+e.height/r)/this.tileSize);for(let n=a;n<l;n++)for(let e=h;e<d;e++){const r=this.getTile(e,n),h=this.getTileState(e,n,1);if(r.isOnGrass){A.find((e=>e.id===o.grass.id)).render(this,t,e,n,i,s)}else if(r.isOnSand){A.find((e=>e.id===o.sand.id)).render(this,t,e,n,i,s)}r.render(this,t,e,n,i,s),1===h&&t.drawImage(this.tileImage,0,72,16,16,e*this.tileSize+i,n*this.tileSize+s,16,16)}this.entities.forEach((e=>e.render(t,this.tileImage,i,s)));for(let n=a;n<l;n++)for(let e=h;e<d;e++){const r=this.getTileState(e,n,6);if(1===r)t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,n*this.tileSize+s+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,n*this.tileSize+s+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,n*this.tileSize+s+8,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,n*this.tileSize+s+8,8,8);else for(let h=0;h<4;h++){const a=h%2*2-1,d=2*(h>>1)-1,l=this.getTileState(e,n+d,6)!==r,o=this.getTileState(e+a,n,6)!==r;let A=25,g=1;3===r&&(g+=3),l&&(g+=d),o&&(A+=a),t.drawImage(this.tileImage,8*A,8*g,8,8,e*this.tileSize+i+h%2*8,n*this.tileSize+s+8*(h>>1),8,8)}}}renderTile(e,t,i,s,r,h,a){e.drawImage(this.tileImage,t,i,8,8,s*this.tileSize+h,r*this.tileSize+a,8,8)}getTile(e,t){if(e<0||t<0||e>=this.width||t>=this.height)return o.water;const i=A.find((i=>this.tiles[e+t*this.width]===i.id));return null!=i?i:o.water}getTileState(e,t,i){return e<0||t<0||e>=this.width||t>=this.height?0:6===i?(this.tilesState[e+t*this.width]&i)>>1:this.tilesState[e+t*this.width]&i}setTileState(e,t,i,s){if(!(e<0||t<0||e>=this.width||t>=this.height))if(6===s){const s=this.tilesState[e+t*this.width];this.tilesState[e+t*this.width]=i<<1|1&s}else this.tilesState[e+t*this.width]^=i,this.tiles[e+t*this.width]=o.dirt.id}setTile(e,t,i){e<0||t<0||e>=this.width||t>=this.height||(this.tiles[e+t*this.width]=i.id)}setData(e,t,i){e<0||t<0||e>=this.width||t>=this.height||(this.data[e+t*this.width]=i)}getData(e,t){return e<0||t<0||e>=this.width||t>=this.height?0:255&this.data[e+t*this.width]}recalcVisibility(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){let i=this.getTileState(t,e,6);3===i&&(i>>=1),this.setTileState(t,e,i,6)}for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){this.getTileState(t,e,1)&&this.revealTile(t,e,4)}}revealTile(e,t,i){for(let s=t-i;s<=t+i;s++)if(!(s<0||s>=this.height))for(let r=e-i;r<=e+i;r++){if(r<0||r>=this.width)continue;const h=r-e,a=s-t;if(h*h+a*a<=i*i+2){if(0===s||0===r||r===this.width-1||s===this.height-1)continue;this.setTileState(r,s,3,6)}}}}(128,128),L=()=>{if(f&&!(I>0)){if(y.width=window.innerWidth,y.height=window.innerHeight,x=new w(P,128,128),y.onmousedown=e=>{e.preventDefault(),T=!0,M=!1,p=e.clientX,B=e.clientY},y.onclick=e=>{if(T=!1,!M){const t=Math.floor(S+16*-v+window.innerWidth/C/2),i=Math.floor(D+16*-H+window.innerHeight/C/2),s=Math.floor((e.clientX/C-t)/16),r=Math.floor((e.clientY/C-i)/16);z(s,r,e.clientX/C,e.clientY/C),E.entities.push(new u(s,r))}},window.onmousemove=e=>{if(!T)return;e.preventDefault();const t=e.clientX-p,i=e.clientY-B;(M||t*t+i*i>64)&&(M=!0,S+=t/C,D+=i/C,p=e.clientX,B=e.clientY)},!m){for(let e=0;e<128;e++)for(let t=0;t<128;t++){const i=t+128*e;E.tiles[i]===o.startingPosition.id&&(v=t,H=e,E.setTileState(v,H,1,g.OWNED),E.recalcVisibility())}J(),m=!0}K()}};window.onresize=L;let k=null,Y=null,X=!1;const z=(e,t,i=800,s=600)=>{const r=Math.floor(P.canvas.width/C),h=Math.floor(P.canvas.height/C);if(i>=0&&i<=r&&s>=h-35&&s<=h&&k&&Y){return void(E.getTile(k,Y).isPassable&&q(i,s))}if(e<0||t<0||e>128||t>128)return k=null,void(Y=null);const a=E.getTileState(e,t,g.VISIBLE);if(0===a)return k=null,void(Y=null);k===e&&Y===t||(k=e,Y=t,X=3===a)};let N=Date.now(),F=Date.now(),j=0;const J=()=>{requestAnimationFrame(J),N=F,F=Date.now(),j+=F-N,j>=60&&(j=0,W());const e=b.update(S,D,(()=>{}),(()=>{k&&Y&&(E.setTileState(k,Y,1,g.OWNED),E.recalcVisibility(),k=null,Y=null)}));S===e[0]&&D===e[1]||(S=e[0],D=e[1]),K()},W=()=>{E.update()},K=()=>{C=Math.max(Math.floor(y.height/300+1),Math.floor(y.width/(16/9*300)+1)),S>16*v&&(S=16*v),D>16*H&&(D=16*H),S<16*v-2016&&(S=16*v-2016),D<16*H-2016&&(D=16*H-2016),P.imageSmoothingEnabled=!1,P.setTransform(C,0,0,C,0,0);const e=Math.floor(S+16*-v+window.innerWidth/C/2),t=Math.floor(D+16*-H+window.innerHeight/C/2);E.render(y,P,e,t,C);for(var i=0;i<O.length;i++){const e=Math.floor(P.canvas.width/C),t=Math.floor(P.canvas.height/C);P.fillStyle="rgba(255, 255, 255, 0.3)",P.fillRect(0,t-35,e,t),R(O[i].name,e/2+2,t-25-5,3),Z(O[i].imageX,O[i].imageY,e/2,t-25)}if(k&&Y&&(P.strokeStyle="white",P.strokeRect(16*k+e,16*Y+t,16,16),X)){const i=E.getTile(k,Y).getOutcome();i&&(P.fillStyle="rgba(0, 0, 0, 0.3)",P.fillRect(16*k+e+16,16*Y+t,18,16),P.drawImage(Q,8*d[i.type].imageX,8*d[i.type].imageY,8,8,16*k+e+18,16*Y+t+4,8,8),R(`${i.amount}`,16*k+e+27,16*Y+t+5,5))}U(),x.render(y,E,16,C)},G=[{imageX:0,imageY:11},{imageX:1,imageY:11}],U=()=>{for(let e=0;e<G.length;e++)P.drawImage(Q,8*G[e].imageX,8*G[e].imageY,8,8,4,4+14*e,8,8),R("0",14,5+14*e,6)},V="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",R=(e,t,i,s=8)=>{e=e.toUpperCase();for(var r=0;r<e.length;r++){var h=V.indexOf(e.charAt(r)),a=0+h%32,d=29+(h>>5);P.drawImage(Q,8*a,8*d,8,8,t+r*s,i,s,s)}},q=(e,t)=>{const i=Math.floor(P.canvas.width/C)/2,s=Math.floor(P.canvas.height/C)-25;e>=i&&e<=i+16&&t>=s&&t<=s+16&&k&&Y&&(E.setTileState(k,Y,1,g.OWNED),E.recalcVisibility(),k=null,Y=null)},Z=(e,t,i,s)=>{P.beginPath(),P.strokeStyle="yellow",P.rect(i,s,16,16),P.stroke(),P.drawImage(Q,8*e,8*t,16,16,i,s,16,16)};

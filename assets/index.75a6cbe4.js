var e=Object.defineProperty,t=("undefined"!=typeof require&&require,(t,i,r)=>(((t,i,r)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r})(t,"symbol"!=typeof i?i+"":i,r),r));!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i="data:image/png;base64,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";class r{constructor(e,i,r){t(this,"w"),t(this,"h"),t(this,"values"),this.w=e,this.h=i,this.values=new Array(e*i);for(let t=0;t<i;t+=r)for(let i=0;i<e;i+=r)this.setSample(i,t,2*Math.random()-1);let s=r,l=1/e,d=1;do{const t=s/2;for(let r=0;r<i;r+=s)for(let i=0;i<e;i+=s){const e=(this.sample(i,r)+this.sample(i+s,r)+this.sample(i,r+s)+this.sample(i+s,r+s))/4+(2*Math.random()-1)*s*l;this.setSample(i+t,r+t,e)}for(let i=0;i<e;i+=s)for(let r=0;r<e;r+=s){const e=this.sample(r,i),d=this.sample(r+s,i),h=this.sample(r,i+s),n=this.sample(r+t,i+t),a=this.sample(r+t,i-t),o=this.sample(r-t,i+t),A=(e+d+n+a)/4+(2*Math.random()-1)*s*l*.5,g=(e+h+n+o)/4+(2*Math.random()-1)*s*l*.5;this.setSample(r+t,i,A),this.setSample(r,i+t,g)}s/=2,l*=d+.8,d*=.3}while(s>1)}sample(e,t){return this.values[(e&this.w-1)+(t&this.h-1)*this.w]}setSample(e,t,i){this.values[(e&this.w-1)+(t&this.h-1)*this.w]=i}}const s=(e,t)=>{const i=new r(e,t,16),s=new r(e,t,16),d=new r(e,t,16),h=new r(e,t,32),n=new r(e,t,32),o=new Array(e*t),A=new Array(e*t);for(let r=0;r<t;r++)for(let l=0;l<e;l++){const A=l+r*e;let g=3*Math.abs(h.values[A]-n.values[A])-2,c=Math.abs(i.values[A]-s.values[A]);c=3*Math.abs(c-d.values[A])-2;let w=l/(e-1)*2-1,u=r/(t-1)*2-1;w<0&&(w=-w),u<0&&(u=-u);let f=w>=u?w:u;f*=f*f*f,f*=f*f*f,g=g+1-20*f,o[A]=g<-.5?a.water.id:g>.5&&c<-1.5?a.rock.id:a.grass.id}for(let r=0;r<e*t/2800;r++){let i=Math.round(Math.random()*e),r=Math.round(Math.random()*t);for(let s=0;s<10;s++){let s=i+Math.round(21*Math.random()-10),l=r+Math.round(21*Math.random()-10);for(let i=0;i<100;i++){let i=s+Math.round(5*Math.random())-Math.round(5*Math.random()),r=l+Math.round(5*Math.random())-Math.round(5*Math.random());for(let s=r-1;s<=r+1;s++)for(let r=i-1;r<=i+1;r++)r>=0&&s>=0&&r<e&&s<t&&1==o[r+s*e]&&(o[r+s*e]=a.sand.id)}}}for(let r=0;r<e*t/400;r++){const i=Math.round(Math.random()*e),r=Math.round(Math.random()*t);for(let s=0;s<200;s++){const s=i+Math.round(15*Math.random())-Math.round(15*Math.random()),l=r+Math.round(15*Math.random())-Math.round(15*Math.random());s>=0&&l>=0&&s<e&&l<t&&o[s+l*e]==a.grass.id&&(o[s+l*e]=a.tree.id)}}for(let r=0;r<e*t/40;r++){const i=Math.round(Math.random()*e),r=Math.round(Math.random()*t);i>=0&&r>=0&&i<e&&r<<t&&o[i+r*e]===a.sand.id&&(o[i+r*e]=a.cactus.id)}for(let r=0;r<e*t/400;r++){const i=Math.round(Math.random()*e),r=Math.round(Math.random()*t);for(let s=0;s<30;s++){const s=i+Math.round(5*Math.random())-Math.round(5*Math.random()),l=r+Math.round(5*Math.random())-Math.round(5*Math.random());s>=0&&l>=0&&s<e&&l<t&&o[s+l*e]==a.grass.id&&(o[s+l*e]=a.flower.id)}}let g=-1,c=-1;for(;-1===g||-1===c;){g=Math.round(Math.random()*e),c=Math.round(Math.random()*t);e:for(let t=c-1;t<=c+1;t++)for(let i=g-1;i<=g+1;i++)if(o[i+t*e]===a.water.id||o[i+t*e]===a.rock.id||o[i+t*e]===a.tree.id){g=-1,c=-1;break e}const i=l(o,e,g,c,3,3,a.tree.id),r=l(o,e,g,c,5,1,a.rock.id);i&&r||(g=-1,c=-1)}return o[g+c*e]=a.startingPosition.id,[o,A]},l=(e,t,i,r,s,l,d)=>{let h=0;for(let n=r-s;n<=r+s;n++)for(let r=i-s;r<=i+s;r++)e[r+n*t]===d&&h++;return h>=l},d={wood:{imageX:0,imageY:11},stone:{imageX:1,imageY:11}};class h{constructor(e){t(this,"id"),t(this,"isFarmable",!1),t(this,"isPassable",!0),t(this,"isOnGrass",!1),t(this,"isOnSand",!1),t(this,"color",0),this.id=e}update(e,t,i){}getOutcome(){}}class n extends h{constructor(e){super(e),this.color=1096065}render(e,t,i,r,s,l){const d=e.getTile(i,r-1).id===this.id||e.getTile(i,r-1).id===a.tree.id||e.getTile(i,r-1).id===a.flower.id,h=e.getTile(i,r+1).id===this.id||e.getTile(i,r+1).id===a.tree.id||e.getTile(i,r+1).id===a.flower.id,n=e.getTile(i-1,r).id===this.id||e.getTile(i-1,r).id===a.tree.id||e.getTile(i-1,r).id===a.flower.id,o=e.getTile(i+1,r).id===this.id||e.getTile(i+1,r).id===a.tree.id||e.getTile(i+1,r).id===a.flower.id,A=e.getTile(i-1,r-1).id===this.id||e.getTile(i-1,r-1).id===a.tree.id||e.getTile(i-1,r-1).id===a.flower.id,g=e.getTile(i+1,r-1).id===this.id||e.getTile(i+1,r-1).id===a.tree.id||e.getTile(i+1,r-1).id===a.flower.id,c=e.getTile(i-1,r+1).id===this.id||e.getTile(i-1,r+1).id===a.tree.id||e.getTile(i-1,r+1).id===a.flower.id,w=e.getTile(i+1,r+1).id===this.id||e.getTile(i+1,r+1).id===a.tree.id||e.getTile(i+1,r+1).id===a.flower.id;d||n?d&&n&&!A?e.renderTile(t,32,32,i,r,s,l):e.renderTile(t,n?8:0,d?32:24,i,r,s,l):e.renderTile(t,0,24,i,r,s,l),d||o?d&&o&&!g?e.renderTile(t,24,32,i,r,s+8,l):e.renderTile(t,o?8:16,d?32:24,i,r,s+8,l):e.renderTile(t,16,24,i,r,s+8,l),h||n?h&&n&&!c?e.renderTile(t,32,24,i,r,s,l+8):e.renderTile(t,n?8:0,h?32:40,i,r,s,l+8):e.renderTile(t,0,40,i,r,s,l+8),h||o?h&&o&&!w?e.renderTile(t,24,24,i,r,s+8,l+8):e.renderTile(t,o?8:16,h?32:40,i,r,s+8,l+8):e.renderTile(t,16,40,i,r,s+8,l+8)}}const a={water:new class extends h{constructor(e){super(e),t(this,"position1",0),t(this,"position2",0),t(this,"position3",0),t(this,"position4",0),t(this,"shouldAnimate",!0),this.isPassable=!1,this.color=3900150}render(e,t,i,r,s,l){this.shouldAnimate&&(this.position1=Math.round(3+3*Math.random()),this.position2=Math.round(3+3*Math.random()),this.position3=Math.round(3+3*Math.random()),this.position4=Math.round(3+3*Math.random()),this.shouldAnimate=!1);const d=e.getTile(i,r-1).id===this.id,h=e.getTile(i,r+1).id===this.id,n=e.getTile(i-1,r).id===this.id,a=e.getTile(i+1,r).id===this.id,o=e.getTile(i-1,r-1).id===this.id,A=e.getTile(i+1,r-1).id===this.id;d||n?d&&n&&!o?e.renderTile(t,32,8,i,r,s,l):d&&n?e.renderTile(t,8*this.position1,16,i,r,s,l):e.renderTile(t,n?8:0,d?8:0,i,r,s,l):e.renderTile(t,0,0,i,r,s,l),d||a?d&&a&&!A?e.renderTile(t,24,8,i,r,s+8,l):d&&a?e.renderTile(t,8*this.position2,16,i,r,s+8,l):e.renderTile(t,a?8:16,d?8:0,i,r,s+8,l):e.renderTile(t,16,0,i,r,s+8,l),h||n?h&&n?e.renderTile(t,8*this.position3,16,i,r,s,l+8):e.renderTile(t,n?8:0,h?8:16,i,r,s,l+8):e.renderTile(t,0,16,i,r,s,l+8),h||a?h&&a?e.renderTile(t,8*this.position4,16,i,r,s+8,l+8):e.renderTile(t,a?8:16,h?8:16,i,r,s+8,l+8):e.renderTile(t,16,16,i,r,s+8,l+8),d&&!n&&o&&e.renderTile(t,32,0,i,r,s,l-8),d&&!a&&A&&e.renderTile(t,24,0,i,r,s+8,l-8)}update(e,t,i){e.tickCount%10==0&&(this.shouldAnimate=!0)}}(0),grass:new n(1),sand:new class extends h{constructor(e){super(e),this.color=16498468}render(e,t,i,r,s,l){e.renderTile(t,40,0,i,r,s,l),e.renderTile(t,40,0,i,r,s+8,l),e.renderTile(t,40,0,i,r,s,l+8),e.renderTile(t,40,0,i,r,s+8,l+8)}}(2),tree:new class extends h{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1,this.isOnGrass=!0,this.color=417606}render(e,t,i,r,s,l){e.renderTile(t,16,72,i,r,s,l),e.renderTile(t,24,72,i,r,s+8,l),e.renderTile(t,16,80,i,r,s,l+8),e.renderTile(t,24,80,i,r,s+8,l+8)}getOutcome(){return{amount:3,type:"wood"}}}(3),rock:new class extends h{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1,this.color=10265519}render(e,t,i,r,s,l){const d=e.getTile(i,r-1).id===this.id,h=e.getTile(i,r+1).id===this.id,n=e.getTile(i-1,r).id===this.id,a=e.getTile(i+1,r).id===this.id,o=e.getTile(i-1,r-1).id===this.id,A=e.getTile(i+1,r-1).id===this.id,g=e.getTile(i-1,r+1).id===this.id,c=e.getTile(i+1,r+1).id===this.id;d||n?d&&n&&!o?e.renderTile(t,32,56,i,r,s,l):e.renderTile(t,n?8:0,d?56:48,i,r,s,l):e.renderTile(t,0,48,i,r,s,l),d||a?d&&a&&!A?e.renderTile(t,24,56,i,r,s+8,l):e.renderTile(t,a?8:16,d?56:48,i,r,s+8,l):e.renderTile(t,16,48,i,r,s+8,l),h||n?h&&n&&!g?e.renderTile(t,32,48,i,r,s,l+8):e.renderTile(t,n?8:0,h?56:64,i,r,s,l+8):e.renderTile(t,0,64,i,r,s,l+8),h||a?h&&a&&!c?e.renderTile(t,24,48,i,r,s+8,l+8):e.renderTile(t,a?8:16,h?56:64,i,r,s+8,l+8):e.renderTile(t,16,64,i,r,s+8,l+8)}getOutcome(){return{amount:3,type:"stone"}}}(4),flower:new class extends h{constructor(e){super(e),this.isOnGrass=!0,this.color=1096065}render(e,t,i,r,s,l){e.renderTile(t,48,0,i,r,s+4,l+4)}}(5),cactus:new class extends h{constructor(e){super(e),this.isOnSand=!0,this.color=16498468}render(e,t,i,r,s,l){e.renderTile(t,56,0,i,r,s,l),e.renderTile(t,64,0,i,r,s+8,l),e.renderTile(t,56,8,i,r,s,l+8),e.renderTile(t,64,8,i,r,s+8,l+8)}}(6),dirt:new class extends h{constructor(e){super(e),this.color=7877903}render(e,t,i,r,s,l){const d=e.getTile(i,r-1).id===this.id,h=e.getTile(i,r+1).id===this.id,n=e.getTile(i-1,r).id===this.id,a=e.getTile(i+1,r).id===this.id,o=e.getTile(i-1,r-1).id===this.id,A=e.getTile(i+1,r-1).id===this.id,g=e.getTile(i-1,r+1).id===this.id,c=e.getTile(i+1,r+1).id===this.id;d||n?d&&n&&!o?e.renderTile(t,72,32,i,r,s,l):e.renderTile(t,n?48:40,d?32:24,i,r,s,l):e.renderTile(t,40,24,i,r,s,l),d||a?d&&a&&!A?e.renderTile(t,64,32,i,r,s+8,l):e.renderTile(t,a?48:56,d?32:24,i,r,s+8,l):e.renderTile(t,56,24,i,r,s+8,l),h||n?h&&n&&!g?e.renderTile(t,72,24,i,r,s,l+8):e.renderTile(t,n?48:40,h?32:40,i,r,s,l+8):e.renderTile(t,40,40,i,r,s,l+8),h||a?h&&a&&!c?e.renderTile(t,64,24,i,r,s+8,l+8):e.renderTile(t,a?48:56,h?32:40,i,r,s+8,l+8):e.renderTile(t,56,40,i,r,s+8,l+8)}}(7),startingPosition:new n(999)},o=Object.entries(a).map((([e,t])=>t));var A,g;(g=A||(A={}))[g.OWNED=1]="OWNED",g[g.VISIBLE=6]="VISIBLE";let c=!1,w=!1;window.onload=()=>{c=!0,k()};let u=!1,f=!1,T=0,m=0,M=0,S=0,p=0,D=0;let B=3;let v=0;const y=(e=>{const t=new Image;return v++,t.onload=()=>{v--,0===v&&k()},t.src=e,t})(i),X=document.querySelector("#map"),O=X.getContext("2d"),b=new class{constructor(){t(this,"scrollX",0),t(this,"scrollY",0),t(this,"scrollSpeed",3),t(this,"keys",[]),window.onkeydown=e=>{this.keys[e.keyCode]=!0},window.onkeyup=e=>{this.keys[e.keyCode]=!1}}update(e,t,i,r){return this.scrollX=e,this.scrollY=t,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&i&&i(),this.keys[49]&&r&&r(),[this.scrollX,this.scrollY]}},H=new Array(1);for(let $=0;$<H.length;$++)H[$]={name:"Base",imageX:0,imageY:9};const I=new class{constructor(e,r){t(this,"tiles"),t(this,"data"),t(this,"tilesState"),t(this,"tileSize",16),t(this,"tickCount",0),t(this,"tileImage"),t(this,"imagesToLoad",0),t(this,"width"),t(this,"height"),this.width=e,this.height=r,this.tiles=new Array(e*r),this.data=new Array(e*r),this.tilesState=new Array(e*r),this.tileImage=this.loadImage(i)}loadImage(e){var t=new Image;return this.imagesToLoad++,t.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},t.src=e,t}init(){const e=((e,t)=>{for(;;){const i=s(e,t),r=new Array(256);for(let s=0;s<e*t;s++)r[255&i[0][s]]++;if(!(r[2]<100||r[1]<100))return i}})(this.width,this.height);this.tiles=e[0],this.tilesState=e[1],this.data=e[1],this.tilesState.fill(0)}update(){this.tickCount++,this.tickCount>=Number.MAX_VALUE&&(this.tickCount=0);for(let e=0;e<this.width*this.height/50;e++){const e=Math.round(Math.random()*this.width),t=Math.round(Math.random()*this.height);this.getTile(e,t).update(this,e,t)}}render(e,t,i,r,s){const l=Math.floor(-i/this.tileSize),d=Math.floor(-r/this.tileSize),h=Math.ceil((-i+e.width/s)/this.tileSize),n=Math.ceil((-r+e.height/s)/this.tileSize);for(let A=d;A<n;A++)for(let e=l;e<h;e++){const s=this.getTile(e,A),l=this.getTileState(e,A,1);if(s.isOnGrass){o.find((e=>e.id===a.grass.id)).render(this,t,e,A,i,r)}else if(s.isOnSand){o.find((e=>e.id===a.sand.id)).render(this,t,e,A,i,r)}s.render(this,t,e,A,i,r),1===l&&t.drawImage(this.tileImage,0,72,16,16,e*this.tileSize+i,A*this.tileSize+r,16,16)}for(let a=d;a<n;a++)for(let e=l;e<h;e++){const s=this.getTileState(e,a,6);if(1===s)t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,a*this.tileSize+r+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,a*this.tileSize+r+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,a*this.tileSize+r+8,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,a*this.tileSize+r+8,8,8);else for(let l=0;l<4;l++){const d=l%2*2-1,h=2*(l>>1)-1,n=this.getTileState(e,a+h,6)!==s,o=this.getTileState(e+d,a,6)!==s;let A=25,g=1;3===s&&(g+=3),n&&(g+=h),o&&(A+=d),t.drawImage(this.tileImage,8*A,8*g,8,8,e*this.tileSize+i+l%2*8,a*this.tileSize+r+8*(l>>1),8,8)}}}renderTile(e,t,i,r,s,l,d){e.drawImage(this.tileImage,t,i,8,8,r*this.tileSize+l,s*this.tileSize+d,8,8)}getTile(e,t){if(e<0||t<0||e>=this.width||t>=this.height)return a.water;const i=o.find((i=>this.tiles[e+t*this.width]===i.id));return null!=i?i:a.water}getTileState(e,t,i){return e<0||t<0||e>=this.width||t>=this.height?0:6===i?(this.tilesState[e+t*this.width]&i)>>1:this.tilesState[e+t*this.width]&i}setTileState(e,t,i,r){if(!(e<0||t<0||e>=this.width||t>=this.height))if(6===r){const r=this.tilesState[e+t*this.width];this.tilesState[e+t*this.width]=i<<1|1&r}else this.tilesState[e+t*this.width]^=i,this.tiles[e+t*this.width]=a.dirt.id}setTile(e,t,i){e<0||t<0||e>=this.width||t>=this.height||(this.tiles[e+t*this.width]=i.id)}setData(e,t,i){e<0||t<0||e>=this.width||t>=this.height||(this.data[e+t*this.width]=i)}getData(e,t){return e<0||t<0||e>=this.width||t>=this.height?0:255&this.data[e+t*this.width]}recalcVisibility(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){let i=this.getTileState(t,e,6);3===i&&(i>>=1),this.setTileState(t,e,i,6)}for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){this.getTileState(t,e,1)&&this.revealTile(t,e,4)}}revealTile(e,t,i){for(let r=t-i;r<=t+i;r++)if(!(r<0||r>=this.height))for(let s=e-i;s<=e+i;s++){if(s<0||s>=this.width)continue;const l=s-e,d=r-t;if(l*l+d*d<=i*i+2){if(0===r||0===s||s===this.width-1||r===this.height-1)continue;this.setTileState(s,r,3,6)}}}}(128,128);let E=O.createImageData(128,128);const C=document.createElement("canvas"),k=()=>{if(c&&!(v>0)){if(X.width=window.innerWidth,X.height=window.innerHeight,C.width=E.width,C.height=E.height,X.onmousedown=e=>{e.preventDefault(),u=!0,f=!1,T=e.clientX,m=e.clientY},X.onclick=e=>{if(u=!1,!f){const t=Math.floor(M+16*-p+window.innerWidth/B/2),i=Math.floor(S+16*-D+window.innerHeight/B/2),r=Math.floor((e.clientX/B-t)/16),s=Math.floor((e.clientY/B-i)/16);P(r,s,e.clientX/B,e.clientY/B)}},window.onmousemove=e=>{if(!u)return;e.preventDefault();const t=e.clientX-T,i=e.clientY-m;(f||t*t+i*i>64)&&(f=!0,M+=t/B,S+=i/B,T=e.clientX,m=e.clientY)},!w){for(let e=0;e<128;e++)for(let t=0;t<128;t++){const i=t+128*e;I.tiles[i]===a.startingPosition.id&&(p=t,D=e,I.setTileState(p,D,1,A.OWNED),I.recalcVisibility())}L(),w=!0}F()}};window.onresize=k;let z=null,G=null,Q=!1;const P=(e,t,i=800,r=600)=>{const s=Math.floor(O.canvas.width/B),l=Math.floor(O.canvas.height/B);if(i>=0&&i<=s&&r>=l-35&&r<=l&&z&&G){return void(I.getTile(z,G).isPassable&&R(i,r))}if(e<0||t<0||e>128||t>128)return z=null,void(G=null);const d=I.getTileState(e,t,A.VISIBLE);if(0===d)return z=null,void(G=null);z===e&&G===t||(z=e,G=t,Q=3===d)};let N=Date.now(),Y=Date.now(),x=0;const L=()=>{requestAnimationFrame(L),N=Y,Y=Date.now(),x+=Y-N,x>=60&&(x=0,W());const e=b.update(M,S,(()=>{}),(()=>{z&&G&&(I.setTileState(z,G,1,A.OWNED),I.recalcVisibility(),z=null,G=null)}));M===e[0]&&S===e[1]||(M=e[0],S=e[1]),F()},W=()=>{I.update()},F=()=>{B=Math.max(Math.floor(X.height/300+1),Math.floor(X.width/(16/9*300)+1)),M>16*p&&(M=16*p),S>16*D&&(S=16*D),M<16*p-2016&&(M=16*p-2016),S<16*D-2016&&(S=16*D-2016),O.imageSmoothingEnabled=!1,O.setTransform(B,0,0,B,0,0);const e=Math.floor(M+16*-p+window.innerWidth/B/2),t=Math.floor(S+16*-D+window.innerHeight/B/2);I.render(X,O,e,t,B);for(var i=0;i<H.length;i++){const e=Math.floor(O.canvas.width/B),t=Math.floor(O.canvas.height/B);O.fillStyle="rgba(255, 255, 255, 0.3)",O.fillRect(0,t-35,e,t),J(H[i].name,e/2+2,t-25-5,3),Z(H[i].imageX,H[i].imageY,e/2,t-25)}if(z&&G&&(O.strokeStyle="white",O.strokeRect(16*z+e,16*G+t,16,16),Q)){const i=I.getTile(z,G).getOutcome();i&&(O.fillStyle="rgba(0, 0, 0, 0.3)",O.fillRect(16*z+e+16,16*G+t,18,16),O.drawImage(y,8*d[i.type].imageX,8*d[i.type].imageY,8,8,16*z+e+18,16*G+t+4,8,8),J(`${i.amount}`,16*z+e+27,16*G+t+5,5))}j(),U()},U=()=>{const e=Math.floor(O.canvas.width/B)-X.width/(16+B+10)-8;for(let t=0;t<128;t++)for(let e=0;e<128;e++){const i=e+128*t,r=I.getTile(e,t),[s,l,d]=V(r.color);I.getTileState(e,t,A.OWNED)?(E.data[4*i]=255,E.data[4*i+1]=0,E.data[4*i+2]=0,E.data[4*i+3]=255):I.getTileState(e,t,A.VISIBLE)>=1?(E.data[4*i]=s,E.data[4*i+1]=l,E.data[4*i+2]=d,E.data[4*i+3]=255):(E.data[4*i]=0,E.data[4*i+1]=0,E.data[4*i+2]=0,E.data[4*i+3]=255)}C.getContext("2d").putImageData(E,0,0),O.drawImage(C,e,8,X.width/(16+B+10),X.width/(16+B+10))},V=e=>[e>>16&255,e>>8&255,255&e],K=[{imageX:0,imageY:11},{imageX:1,imageY:11}],j=()=>{for(let e=0;e<K.length;e++)O.drawImage(y,8*K[e].imageX,8*K[e].imageY,8,8,4,4+14*e,8,8),J("0",14,5+14*e,6)},q="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",J=(e,t,i,r=8)=>{e=e.toUpperCase();for(var s=0;s<e.length;s++){var l=q.indexOf(e.charAt(s)),d=0+l%32,h=29+(l>>5);O.drawImage(y,8*d,8*h,8,8,t+s*r,i,r,r)}},R=(e,t)=>{const i=Math.floor(O.canvas.width/B)/2,r=Math.floor(O.canvas.height/B)-25;e>=i&&e<=i+16&&t>=r&&t<=r+16&&z&&G&&(I.setTileState(z,G,1,A.OWNED),I.recalcVisibility(),z=null,G=null)},Z=(e,t,i,r)=>{O.beginPath(),O.strokeStyle="yellow",O.rect(i,r,16,16),O.stroke(),O.drawImage(y,8*e,8*t,16,16,i,r,16,16)};

var e=Object.defineProperty,t=("undefined"!=typeof require&&require,(t,i,r)=>(((t,i,r)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r})(t,"symbol"!=typeof i?i+"":i,r),r));!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i="data:image/png;base64,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";class r{constructor(e,i,r){t(this,"w"),t(this,"h"),t(this,"values"),this.w=e,this.h=i,this.values=new Array(e*i);for(let t=0;t<i;t+=r)for(let i=0;i<e;i+=r)this.setSample(i,t,2*Math.random()-1);let s=r,l=1/e,A=1;do{const t=s/2;for(let r=0;r<i;r+=s)for(let i=0;i<e;i+=s){const e=(this.sample(i,r)+this.sample(i+s,r)+this.sample(i,r+s)+this.sample(i+s,r+s))/4+(2*Math.random()-1)*s*l;this.setSample(i+t,r+t,e)}for(let i=0;i<e;i+=s)for(let r=0;r<e;r+=s){const e=this.sample(r,i),A=this.sample(r+s,i),n=this.sample(r,i+s),a=this.sample(r+t,i+t),o=this.sample(r+t,i-t),d=this.sample(r-t,i+t),h=(e+A+a+o)/4+(2*Math.random()-1)*s*l*.5,c=(e+n+a+d)/4+(2*Math.random()-1)*s*l*.5;this.setSample(r+t,i,h),this.setSample(r,i+t,c)}s/=2,l*=A+.8,A*=.3}while(s>1)}sample(e,t){return this.values[(e&this.w-1)+(t&this.h-1)*this.w]}setSample(e,t,i){this.values[(e&this.w-1)+(t&this.h-1)*this.w]=i}}const s=(e,t)=>{const i=new r(e,t,16),s=new r(e,t,16),A=new r(e,t,16),n=new r(e,t,32),a=new r(e,t,32),d=new Array(e*t),h=new Array(e*t);for(let r=0;r<t;r++)for(let l=0;l<e;l++){const h=l+r*e;let c=3*Math.abs(n.values[h]-a.values[h])-2,g=Math.abs(i.values[h]-s.values[h]);g=3*Math.abs(g-A.values[h])-2;let w=l/(e-1)*2-1,f=r/(t-1)*2-1;w<0&&(w=-w),f<0&&(f=-f);let u=w>=f?w:f;u*=u*u*u,u*=u*u*u,c=c+1-20*u,d[h]=c<-.5?o.water.id:c>.5&&g<-1.5?o.rock.id:o.grass.id}for(let r=0;r<e*t/2800;r++){let i=Math.round(Math.random()*e),r=Math.round(Math.random()*t);for(let s=0;s<10;s++){let s=i+Math.round(21*Math.random()-10),l=r+Math.round(21*Math.random()-10);for(let i=0;i<100;i++){let i=s+Math.round(5*Math.random())-Math.round(5*Math.random()),r=l+Math.round(5*Math.random())-Math.round(5*Math.random());for(let s=r-1;s<=r+1;s++)for(let r=i-1;r<=i+1;r++)r>=0&&s>=0&&r<e&&s<t&&1==d[r+s*e]&&(d[r+s*e]=o.sand.id)}}}for(let r=0;r<e*t/400;r++){const i=Math.round(Math.random()*e),r=Math.round(Math.random()*t);for(let s=0;s<200;s++){const s=i+Math.round(15*Math.random())-Math.round(15*Math.random()),l=r+Math.round(15*Math.random())-Math.round(15*Math.random());s>=0&&l>=0&&s<e&&l<t&&d[s+l*e]==o.grass.id&&(d[s+l*e]=o.tree.id)}}for(let r=0;r<e*t/40;r++){const i=Math.round(Math.random()*e),r=Math.round(Math.random()*t);i>=0&&r>=0&&i<e&&r<<t&&d[i+r*e]===o.sand.id&&(d[i+r*e]=o.cactus.id)}for(let r=0;r<e*t/400;r++){const i=Math.round(Math.random()*e),r=Math.round(Math.random()*t);for(let s=0;s<30;s++){const s=i+Math.round(5*Math.random())-Math.round(5*Math.random()),l=r+Math.round(5*Math.random())-Math.round(5*Math.random());s>=0&&l>=0&&s<e&&l<t&&d[s+l*e]==o.grass.id&&(d[s+l*e]=o.flower.id)}}let c=-1,g=-1;for(;-1===c||-1===g;){c=Math.round(Math.random()*e),g=Math.round(Math.random()*t);e:for(let t=g-1;t<=g+1;t++)for(let i=c-1;i<=c+1;i++)if(d[i+t*e]===o.water.id||d[i+t*e]===o.rock.id||d[i+t*e]===o.tree.id){c=-1,g=-1;break e}const i=l(d,e,c,g,3,3,o.tree.id),r=l(d,e,c,g,5,1,o.rock.id);i&&r||(c=-1,g=-1)}return d[c+g*e]=o.startingPosition.id,[d,h]},l=(e,t,i,r,s,l,A)=>{let n=0;for(let a=r-s;a<=r+s;a++)for(let r=i-s;r<=i+s;r++)e[r+a*t]===A&&n++;return n>=l},A={wood:{imageX:0,imageY:11},stone:{imageX:1,imageY:11}};class n{constructor(e){t(this,"id"),t(this,"isFarmable",!1),t(this,"isPassable",!0),t(this,"isOnGrass",!1),t(this,"isOnSand",!1),this.id=e}getOutcome(){}}class a extends n{render(e,t,i,r,s,l){const A=e.getTile(i,r-1).id===this.id||e.getTile(i,r-1).id===o.tree.id||e.getTile(i,r-1).id===o.flower.id,n=e.getTile(i,r+1).id===this.id||e.getTile(i,r+1).id===o.tree.id||e.getTile(i,r+1).id===o.flower.id,a=e.getTile(i-1,r).id===this.id||e.getTile(i-1,r).id===o.tree.id||e.getTile(i-1,r).id===o.flower.id,d=e.getTile(i+1,r).id===this.id||e.getTile(i+1,r).id===o.tree.id||e.getTile(i+1,r).id===o.flower.id,h=e.getTile(i-1,r-1).id===this.id||e.getTile(i-1,r-1).id===o.tree.id||e.getTile(i-1,r-1).id===o.flower.id,c=e.getTile(i+1,r-1).id===this.id||e.getTile(i+1,r-1).id===o.tree.id||e.getTile(i+1,r-1).id===o.flower.id,g=e.getTile(i-1,r+1).id===this.id||e.getTile(i-1,r+1).id===o.tree.id||e.getTile(i-1,r+1).id===o.flower.id,w=e.getTile(i+1,r+1).id===this.id||e.getTile(i+1,r+1).id===o.tree.id||e.getTile(i+1,r+1).id===o.flower.id;A||a?A&&a&&!h?e.renderTile(t,32,32,i,r,s,l):e.renderTile(t,a?8:0,A?32:24,i,r,s,l):e.renderTile(t,0,24,i,r,s,l),A||d?A&&d&&!c?e.renderTile(t,24,32,i,r,s+8,l):e.renderTile(t,d?8:16,A?32:24,i,r,s+8,l):e.renderTile(t,16,24,i,r,s+8,l),n||a?n&&a&&!g?e.renderTile(t,32,24,i,r,s,l+8):e.renderTile(t,a?8:0,n?32:40,i,r,s,l+8):e.renderTile(t,0,40,i,r,s,l+8),n||d?n&&d&&!w?e.renderTile(t,24,24,i,r,s+8,l+8):e.renderTile(t,d?8:16,n?32:40,i,r,s+8,l+8):e.renderTile(t,16,40,i,r,s+8,l+8)}}const o={water:new class extends n{constructor(e){super(e),this.isPassable=!1}render(e,t,i,r,s,l){const A=e.getTile(i,r-1).id===this.id,n=e.getTile(i,r+1).id===this.id,a=e.getTile(i-1,r).id===this.id,o=e.getTile(i+1,r).id===this.id,d=e.getTile(i-1,r-1).id===this.id,h=e.getTile(i+1,r-1).id===this.id;A||a?A&&a&&!d?e.renderTile(t,32,8,i,r,s,l):e.renderTile(t,a?8:0,A?8:0,i,r,s,l):e.renderTile(t,0,0,i,r,s,l),A||o?A&&o&&!h?e.renderTile(t,24,8,i,r,s+8,l):e.renderTile(t,o?8:16,A?8:0,i,r,s+8,l):e.renderTile(t,16,0,i,r,s+8,l),n||a?e.renderTile(t,a?8:0,n?8:16,i,r,s,l+8):e.renderTile(t,0,16,i,r,s,l+8),n||o?e.renderTile(t,o?8:16,n?8:16,i,r,s+8,l+8):e.renderTile(t,16,16,i,r,s+8,l+8),A&&!a&&d&&e.renderTile(t,32,0,i,r,s,l-8),A&&!o&&h&&e.renderTile(t,24,0,i,r,s+8,l-8)}}(0),grass:new a(1),sand:new class extends n{render(e,t,i,r,s,l){e.renderTile(t,40,0,i,r,s,l),e.renderTile(t,40,0,i,r,s+8,l),e.renderTile(t,40,0,i,r,s,l+8),e.renderTile(t,40,0,i,r,s+8,l+8)}}(2),tree:new class extends n{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1,this.isOnGrass=!0}render(e,t,i,r,s,l){e.renderTile(t,16,72,i,r,s,l),e.renderTile(t,24,72,i,r,s+8,l),e.renderTile(t,16,80,i,r,s,l+8),e.renderTile(t,24,80,i,r,s+8,l+8)}getOutcome(){return{amount:3,type:"wood"}}}(3),rock:new class extends n{constructor(e){super(e),this.isFarmable=!0,this.isPassable=!1}render(e,t,i,r,s,l){const A=e.getTile(i,r-1).id===this.id,n=e.getTile(i,r+1).id===this.id,a=e.getTile(i-1,r).id===this.id,o=e.getTile(i+1,r).id===this.id,d=e.getTile(i-1,r-1).id===this.id,h=e.getTile(i+1,r-1).id===this.id,c=e.getTile(i-1,r+1).id===this.id,g=e.getTile(i+1,r+1).id===this.id;A||a?A&&a&&!d?e.renderTile(t,32,56,i,r,s,l):e.renderTile(t,a?8:0,A?56:48,i,r,s,l):e.renderTile(t,0,48,i,r,s,l),A||o?A&&o&&!h?e.renderTile(t,24,56,i,r,s+8,l):e.renderTile(t,o?8:16,A?56:48,i,r,s+8,l):e.renderTile(t,16,48,i,r,s+8,l),n||a?n&&a&&!c?e.renderTile(t,32,48,i,r,s,l+8):e.renderTile(t,a?8:0,n?56:64,i,r,s,l+8):e.renderTile(t,0,64,i,r,s,l+8),n||o?n&&o&&!g?e.renderTile(t,24,48,i,r,s+8,l+8):e.renderTile(t,o?8:16,n?56:64,i,r,s+8,l+8):e.renderTile(t,16,64,i,r,s+8,l+8)}getOutcome(){return{amount:3,type:"stone"}}}(4),flower:new class extends n{constructor(e){super(e),this.isOnGrass=!0}render(e,t,i,r,s,l){e.renderTile(t,48,0,i,r,s+4,l+4)}}(5),cactus:new class extends n{constructor(e){super(e),this.isOnSand=!0}render(e,t,i,r,s,l){e.renderTile(t,56,0,i,r,s,l),e.renderTile(t,64,0,i,r,s+8,l),e.renderTile(t,56,8,i,r,s,l+8),e.renderTile(t,64,8,i,r,s+8,l+8)}}(6),startingPosition:new a(999)},d=Object.entries(o).map((([e,t])=>t));var h,c;(c=h||(h={}))[c.OWNED=1]="OWNED",c[c.VISIBLE=6]="VISIBLE";let g=!1;window.onload=()=>{g=!0,D(),E()};let w=!1,f=!1,u=0,T=0,m=0,M=0,S=0,p=0;let v=3;let B=0;const C=(e=>{const t=new Image;return B++,t.onload=()=>{B--,0===B&&E()},t.src=e,t})(i),y=document.querySelector("#map"),Q=y.getContext("2d"),b=new class{constructor(){t(this,"scrollX",0),t(this,"scrollY",0),t(this,"scrollSpeed",3),t(this,"keys",[]),window.onkeydown=e=>{this.keys[e.keyCode]=!0},window.onkeyup=e=>{this.keys[e.keyCode]=!1}}update(e,t,i,r){return this.scrollX=e,this.scrollY=t,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&i&&i(),this.keys[49]&&r&&r(),[this.scrollX,this.scrollY]}},X=new Array(1);for(let V=0;V<X.length;V++)X[V]={name:"Base",imageX:0,imageY:9};const P=new class{constructor(e,r){t(this,"tiles"),t(this,"tilesState"),t(this,"tileSize",16),t(this,"tileImage"),t(this,"imagesToLoad",0),t(this,"width"),t(this,"height"),this.width=e,this.height=r,this.tiles=new Array(e*r),this.tilesState=new Array(e*r),this.tileImage=this.loadImage(i)}loadImage(e){var t=new Image;return this.imagesToLoad++,t.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},t.src=e,t}init(){const e=((e,t)=>{for(;;){const i=s(e,t),r=new Array(256);for(let s=0;s<e*t;s++)r[255&i[0][s]]++;if(!(r[2]<100||r[1]<100))return i}})(this.width,this.height);this.tiles=e[0],this.tilesState=e[1],this.tilesState.fill(0)}render(e,t,i,r,s){const l=Math.floor(-i/this.tileSize),A=Math.floor(-r/this.tileSize),n=Math.ceil((-i+e.width/s)/this.tileSize),a=Math.ceil((-r+e.height/s)/this.tileSize);for(let h=A;h<a;h++)for(let e=l;e<n;e++){const s=this.getTile(e,h),l=this.getTileState(e,h,1);if(s.isOnGrass){d.find((e=>e.id===o.grass.id)).render(this,t,e,h,i,r)}else if(s.isOnSand){d.find((e=>e.id===o.sand.id)).render(this,t,e,h,i,r)}s.render(this,t,e,h,i,r),1===l&&t.drawImage(this.tileImage,0,72,16,16,e*this.tileSize+i,h*this.tileSize+r,16,16)}for(let o=A;o<a;o++)for(let e=l;e<n;e++){const s=this.getTileState(e,o,6);if(1===s)t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,o*this.tileSize+r+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,o*this.tileSize+r+0,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+0,o*this.tileSize+r+8,8,8),t.drawImage(this.tileImage,240,16,8,8,e*this.tileSize+i+8,o*this.tileSize+r+8,8,8);else for(let l=0;l<4;l++){const A=l%2*2-1,n=2*(l>>1)-1,a=this.getTileState(e,o+n,6)!==s,d=this.getTileState(e+A,o,6)!==s;let h=25,c=1;3===s&&(c+=3),a&&(c+=n),d&&(h+=A),t.drawImage(this.tileImage,8*h,8*c,8,8,e*this.tileSize+i+l%2*8,o*this.tileSize+r+8*(l>>1),8,8)}}}renderTile(e,t,i,r,s,l,A){e.drawImage(this.tileImage,t,i,8,8,r*this.tileSize+l,s*this.tileSize+A,8,8)}getTile(e,t){if(e<0||t<0||e>=this.width||t>=this.height)return o.water;const i=d.find((i=>this.tiles[e+t*this.width]===i.id));return null!=i?i:o.water}getTileState(e,t,i){return e<0||t<0||e>=this.width||t>=this.height?0:6===i?(this.tilesState[e+t*this.width]&i)>>1:this.tilesState[e+t*this.width]&i}setTileState(e,t,i,r){if(!(e<0||t<0||e>=this.width||t>=this.height))if(6===r){const r=this.tilesState[e+t*this.width];this.tilesState[e+t*this.width]=i<<1|1&r}else this.tilesState[e+t*this.width]^=i}setTile(e,t,i){e<0||t<0||e>=this.width||t>=this.height||(this.tiles[e+t*this.width]=i.id)}recalcVisibility(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){let i=this.getTileState(t,e,6);3===i&&(i>>=1),this.setTileState(t,e,i,6)}for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){this.getTileState(t,e,1)&&this.revealTile(t,e,4)}}revealTile(e,t,i){for(let r=t-i;r<=t+i;r++)if(!(r<0||r>=this.height))for(let s=e-i;s<=e+i;s++){if(s<0||s>=this.width)continue;const l=s-e,A=r-t;if(l*l+A*A<=i*i+2){if(0===r||0===s||s===this.width-1||r===this.height-1)continue;this.setTileState(s,r,3,6)}}}}(128,128),E=()=>{!g||B>0||(y.width=window.innerWidth,y.height=window.innerHeight,y.onmousedown=e=>{e.preventDefault(),w=!0,f=!1,u=e.clientX,T=e.clientY},y.onclick=e=>{if(w=!1,!f){const t=Math.floor(m+16*-S+window.innerWidth/v/2),i=Math.floor(M+16*-p+window.innerHeight/v/2),r=Math.floor((e.clientX/v-t)/16),s=Math.floor((e.clientY/v-i)/16);F(r,s,e.clientX/v,e.clientY/v)}},window.onmousemove=e=>{if(!w)return;e.preventDefault();const t=e.clientX-u,i=e.clientY-T;(f||t*t+i*i>64)&&(f=!0,m+=t/v,M+=i/v,u=e.clientX,T=e.clientY,requestAnimationFrame(k))},k())},D=()=>{for(let e=0;e<128;e++)for(let t=0;t<128;t++){const i=t+128*e;P.tiles[i]===o.startingPosition.id&&(S=t,p=e,P.setTileState(S,p,1,h.OWNED),P.recalcVisibility())}N()};window.onresize=E;let I=null,z=null,O=!1;const F=(e,t,i=800,r=600)=>{const s=Math.floor(Q.canvas.width/v),l=Math.floor(Q.canvas.height/v);if(i>=0&&i<=s&&r>=l-35&&r<=l&&I&&z){return void(P.getTile(I,z).isPassable&&Y(i,r))}if(e<0||t<0||e>128||t>128)return I=null,void(z=null);const A=P.getTileState(e,t,h.VISIBLE);if(0===A)return I=null,z=null,void requestAnimationFrame(k);I===e&&z===t||(I=e,z=t,O=3===A),requestAnimationFrame(k)},N=()=>{requestAnimationFrame(N);const e=b.update(m,M,(()=>{}),(()=>{I&&z&&(P.setTileState(I,z,1,h.OWNED),P.recalcVisibility(),requestAnimationFrame(k),I=null,z=null)}));m===e[0]&&M===e[1]||(m=e[0],M=e[1],requestAnimationFrame(k))},k=()=>{v=Math.max(Math.floor(y.height/300+1),Math.floor(y.width/(16/9*300)+1)),m>16*S&&(m=16*S),M>16*p&&(M=16*p),m<16*S-2016&&(m=16*S-2016),M<16*p-2016&&(M=16*p-2016),Q.imageSmoothingEnabled=!1,Q.setTransform(v,0,0,v,0,0);const e=Math.floor(m+16*-S+window.innerWidth/v/2),t=Math.floor(M+16*-p+window.innerHeight/v/2);P.render(y,Q,e,t,v);for(var i=0;i<X.length;i++){const e=Math.floor(Q.canvas.width/v),t=Math.floor(Q.canvas.height/v);Q.fillStyle="rgba(255, 255, 255, 0.3)",Q.fillRect(0,t-35,e,t),U(X[i].name,e/2+2,t-25-5,3),W(X[i].imageX,X[i].imageY,e/2,t-25)}if(I&&z&&(Q.strokeStyle="white",Q.strokeRect(16*I+e,16*z+t,16,16),O)){const i=P.getTile(I,z).getOutcome();i&&(Q.fillStyle="rgba(0, 0, 0, 0.3)",Q.fillRect(16*I+e+16,16*z+t,18,16),Q.drawImage(C,8*A[i.type].imageX,8*A[i.type].imageY,8,8,16*I+e+18,16*z+t+4,8,8),U(`${i.amount}`,16*I+e+27,16*z+t+5,5))}H()},L=[{imageX:0,imageY:11},{imageX:1,imageY:11}],H=()=>{for(let e=0;e<L.length;e++)Q.drawImage(C,8*L[e].imageX,8*L[e].imageY,8,8,4,4+14*e,8,8),U("0",14,5+14*e,6)},x="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",U=(e,t,i,r=8)=>{e=e.toUpperCase();for(var s=0;s<e.length;s++){var l=x.indexOf(e.charAt(s)),A=0+l%32,n=29+(l>>5);Q.drawImage(C,8*A,8*n,8,8,t+s*r,i,r,r)}},Y=(e,t)=>{const i=Math.floor(Q.canvas.width/v)/2,r=Math.floor(Q.canvas.height/v)-25;e>=i&&e<=i+16&&t>=r&&t<=r+16&&I&&z&&(P.setTileState(I,z,1,h.OWNED),P.recalcVisibility(),requestAnimationFrame(k),I=null,z=null)},W=(e,t,i,r)=>{Q.beginPath(),Q.strokeStyle="yellow",Q.rect(i,r,16,16),Q.stroke(),Q.drawImage(C,8*e,8*t,16,16,i,r,16,16)};

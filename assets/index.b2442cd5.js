var t=Object.defineProperty,i=("undefined"!=typeof require&&require,(i,e,s)=>(((i,e,s)=>{e in i?t(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s})(i,"symbol"!=typeof e?e+"":e,s),s));!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver((t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)})).observe(document,{childList:!0,subtree:!0})}function i(t){if(t.ep)return;t.ep=!0;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?i.credentials="include":"anonymous"===t.crossorigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();var e="data:image/png;base64,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";class s{constructor(t,e){i(this,"x"),i(this,"y"),i(this,"xa",0),i(this,"ya",0),i(this,"dirX",0),i(this,"isDead",!1),i(this,"isPlayingDeadAnimation",!1),this.x=t,this.y=e}update(t){}move(t){if(0!==this.xa||0!==this.ya){let i=!0;return 0!==this.xa&&this.move2(t,this.xa,0)&&(i=!1),0!==this.ya&&this.move2(t,0,this.ya)&&(i=!1),0===this.xa||0===this.ya||this.move3(t,this.xa,this.ya)||(this.xa=0,this.ya=0),!i}return!0}move3(t,i,e){const s=this.x+i,a=this.y+e;return!!t.getTile(1===i?Math.floor(s):Math.round(s),1===e?Math.floor(a):Math.round(a)).isPassable}move2(t,i,e){const s=this.x-0,a=this.y-0,h=this.x+0,r=this.y+0,n=this.x+i-0,A=this.y+e-0,o=this.x+i+0,d=this.y+e+0;let l=!1;for(let g=A;g<=d;g++)for(let i=n;i<=o;i++)if(!(i>=s&&i<=h&&g>=a&&g<=r||t.getTile(Math.round(i),Math.round(g)).isPassable))return l=!0,!1;return!l&&(this.x+=i/16,this.y+=e/16,!0)}}class a extends s{constructor(){super(...arguments),i(this,"tx",0),i(this,"maxTx",4),i(this,"ty",12),i(this,"movingTx",4),i(this,"maxMovingTx",10),i(this,"moving",!0),i(this,"animation",0),i(this,"movingAnimation",0),i(this,"deadAnimationTx",8),i(this,"maxDeadAnimationTx",14),i(this,"deadAnimation",0)}render(t,i,e,s){this.isPlayingDeadAnimation||this.isDead?t.renderEntity(i,8*this.deadAnimationTx,1===this.dirX?8*(this.ty+2):8*this.ty,this.x,this.y,e,s):t.renderEntity(i,this.moving?8*this.movingTx:8*this.tx,-1===this.xa||1===this.dirX?8*(this.ty+2):8*this.ty,this.x,this.y,e,s)}update(t){0===Math.round(100*Math.random())&&(this.isPlayingDeadAnimation=!0),this.isPlayingDeadAnimation?this.playDeadAnimation():(1===this.xa||1===this.ya?(this.moving=!0,this.dirX=0):-1===this.xa||-1===this.ya?(this.moving=!0,this.dirX=1):this.moving=!1,this.move(t)?0===Math.floor(20*Math.random())&&(this.xa=Math.floor(3*Math.random())-1,this.ya=Math.floor(3*Math.random())-1):(this.xa=0,this.ya=0),this.animation+=1,this.movingAnimation+=1,this.animation%5!=0||this.moving||(this.animation=0,this.tx+=2,this.tx%this.maxTx==0&&(this.tx=0)),this.movingAnimation%2==0&&this.moving&&(this.movingAnimation=0,this.movingTx+=2,this.movingTx%this.maxMovingTx==0&&(this.movingTx=4)))}playDeadAnimation(){this.isDead||(this.deadAnimation+=1,this.deadAnimation%2==0&&(this.deadAnimation=0,this.deadAnimationTx+=2,this.deadAnimationTx===this.maxDeadAnimationTx&&(this.isDead=!0)))}}class h extends s{constructor(){super(...arguments),i(this,"tx",0),i(this,"maxTx",4),i(this,"ty",16),i(this,"movingTx",4),i(this,"maxMovingTx",10),i(this,"moving",!0),i(this,"animation",0),i(this,"movingAnimation",0),i(this,"deadAnimationTx",8),i(this,"maxDeadAnimationTx",14),i(this,"deadAnimation",0)}render(t,i,e,s){this.isPlayingDeadAnimation||this.isDead?t.renderEntity(i,8*this.deadAnimationTx,1===this.dirX?8*(this.ty+2):8*this.ty,this.x,this.y,e,s):t.renderEntity(i,this.moving?8*this.movingTx:8*this.tx,-1===this.xa||1===this.dirX?8*(this.ty+2):8*this.ty,this.x,this.y,e,s)}update(t){0===Math.round(100*Math.random())&&(this.isPlayingDeadAnimation=!0),this.isPlayingDeadAnimation?this.playDeadAnimation():(1===this.xa||1===this.ya?(this.moving=!0,this.dirX=0):-1===this.xa||-1===this.ya?(this.moving=!0,this.dirX=1):this.moving=!1,this.move(t)?0===Math.floor(20*Math.random())&&(this.xa=Math.floor(3*Math.random())-1,this.ya=Math.floor(3*Math.random())-1):(this.xa=0,this.ya=0),this.animation+=1,this.movingAnimation+=1,this.animation%7!=0||this.moving||(this.animation=0,this.tx+=2,this.tx%this.maxTx==0&&(this.tx=0)),this.movingAnimation%2==0&&this.moving&&(this.movingAnimation=0,this.movingTx+=2,this.movingTx%this.maxMovingTx==0&&(this.movingTx=4)))}playDeadAnimation(){this.isDead||(this.deadAnimation+=1,this.deadAnimation%2==0&&(this.deadAnimation=0,this.deadAnimationTx+=2,this.deadAnimationTx===this.maxDeadAnimationTx&&(this.isDead=!0)))}}Math.seed=t=>{const i=4294967295;let e=123456789+t&i,s=987654321-t&i;return()=>{s=36969*(65535&s)+(s>>>16)&i,e=18e3*(65535&e)+(e>>>16)&i;let t=(s<<16)+(65535&e)>>>0;return t/=4294967296,t}};let r=Math.seed(Math.random()*(10+90*Math.random()));class n{constructor(t,e,s){i(this,"w"),i(this,"h"),i(this,"values"),this.w=t,this.h=e,this.values=new Array(t*e);for(let i=0;i<e;i+=s)for(let e=0;e<t;e+=s)this.setSample(e,i,2*r()-1);let a=s,h=1/t,n=1;do{const i=a/2;for(let s=0;s<e;s+=a)for(let e=0;e<t;e+=a){const t=(this.sample(e,s)+this.sample(e+a,s)+this.sample(e,s+a)+this.sample(e+a,s+a))/4+(2*r()-1)*a*h;this.setSample(e+i,s+i,t)}for(let e=0;e<t;e+=a)for(let s=0;s<t;s+=a){const t=this.sample(s,e),n=this.sample(s+a,e),A=this.sample(s,e+a),o=this.sample(s+i,e+i),d=this.sample(s+i,e-i),l=this.sample(s-i,e+i),g=(t+n+o+d)/4+(2*r()-1)*a*h*.5,m=(t+A+o+l)/4+(2*r()-1)*a*h*.5;this.setSample(s+i,e,g),this.setSample(s,e+i,m)}a/=2,h*=n+.8,n*=.3}while(a>1)}sample(t,i){return this.values[(t&this.w-1)+(i&this.h-1)*this.w]}setSample(t,i,e){this.values[(t&this.w-1)+(i&this.h-1)*this.w]=e}}const A=(t,i,e=Math.random()*Number.MAX_SAFE_INTEGER)=>{r=Math.seed(e);const s=new n(t,i,16),a=new n(t,i,16),h=new n(t,i,16),A=new n(t,i,32),d=new n(t,i,32),l=new Array(t*i),g=new Array(t*i);for(let r=0;r<i;r++)for(let e=0;e<t;e++){const n=e+r*t;let o=3*Math.abs(A.values[n]-d.values[n])-2,g=Math.abs(s.values[n]-a.values[n]);g=3*Math.abs(g-h.values[n])-2;let c=e/(t-1)*2-1,f=r/(i-1)*2-1;c<0&&(c=-c),f<0&&(f=-f);let w=c>=f?c:f;w*=w*w*w,w*=w*w*w,o=o+1-20*w,l[n]=o<-.5?m.water.id:o>.5&&g<-1.5?m.rock.id:m.grass.id}for(let n=0;n<t*i/2800;n++){let e=Math.round(r()*t),s=Math.round(r()*i);for(let a=0;a<10;a++){let a=e+Math.round(21*r()-10),h=s+Math.round(21*r()-10);for(let e=0;e<100;e++){let e=a+Math.round(5*r())-Math.round(5*r()),s=h+Math.round(5*r())-Math.round(5*r());for(let a=s-1;a<=s+1;a++)for(let s=e-1;s<=e+1;s++)s>=0&&a>=0&&s<t&&a<i&&1==l[s+a*t]&&(l[s+a*t]=m.sand.id)}}}for(let n=0;n<t*i/400;n++){const e=Math.round(r()*t),s=Math.round(r()*i);for(let a=0;a<200;a++){const a=e+Math.round(15*r())-Math.round(15*r()),h=s+Math.round(15*r())-Math.round(15*r());a>=0&&h>=0&&a<t&&h<i&&l[a+h*t]==m.grass.id&&(l[a+h*t]=m.tree.id)}}for(let n=0;n<t*i/40;n++){const e=Math.round(r()*t),s=Math.round(r()*i);e>=0&&s>=0&&e<t&&s<<i&&l[e+s*t]===m.sand.id&&(l[e+s*t]=m.cactus.id)}for(let n=0;n<t*i/400;n++){const e=Math.round(r()*t),s=Math.round(r()*i);for(let a=0;a<30;a++){const a=e+Math.round(5*r())-Math.round(5*r()),h=s+Math.round(5*r())-Math.round(5*r());a>=0&&h>=0&&a<t&&h<i&&l[a+h*t]==m.grass.id&&(l[a+h*t]=m.flower.id)}}let c=-1,f=-1;for(;-1===c||-1===f;){c=Math.round(r()*t),f=Math.round(r()*i);t:for(let i=f-1;i<=f+1;i++)for(let e=c-1;e<=c+1;e++)if(l[e+i*t]===m.water.id||l[e+i*t]===m.rock.id||l[e+i*t]===m.tree.id){c=-1,f=-1;break t}const e=o(l,t,c,f,3,3,m.tree.id),s=o(l,t,c,f,5,1,m.rock.id);e&&s||(c=-1,f=-1)}return l[c+f*t]=m.startingPosition.id,[l,g]},o=(t,i,e,s,a,h,r)=>{let n=0;for(let A=s-a;A<=s+a;A++)for(let s=e-a;s<=e+a;s++)t[s+A*i]===r&&n++;return n>=h},d={wood:{imageX:0,imageY:11},stone:{imageX:1,imageY:11}};class l{constructor(t){i(this,"id"),i(this,"isFarmable",!1),i(this,"isPassable",!0),i(this,"isOnGrass",!1),i(this,"isOnSand",!1),i(this,"color",0),this.id=t}update(t,i,e){}getOutcome(){}}class g extends l{constructor(t){super(t),this.color=1096065}render(t,i,e,s,a,h){const r=t.getTile(e,s-1).id===this.id||t.getTile(e,s-1).id===m.tree.id||t.getTile(e,s-1).id===m.flower.id,n=t.getTile(e,s+1).id===this.id||t.getTile(e,s+1).id===m.tree.id||t.getTile(e,s+1).id===m.flower.id,A=t.getTile(e-1,s).id===this.id||t.getTile(e-1,s).id===m.tree.id||t.getTile(e-1,s).id===m.flower.id,o=t.getTile(e+1,s).id===this.id||t.getTile(e+1,s).id===m.tree.id||t.getTile(e+1,s).id===m.flower.id,d=t.getTile(e-1,s-1).id===this.id||t.getTile(e-1,s-1).id===m.tree.id||t.getTile(e-1,s-1).id===m.flower.id,l=t.getTile(e+1,s-1).id===this.id||t.getTile(e+1,s-1).id===m.tree.id||t.getTile(e+1,s-1).id===m.flower.id,g=t.getTile(e-1,s+1).id===this.id||t.getTile(e-1,s+1).id===m.tree.id||t.getTile(e-1,s+1).id===m.flower.id,c=t.getTile(e+1,s+1).id===this.id||t.getTile(e+1,s+1).id===m.tree.id||t.getTile(e+1,s+1).id===m.flower.id;r||A?r&&A&&!d?t.renderTile(i,32,32,e,s,a,h):t.renderTile(i,A?8:0,r?32:24,e,s,a,h):t.renderTile(i,0,24,e,s,a,h),r||o?r&&o&&!l?t.renderTile(i,24,32,e,s,a+8,h):t.renderTile(i,o?8:16,r?32:24,e,s,a+8,h):t.renderTile(i,16,24,e,s,a+8,h),n||A?n&&A&&!g?t.renderTile(i,32,24,e,s,a,h+8):t.renderTile(i,A?8:0,n?32:40,e,s,a,h+8):t.renderTile(i,0,40,e,s,a,h+8),n||o?n&&o&&!c?t.renderTile(i,24,24,e,s,a+8,h+8):t.renderTile(i,o?8:16,n?32:40,e,s,a+8,h+8):t.renderTile(i,16,40,e,s,a+8,h+8)}}const m={water:new class extends l{constructor(t){super(t),i(this,"position1",0),i(this,"position2",0),i(this,"position3",0),i(this,"position4",0),i(this,"shouldAnimate",!0),this.isPassable=!1,this.color=3900150}render(t,i,e,s,a,h){this.shouldAnimate&&(this.position1=Math.round(3+3*Math.random()),this.position2=Math.round(3+3*Math.random()),this.position3=Math.round(3+3*Math.random()),this.position4=Math.round(3+3*Math.random()),this.shouldAnimate=!1);const r=t.getTile(e,s-1).id===this.id,n=t.getTile(e,s+1).id===this.id,A=t.getTile(e-1,s).id===this.id,o=t.getTile(e+1,s).id===this.id,d=t.getTile(e-1,s-1).id===this.id,l=t.getTile(e+1,s-1).id===this.id;r||A?r&&A&&!d?t.renderTile(i,32,8,e,s,a,h):r&&A?t.renderTile(i,8*this.position1,16,e,s,a,h):t.renderTile(i,A?8:0,r?8:0,e,s,a,h):t.renderTile(i,0,0,e,s,a,h),r||o?r&&o&&!l?t.renderTile(i,24,8,e,s,a+8,h):r&&o?t.renderTile(i,8*this.position2,16,e,s,a+8,h):t.renderTile(i,o?8:16,r?8:0,e,s,a+8,h):t.renderTile(i,16,0,e,s,a+8,h),n||A?n&&A?t.renderTile(i,8*this.position3,16,e,s,a,h+8):t.renderTile(i,A?8:0,n?8:16,e,s,a,h+8):t.renderTile(i,0,16,e,s,a,h+8),n||o?n&&o?t.renderTile(i,8*this.position4,16,e,s,a+8,h+8):t.renderTile(i,o?8:16,n?8:16,e,s,a+8,h+8):t.renderTile(i,16,16,e,s,a+8,h+8),r&&!A&&d&&t.renderTile(i,32,0,e,s,a,h-8),r&&!o&&l&&t.renderTile(i,24,0,e,s,a+8,h-8)}update(t,i,e){t.tickCount%10==0&&(this.shouldAnimate=!0)}}(0),grass:new g(1),sand:new class extends l{constructor(t){super(t),this.color=16498468}render(t,i,e,s,a,h){t.renderTile(i,40,0,e,s,a,h),t.renderTile(i,40,0,e,s,a+8,h),t.renderTile(i,40,0,e,s,a,h+8),t.renderTile(i,40,0,e,s,a+8,h+8)}}(2),tree:new class extends l{constructor(t){super(t),this.isFarmable=!0,this.isPassable=!1,this.isOnGrass=!0,this.color=417606}render(t,i,e,s,a,h){t.onTopTiles.find((t=>t.x===e&&t.y===s))||(t.onTopTiles.push({sx:16,sy:72,x:e,y:s,xExtraOffset:0,yExtraOffset:0}),t.onTopTiles.push({sx:24,sy:72,x:e,y:s,xExtraOffset:8,yExtraOffset:0})),t.renderTile(i,16,80,e,s,a,h+8),t.renderTile(i,24,80,e,s,a+8,h+8)}getOutcome(){return{amount:3,type:"wood"}}}(3),rock:new class extends l{constructor(t){super(t),this.isFarmable=!0,this.isPassable=!1,this.color=10265519}render(t,i,e,s,a,h){const r=t.getTile(e,s-1).id===this.id,n=t.getTile(e,s+1).id===this.id,A=t.getTile(e-1,s).id===this.id,o=t.getTile(e+1,s).id===this.id,d=t.getTile(e-1,s-1).id===this.id,l=t.getTile(e+1,s-1).id===this.id,g=t.getTile(e-1,s+1).id===this.id,m=t.getTile(e+1,s+1).id===this.id;r||A?r&&A&&!d?t.renderTile(i,32,56,e,s,a,h):t.renderTile(i,A?8:0,r?56:48,e,s,a,h):t.renderTile(i,0,48,e,s,a,h),r||o?r&&o&&!l?t.renderTile(i,24,56,e,s,a+8,h):t.renderTile(i,o?8:16,r?56:48,e,s,a+8,h):t.renderTile(i,16,48,e,s,a+8,h),n||A?n&&A&&!g?t.renderTile(i,32,48,e,s,a,h+8):t.renderTile(i,A?8:0,n?56:64,e,s,a,h+8):t.renderTile(i,0,64,e,s,a,h+8),n||o?n&&o&&!m?t.renderTile(i,24,48,e,s,a+8,h+8):t.renderTile(i,o?8:16,n?56:64,e,s,a+8,h+8):t.renderTile(i,16,64,e,s,a+8,h+8)}getOutcome(){return{amount:3,type:"stone"}}}(4),flower:new class extends l{constructor(t){super(t),this.isOnGrass=!0,this.color=1096065}render(t,i,e,s,a,h){t.renderTile(i,48,0,e,s,a+4,h+4)}}(5),cactus:new class extends l{constructor(t){super(t),this.isOnSand=!0,this.color=16498468}render(t,i,e,s,a,h){t.renderTile(i,56,0,e,s,a,h),t.renderTile(i,64,0,e,s,a+8,h),t.renderTile(i,56,8,e,s,a,h+8),t.renderTile(i,64,8,e,s,a+8,h+8)}}(6),dirt:new class extends l{constructor(t){super(t),this.color=7877903}render(t,i,e,s,a,h){const r=t.getTile(e,s-1).id===this.id,n=t.getTile(e,s+1).id===this.id,A=t.getTile(e-1,s).id===this.id,o=t.getTile(e+1,s).id===this.id,d=t.getTile(e-1,s-1).id===this.id,l=t.getTile(e+1,s-1).id===this.id,g=t.getTile(e-1,s+1).id===this.id,m=t.getTile(e+1,s+1).id===this.id;r||A?r&&A&&!d?t.renderTile(i,72,32,e,s,a,h):t.renderTile(i,A?48:40,r?32:24,e,s,a,h):t.renderTile(i,40,24,e,s,a,h),r||o?r&&o&&!l?t.renderTile(i,64,32,e,s,a+8,h):t.renderTile(i,o?48:56,r?32:24,e,s,a+8,h):t.renderTile(i,56,24,e,s,a+8,h),n||A?n&&A&&!g?t.renderTile(i,72,24,e,s,a,h+8):t.renderTile(i,A?48:40,n?32:40,e,s,a,h+8):t.renderTile(i,40,40,e,s,a,h+8),n||o?n&&o&&!m?t.renderTile(i,64,24,e,s,a+8,h+8):t.renderTile(i,o?48:56,n?32:40,e,s,a+8,h+8):t.renderTile(i,56,40,e,s,a+8,h+8)}}(7),startingPosition:new g(999)},c=Object.entries(m).map((([t,i])=>i));var f,w;(w=f||(f={}))[w.OWNED=1]="OWNED",w[w.VISIBLE=6]="VISIBLE";class u{constructor(t,e,s){i(this,"map2d"),i(this,"imageData"),i(this,"minimapCanvas",document.createElement("canvas")),i(this,"width"),i(this,"height"),this.map2d=t,this.width=e,this.height=s,this.imageData=t.createImageData(e,s),this.minimapCanvas.width=this.imageData.width,this.minimapCanvas.height=this.imageData.height}getRGB(t){return[t>>16&255,t>>8&255,255&t]}render(t,i,e,s){const a=Math.floor(this.map2d.canvas.width/s)-t.width/(e+s+10)-8,h=Math.round(t.width/(e+s+10));for(let r=0;r<this.height;r++)for(let t=0;t<this.width;t++){const e=t+r*this.width,s=i.getTile(t,r),[a,h,n]=this.getRGB(s.color);i.getTileState(t,r,f.OWNED)?(this.imageData.data[4*e]=255,this.imageData.data[4*e+1]=0,this.imageData.data[4*e+2]=0,this.imageData.data[4*e+3]=255):i.getTileState(t,r,f.VISIBLE)>=1?(this.imageData.data[4*e]=a,this.imageData.data[4*e+1]=h,this.imageData.data[4*e+2]=n,this.imageData.data[4*e+3]=255):(this.imageData.data[4*e]=0,this.imageData.data[4*e+1]=0,this.imageData.data[4*e+2]=0,this.imageData.data[4*e+3]=255)}this.minimapCanvas.getContext("2d").putImageData(this.imageData,0,0),this.map2d.drawImage(this.minimapCanvas,a,8,h,h),this.map2d.strokeStyle="rgba(255, 255, 255, 0.35)",this.map2d.strokeRect(a,8,h,h)}}let T=!1,x=!1;window.onload=()=>{T=!0,X()};let M=!1,y=!1,D=0,p=0,v=0,B=0,S=0,E=0;let I=3;let P=0;const C=(t=>{const i=new Image;return P++,i.onload=()=>{P--,0===P&&X()},i.src=t,i})(e),Q=document.querySelector("#map"),O=Q.getContext("2d"),Y=new class{constructor(){i(this,"scrollX",0),i(this,"scrollY",0),i(this,"scrollSpeed",3),i(this,"keys",[]),window.onkeydown=t=>{this.keys[t.keyCode]=!0},window.onkeyup=t=>{this.keys[t.keyCode]=!1}}update(t,i,e,s){return this.scrollX=t,this.scrollY=i,this.keys[87]&&(this.scrollY+=this.scrollSpeed),this.keys[65]&&(this.scrollX+=this.scrollSpeed),this.keys[83]&&(this.scrollY-=this.scrollSpeed),this.keys[68]&&(this.scrollX-=this.scrollSpeed),this.keys[27]&&e&&e(),this.keys[49]&&s&&s(),[this.scrollX,this.scrollY]}};let L;const N=new Array(1);for(let tt=0;tt<N.length;tt++)N[tt]={name:"Base",imageX:0,imageY:9};const b=new class{constructor(t,s,a){i(this,"tiles"),i(this,"data"),i(this,"tilesState"),i(this,"tileSize",16),i(this,"tickCount",0),i(this,"tileImage"),i(this,"imagesToLoad",0),i(this,"width"),i(this,"height"),i(this,"seed"),i(this,"entities",[]),i(this,"onTopTiles",[]),this.width=t,this.height=s,this.seed=a,this.tiles=new Array(t*s),this.data=new Array(t*s),this.tilesState=new Array(t*s),this.tileImage=this.loadImage(e)}loadImage(t){var i=new Image;return this.imagesToLoad++,i.onload=()=>{this.imagesToLoad--,0===this.imagesToLoad&&this.init()},i.src=t,i}init(){const t=((t,i,e=Math.random()*Number.MAX_SAFE_INTEGER)=>{for(;;){const s=A(t,i,e),a=new Array(256);for(let e=0;e<t*i;e++)a[255&s[0][e]]++;if(!(a[255&m.rock.id]<100||a[255&m.sand.id]<100||a[255&m.grass.id]<100||a[255&m.tree.id]<100))return s}})(this.width,this.height,this.seed);this.tiles=t[0],this.tilesState=[...t[1]],this.data=[...t[1]],this.tilesState.fill(0);for(let i=0;i<this.height;i++)for(let t=0;t<this.width;t++){if(this.tiles[t+i*this.width]===m.startingPosition.id)for(let e=0;e<5;e++)this.entities.push(0===Math.round(1*Math.random())?new a(t,i):new h(t,i))}}update(){this.tickCount++,this.tickCount>=Number.MAX_VALUE&&(this.tickCount=0);for(let t=0;t<this.width*this.height/50;t++){const t=Math.round(Math.random()*this.width),i=Math.round(Math.random()*this.height);this.getTile(t,i).update(this,t,i)}this.entities.filter((t=>!t.isDead)).forEach((t=>t.update(this)))}render(t,i,e,s,a){const h=Math.floor(-e/this.tileSize),r=Math.floor(-s/this.tileSize),n=Math.ceil((-e+t.width/a)/this.tileSize),A=Math.ceil((-s+t.height/a)/this.tileSize);for(let o=r;o<A;o++)for(let t=h;t<n;t++){const a=this.getTile(t,o),h=this.getTileState(t,o,1);if(a.isOnGrass){c.find((t=>t.id===m.grass.id)).render(this,i,t,o,e,s)}else if(a.isOnSand){c.find((t=>t.id===m.sand.id)).render(this,i,t,o,e,s)}a.render(this,i,t,o,e,s),1===h&&i.drawImage(this.tileImage,0,72,16,16,t*this.tileSize+e,o*this.tileSize+s,16,16)}this.entities.forEach((t=>t.render(this,i,e,s))),this.onTopTiles.forEach((t=>{this.renderTile(i,t.sx,t.sy,t.x,t.y,t.xExtraOffset+e,t.yExtraOffset+s)}));for(let o=r;o<A;o++)for(let t=h;t<n;t++){const a=this.getTileState(t,o,6);if(1===a)i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+0,o*this.tileSize+s+0,8,8),i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+8,o*this.tileSize+s+0,8,8),i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+0,o*this.tileSize+s+8,8,8),i.drawImage(this.tileImage,240,16,8,8,t*this.tileSize+e+8,o*this.tileSize+s+8,8,8);else for(let h=0;h<4;h++){const r=h%2*2-1,n=2*(h>>1)-1,A=this.getTileState(t,o+n,6)!==a,d=this.getTileState(t+r,o,6)!==a;let l=25,g=1;3===a&&(g+=3),A&&(g+=n),d&&(l+=r),i.drawImage(this.tileImage,8*l,8*g,8,8,t*this.tileSize+e+h%2*8,o*this.tileSize+s+8*(h>>1),8,8)}}}renderEntity(t,i,e,s,a,h,r){t.drawImage(this.tileImage,i,e,this.tileSize,this.tileSize,s*this.tileSize+h,a*this.tileSize+r,this.tileSize,this.tileSize)}renderTile(t,i,e,s,a,h,r){t.drawImage(this.tileImage,i,e,8,8,s*this.tileSize+h,a*this.tileSize+r,8,8)}getTile(t,i){if(t<0||i<0||t>=this.width||i>=this.height)return m.water;const e=c.find((e=>this.tiles[t+i*this.width]===e.id));return null!=e?e:m.water}getTileState(t,i,e){return t<0||i<0||t>=this.width||i>=this.height?0:6===e?(this.tilesState[t+i*this.width]&e)>>1:this.tilesState[t+i*this.width]&e}setTileState(t,i,e,s){if(!(t<0||i<0||t>=this.width||i>=this.height))if(6===s){const s=this.tilesState[t+i*this.width];this.tilesState[t+i*this.width]=e<<1|1&s}else this.tilesState[t+i*this.width]^=e,this.tiles[t+i*this.width]=m.dirt.id}setTile(t,i,e){t<0||i<0||t>=this.width||i>=this.height||(this.tiles[t+i*this.width]=e.id)}setData(t,i,e){t<0||i<0||t>=this.width||i>=this.height||(this.data[t+i*this.width]=e)}getData(t,i){return t<0||i<0||t>=this.width||i>=this.height?0:255&this.data[t+i*this.width]}recalcVisibility(){for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++){let e=this.getTileState(i,t,6);3===e&&(e>>=1),this.setTileState(i,t,e,6)}for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++){this.getTileState(i,t,1)&&this.revealTile(i,t,4)}}revealTile(t,i,e){for(let s=i-e;s<=i+e;s++)if(!(s<0||s>=this.height))for(let a=t-e;a<=t+e;a++){if(a<0||a>=this.width)continue;const h=a-t,r=s-i;if(h*h+r*r<=e*e+2){if(0===s||0===a||a===this.width-1||s===this.height-1)continue;this.setTileState(a,s,3,6)}}}}(128,128),X=()=>{if(T&&!(P>0)){if(Q.width=window.innerWidth,Q.height=window.innerHeight,L=new u(O,128,128),Q.onmousedown=t=>{t.preventDefault(),M=!0,y=!1,D=t.clientX,p=t.clientY},Q.onclick=t=>{if(M=!1,!y){const i=Math.floor(v+16*-S+window.innerWidth/I/2),e=Math.floor(B+16*-E+window.innerHeight/I/2),s=Math.floor((t.clientX/I-i)/16),a=Math.floor((t.clientY/I-e)/16);F(s,a,t.clientX/I,t.clientY/I)}},window.onmousemove=t=>{if(!M)return;t.preventDefault();const i=t.clientX-D,e=t.clientY-p;(y||i*i+e*e>64)&&(y=!0,v+=i/I,B+=e/I,D=t.clientX,p=t.clientY)},!x){for(let t=0;t<128;t++)for(let i=0;i<128;i++){const e=i+128*t;b.tiles[e]===m.startingPosition.id&&(S=i,E=t,b.setTileState(S,E,1,f.OWNED),b.recalcVisibility())}R(),x=!0}U()}};window.onresize=X;let z=null,G=null,K=!1;const F=(t,i,e=800,s=600)=>{const a=Math.floor(O.canvas.width/I),h=Math.floor(O.canvas.height/I);if(e>=0&&e<=a&&s>=h-35&&s<=h&&z&&G){return void(b.getTile(z,G).isPassable&&_(e,s))}if(t<0||i<0||t>128||i>128)return z=null,void(G=null);const r=b.getTileState(t,i,f.VISIBLE);if(0===r)return z=null,void(G=null);z===t&&G===i||(z=t,G=i,K=3===r)};let H=Date.now(),J=Date.now(),q=0;const R=()=>{requestAnimationFrame(R),H=J,J=Date.now(),q+=J-H,q>=60&&(q=0,k());const t=Y.update(v,B,(()=>{}),(()=>{if(z&&G){for(let t=0;t<5;t++)b.entities.push(0===Math.round(1*Math.random())?new a(z,G):new h(z,G));b.setTileState(z,G,1,f.OWNED),b.recalcVisibility(),z=null,G=null}}));v===t[0]&&B===t[1]||(v=t[0],B=t[1]),U()},k=()=>{b.update()},U=()=>{I=Math.max(Math.floor(Q.height/300+1),Math.floor(Q.width/(16/9*300)+1)),v>16*S&&(v=16*S),B>16*E&&(B=16*E),v<16*S-2016&&(v=16*S-2016),B<16*E-2016&&(B=16*E-2016),O.imageSmoothingEnabled=!1,O.setTransform(I,0,0,I,0,0);const t=Math.floor(v+16*-S+window.innerWidth/I/2),i=Math.floor(B+16*-E+window.innerHeight/I/2);b.render(Q,O,t,i,I);for(var e=0;e<N.length;e++){const t=Math.floor(O.canvas.width/I),i=Math.floor(O.canvas.height/I);O.fillStyle="rgba(255, 255, 255, 0.3)",O.fillRect(0,i-35,t,i),Z(N[e].name,t/2+2,i-25-5,3),$(N[e].imageX,N[e].imageY,t/2,i-25)}if(z&&G&&(O.strokeStyle="white",O.strokeRect(16*z+t,16*G+i,16,16),K)){const e=b.getTile(z,G).getOutcome();e&&(O.fillStyle="rgba(0, 0, 0, 0.3)",O.fillRect(16*z+t+16,16*G+i,18,16),O.drawImage(C,8*d[e.type].imageX,8*d[e.type].imageY,8,8,16*z+t+18,16*G+i+4,8,8),Z(`${e.amount}`,16*z+t+27,16*G+i+5,5))}j(),L.render(Q,b,16,I)},W=[{imageX:0,imageY:11},{imageX:1,imageY:11}],j=()=>{for(let t=0;t<W.length;t++)O.drawImage(C,8*W[t].imageX,8*W[t].imageY,8,8,4,4+14*t,8,8),Z("0",14,5+14*t,6)},V="ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789.,!?'\":;()+-=*/\\%     ",Z=(t,i,e,s=8)=>{t=t.toUpperCase();for(var a=0;a<t.length;a++){var h=V.indexOf(t.charAt(a)),r=0+h%32,n=29+(h>>5);O.drawImage(C,8*r,8*n,8,8,i+a*s,e,s,s)}},_=(t,i)=>{const e=Math.floor(O.canvas.width/I)/2,s=Math.floor(O.canvas.height/I)-25;t>=e&&t<=e+16&&i>=s&&i<=s+16&&z&&G&&(b.setTileState(z,G,1,f.OWNED),b.recalcVisibility(),z=null,G=null)},$=(t,i,e,s)=>{O.beginPath(),O.strokeStyle="yellow",O.rect(e,s,16,16),O.stroke(),O.drawImage(C,8*t,8*i,16,16,e,s,16,16)};
